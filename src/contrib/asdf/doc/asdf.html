<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.0.3, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This manual describes ASDF, a system definition facility
for Common Lisp programs and libraries.

You can find the latest version of this manual at
https://common-lisp.net/project/asdf/asdf.html.

ASDF Copyright © 2001-2019 Daniel Barlow and contributors.

This manual Copyright © 2001-2019 Daniel Barlow and contributors.

This manual revised © 2009-2019 Robert P. Goldman and Francois-Rene Rideau.

Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 -->
<title>ASDF Manual</title>

<meta name="description" content="ASDF Manual">
<meta name="keywords" content="ASDF Manual">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="#Top" rel="start" title="Top">
<link href="#Concept-Index" rel="index" title="Concept Index">
<link href="#SEC_Contents" rel="contents" title="Table of Contents">
<link href="dir.html#Top" rel="up" title="(dir)">
<link href="#Introduction" rel="next" title="Introduction">
<link href="dir.html#Top" rel="prev" title="(dir)">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
a.summary-letter-printindex {text-decoration: none}
div.example {margin-left: 3.2em}
kbd.kbd {font-style: oblique}
span:hover a.copiable-link {visibility: visible}
strong.def-name {font-family: monospace; font-weight: bold; font-size: larger}
td.printindex-index-entry {vertical-align: top}
td.printindex-index-section {vertical-align: top}
th.entries-header-printindex {text-align:left}
th.sections-header-printindex {text-align:left}
ul.mark-bullet {list-style-type: disc}
ul.toc-numbered-mark {list-style: none}
-->
</style>


</head>

<body lang="en">








<div class="top-level-extent" id="Top">
<h1 class="top" id="ASDF_003a-Another-System-Definition-Facility">ASDF: Another System Definition Facility</h1>
<p>Manual for Version 3.3.7
</p>

<p>This manual describes ASDF, a system definition facility
for Common Lisp programs and libraries.
</p>
<p>You can find the latest version of this manual at
<a class="url" href="https://common-lisp.net/project/asdf/asdf.html">https://common-lisp.net/project/asdf/asdf.html</a>.
</p>
<p>ASDF Copyright &copy; 2001-2019 Daniel Barlow and contributors.
</p>
<p>This manual Copyright &copy; 2001-2019 Daniel Barlow and contributors.
</p>
<p>This manual revised &copy; 2009-2019 Robert P. Goldman and Francois-Rene Rideau.
</p>
<p>Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:
</p>
<p>The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.
</p>
<p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
</p>




<div class="element-contents" id="SEC_Contents">
<h2 class="contents-heading">Table of Contents</h2>

<div class="contents">

<ul class="toc-numbered-mark">
  <li><a id="toc-Introduction-1" href="#Introduction">1 Introduction</a></li>
  <li><a id="toc-Quick-start-summary-1" href="#Quick-start-summary">2 Quick start summary</a></li>
  <li><a id="toc-Loading-ASDF-1" href="#Loading-ASDF">3 Loading ASDF</a>
  <ul class="toc-numbered-mark">
    <li><a id="toc-Loading-a-pre_002dinstalled-ASDF-1" href="#Loading-a-pre_002dinstalled-ASDF">3.1 Loading a pre-installed ASDF</a></li>
    <li><a id="toc-Checking-whether-ASDF-is-loaded-1" href="#Checking-whether-ASDF-is-loaded">3.2 Checking whether ASDF is loaded</a></li>
    <li><a id="toc-Upgrading-ASDF-1" href="#Upgrading-ASDF">3.3 Upgrading ASDF</a></li>
    <li><a id="toc-Replacing-your-implementation_0027s-ASDF-1" href="#Replacing-your-implementation_0027s-ASDF">3.4 Replacing your implementation&rsquo;s ASDF</a></li>
    <li><a id="toc-Loading-ASDF-from-source-1" href="#Loading-ASDF-from-source">3.5 Loading ASDF from source</a></li>
  </ul></li>
  <li><a id="toc-Configuring-ASDF-1" href="#Configuring-ASDF">4 Configuring ASDF</a>
  <ul class="toc-numbered-mark">
    <li><a id="toc-Configuring-ASDF-to-find-your-systems-1" href="#Configuring-ASDF-to-find-your-systems">4.1 Configuring ASDF to find your systems</a></li>
    <li><a id="toc-Configuring-ASDF-to-find-your-systems-_002d_002d_002d-old-style-1" href="#Configuring-ASDF-to-find-your-systems-_002d_002d_002d-old-style">4.2 Configuring ASDF to find your systems &mdash; old style</a></li>
    <li><a id="toc-Configuring-where-ASDF-stores-object-files-1" href="#Configuring-where-ASDF-stores-object-files">4.3 Configuring where ASDF stores object files</a></li>
    <li><a id="toc-Resetting-the-ASDF-configuration-1" href="#Resetting-the-ASDF-configuration">4.4 Resetting the ASDF configuration</a></li>
  </ul></li>
  <li><a id="toc-Using-ASDF-1" href="#Using-ASDF">5 Using ASDF</a>
  <ul class="toc-numbered-mark">
    <li><a id="toc-Loading-a-system-1" href="#Loading-a-system">5.1 Loading a system</a></li>
    <li><a id="toc-Convenience-Functions-1" href="#Convenience-Functions">5.2 Convenience Functions</a></li>
    <li><a id="toc-Moving-on-1" href="#Moving-on">5.3 Moving on</a></li>
  </ul></li>
  <li><a id="toc-Defining-systems-with-defsystem-1" href="#Defining-systems-with-defsystem">6 Defining systems with defsystem</a>
  <ul class="toc-numbered-mark">
    <li><a id="toc-The-defsystem-form-1" href="#The-defsystem-form">6.1 The defsystem form</a></li>
    <li><a id="toc-A-more-involved-example-1" href="#A-more-involved-example">6.2 A more involved example</a></li>
    <li><a id="toc-The-defsystem-grammar-1" href="#The-defsystem-grammar">6.3 The defsystem grammar</a>
    <ul class="toc-numbered-mark">
      <li><a id="toc-System-designators" href="#System-designators">6.3.1 System designators</a></li>
      <li><a id="toc-Simple-component-names-_0028simple_002dcomponent_002dname_0029" href="#Simple-component-names-_0028simple_002dcomponent_002dname_0029">6.3.2 Simple component names (<code class="code">simple-component-name</code>)</a></li>
      <li><a id="toc-Complex-component-names-1" href="#Complex-component-names-1">6.3.3 Complex component names</a></li>
      <li><a id="toc-Component-types-1" href="#Component-types-1">6.3.4 Component types</a></li>
      <li><a id="toc-System-class-names-1" href="#System-class-names-1">6.3.5 System class names</a></li>
      <li><a id="toc-Defsystem-depends-on" href="#Defsystem-depends-on">6.3.6 Defsystem depends on</a></li>
      <li><a id="toc-Build_002doperation-1" href="#Build_002doperation-1">6.3.7 Build-operation</a></li>
      <li><a id="toc-Weakly-depends-on" href="#Weakly-depends-on">6.3.8 Weakly depends on</a></li>
      <li><a id="toc-Pathname-specifiers-1" href="#Pathname-specifiers-1">6.3.9 Pathname specifiers</a></li>
      <li><a id="toc-Version-specifiers-1" href="#Version-specifiers-1">6.3.10 Version specifiers</a></li>
      <li><a id="toc-Require" href="#Require">6.3.11 Require</a></li>
      <li><a id="toc-Feature-dependencies-1" href="#Feature-dependencies-1">6.3.12 Feature dependencies</a></li>
      <li><a id="toc-Using-logical-pathnames-1" href="#Using-logical-pathnames-1">6.3.13 Using logical pathnames</a></li>
      <li><a id="toc-Serial-dependencies" href="#Serial-dependencies">6.3.14 Serial dependencies</a></li>
      <li><a id="toc-Source-location-_0028_003apathname_0029" href="#Source-location-_0028_003apathname_0029">6.3.15 Source location (<code class="code">:pathname</code>)</a></li>
      <li><a id="toc-if_002dfeature-option-1" href="#if_002dfeature-option-1">6.3.16 if-feature option</a></li>
      <li><a id="toc-Entry-point-1" href="#Entry-point-1">6.3.17 Entry point</a></li>
      <li><a id="toc-feature-requirement-1" href="#feature-requirement-1">6.3.18 feature requirement</a></li>
    </ul></li>
    <li><a id="toc-Other-code-in-_002easd-files-1" href="#Other-code-in-_002easd-files">6.4 Other code in .asd files</a></li>
    <li><a id="toc-The-package_002dinferred_002dsystem-extension-1" href="#The-package_002dinferred_002dsystem-extension">6.5 The package-inferred-system extension</a></li>
  </ul></li>
  <li><a id="toc-The-Object-model-of-ASDF" href="#The-object-model-of-ASDF">7 The Object model of ASDF</a>
  <ul class="toc-numbered-mark">
    <li><a id="toc-Operations-1" href="#Operations">7.1 Operations</a>
    <ul class="toc-numbered-mark">
      <li><a id="toc-Predefined-operations-of-ASDF-1" href="#Predefined-operations-of-ASDF">7.1.1 Predefined operations of ASDF</a></li>
      <li><a id="toc-Creating-new-operations-1" href="#Creating-new-operations">7.1.2 Creating new operations</a></li>
    </ul></li>
    <li><a id="toc-Components-1" href="#Components">7.2 Components</a>
    <ul class="toc-numbered-mark">
      <li><a id="toc-Common-attributes-of-components-1" href="#Common-attributes-of-components">7.2.1 Common attributes of components</a>
      <ul class="toc-numbered-mark">
        <li><a id="toc-Name" href="#Name">7.2.1.1 Name</a></li>
        <li><a id="toc-Version-identifier" href="#Version-identifier">7.2.1.2 Version identifier</a></li>
        <li><a id="toc-Required-features" href="#Required-features">7.2.1.3 Required features</a></li>
        <li><a id="toc-Dependencies-1" href="#Dependencies-1">7.2.1.4 Dependencies</a></li>
        <li><a id="toc-pathname" href="#pathname">7.2.1.5 pathname</a></li>
        <li><a id="toc-Properties" href="#Properties">7.2.1.6 Properties</a></li>
      </ul></li>
      <li><a id="toc-Pre_002ddefined-subclasses-of-component-1" href="#Pre_002ddefined-subclasses-of-component">7.2.2 Pre-defined subclasses of component</a></li>
      <li><a id="toc-Creating-new-component-types-1" href="#Creating-new-component-types">7.2.3 Creating new component types</a></li>
    </ul></li>
    <li><a id="toc-Dependencies-2" href="#Dependencies">7.3 Dependencies</a></li>
    <li><a id="toc-Functions-1" href="#Functions">7.4 Functions</a></li>
    <li><a id="toc-Parsing-system-definitions-1" href="#Parsing-system-definitions">7.5 Parsing system definitions</a></li>
  </ul></li>
  <li><a id="toc-Controlling-where-ASDF-searches-for-systems-1" href="#Controlling-where-ASDF-searches-for-systems">8 Controlling where ASDF searches for systems</a>
  <ul class="toc-numbered-mark">
    <li><a id="toc-Configurations-1" href="#Configurations">8.1 Configurations</a></li>
    <li><a id="toc-Truenames-and-other-dangers-1" href="#Truenames-and-other-dangers">8.2 Truenames and other dangers</a></li>
    <li><a id="toc-XDG-base-directory-1" href="#XDG-base-directory">8.3 XDG base directory</a></li>
    <li><a id="toc-Backward-Compatibility-1" href="#Backward-Compatibility">8.4 Backward Compatibility</a></li>
    <li><a id="toc-Configuration-DSL-1" href="#Configuration-DSL">8.5 Configuration DSL</a></li>
    <li><a id="toc-Configuration-Directories-1" href="#Configuration-Directories">8.6 Configuration Directories</a>
    <ul class="toc-numbered-mark">
      <li><a id="toc-The-_003ahere-directive" href="#The-here-directive">8.6.1 The :here directive</a></li>
    </ul></li>
    <li><a id="toc-Shell_002dfriendly-syntax-for-configuration-1" href="#Shell_002dfriendly-syntax-for-configuration">8.7 Shell-friendly syntax for configuration</a></li>
    <li><a id="toc-Search-Algorithm-1" href="#Search-Algorithm">8.8 Search Algorithm</a></li>
    <li><a id="toc-Caching-Results-1" href="#Caching-Results">8.9 Caching Results</a></li>
    <li><a id="toc-Configuration-API-1" href="#Configuration-API">8.10 Configuration API</a></li>
    <li><a id="toc-Introspection-1" href="#Introspection">8.11 Introspection</a>
    <ul class="toc-numbered-mark">
      <li><a id="toc-_002asource_002dregistry_002dparameter_002a-variable-1" href="#g_t_002asource_002dregistry_002dparameter_002a-variable">8.11.1 *source-registry-parameter* variable</a></li>
      <li><a id="toc-Information-about-system-dependencies-1" href="#Information-about-system-dependencies">8.11.2 Information about system dependencies</a></li>
    </ul></li>
    <li><a id="toc-Status-1" href="#Status">8.12 Status</a></li>
    <li><a id="toc-Rejected-ideas-1" href="#Rejected-ideas">8.13 Rejected ideas</a></li>
    <li><a id="toc-TODO-1" href="#TODO">8.14 TODO</a></li>
    <li><a id="toc-Credits-for-the-source_002dregistry-1" href="#Credits-for-the-source_002dregistry">8.15 Credits for the source-registry</a></li>
  </ul></li>
  <li><a id="toc-Controlling-where-ASDF-saves-compiled-files-1" href="#Controlling-where-ASDF-saves-compiled-files">9 Controlling where ASDF saves compiled files</a>
  <ul class="toc-numbered-mark">
    <li><a id="toc-Configurations-2" href="#Output-Configurations">9.1 Configurations</a></li>
    <li><a id="toc-Backward-Compatibility-2" href="#Output-Backward-Compatibility">9.2 Backward Compatibility</a></li>
    <li><a id="toc-Configuration-DSL-2" href="#Output-Configuration-DSL">9.3 Configuration DSL</a></li>
    <li><a id="toc-Configuration-Directories-2" href="#Output-Configuration-Directories">9.4 Configuration Directories</a></li>
    <li><a id="toc-Shell_002dfriendly-syntax-for-configuration-2" href="#Output-Shell_002dfriendly-syntax-for-configuration">9.5 Shell-friendly syntax for configuration</a></li>
    <li><a id="toc-Semantics-of-Output-Translations-1" href="#Semantics-of-Output-Translations">9.6 Semantics of Output Translations</a></li>
    <li><a id="toc-Caching-Results-2" href="#Output-Caching-Results">9.7 Caching Results</a></li>
    <li><a id="toc-Output-location-API-1" href="#Output-location-API">9.8 Output location API</a></li>
    <li><a id="toc-Credits-for-output-translations-1" href="#Credits-for-output-translations">9.9 Credits for output translations</a></li>
  </ul></li>
  <li><a id="toc-Error-handling-1" href="#Error-handling">10 Error handling</a>
  <ul class="toc-numbered-mark">
    <li><a id="toc-ASDF-errors" href="#ASDF-errors">10.1 ASDF errors</a></li>
    <li><a id="toc-Compilation-error-and-warning-handling" href="#Compilation-error-and-warning-handling">10.2 Compilation error and warning handling</a></li>
  </ul></li>
  <li><a id="toc-Miscellaneous-additional-functionality-1" href="#Miscellaneous-additional-functionality">11 Miscellaneous additional functionality</a>
  <ul class="toc-numbered-mark">
    <li><a id="toc-Controlling-file-compilation-1" href="#Controlling-file-compilation">11.1 Controlling file compilation</a></li>
    <li><a id="toc-Controlling-source-file-character-encoding-1" href="#Controlling-source-file-character-encoding">11.2 Controlling source file character encoding</a></li>
    <li><a id="toc-Miscellaneous-Functions-1" href="#Miscellaneous-Functions">11.3 Miscellaneous Functions</a></li>
    <li><a id="toc-Some-Utility-Functions-1" href="#Some-Utility-Functions">11.4 Some Utility Functions</a></li>
  </ul></li>
  <li><a id="toc-Getting-the-latest-version-1" href="#Getting-the-latest-version">12 Getting the latest version</a></li>
  <li><a id="toc-FAQ-1" href="#FAQ">13 FAQ</a>
  <ul class="toc-numbered-mark">
    <li><a id="toc-_0060_0060Where-do-I-report-a-bug_003f_0027_0027" href="#Where-do-I-report-a-bug_003f">13.1 &ldquo;Where do I report a bug?&rdquo;</a></li>
    <li><a id="toc-Mailing-list-1" href="#Mailing-list">13.2 Mailing list</a></li>
    <li><a id="toc-_0060_0060What-has-changed-between-ASDF-1_002c-ASDF-2_002c-and-ASDF-3_003f_0027_0027" href="#What-has-changed-between-ASDF-1-ASDF-2-and-ASDF-3_003f">13.3 &ldquo;What has changed between ASDF 1, ASDF 2, and ASDF 3?&rdquo;</a>
    <ul class="toc-numbered-mark">
      <li><a id="toc-What-are-ASDF-1_002c-ASDF-2_002c-and-ASDF-3_003f" href="#What-are-ASDF-1-2-3_003f">13.3.1 What are ASDF 1, ASDF 2, and ASDF 3?</a></li>
      <li><a id="toc-How-do-I-detect-the-ASDF-version_003f-1" href="#How-do-I-detect-the-ASDF-version_003f">13.3.2 How do I detect the ASDF version?</a></li>
      <li><a id="toc-ASDF-can-portably-name-files-in-subdirectories-1" href="#ASDF-can-portably-name-files-in-subdirectories">13.3.3 ASDF can portably name files in subdirectories</a></li>
      <li><a id="toc-Output-translations-1" href="#Output-translations">13.3.4 Output translations</a></li>
      <li><a id="toc-Source-Registry-Configuration-1" href="#Source-Registry-Configuration">13.3.5 Source Registry Configuration</a></li>
      <li><a id="toc-Usual-operations-are-made-easier-to-the-user-1" href="#Usual-operations-are-made-easier-to-the-user">13.3.6 Usual operations are made easier to the user</a></li>
      <li><a id="toc-Many-bugs-have-been-fixed-1" href="#Many-bugs-have-been-fixed">13.3.7 Many bugs have been fixed</a></li>
      <li><a id="toc-ASDF-itself-is-versioned-1" href="#ASDF-itself-is-versioned">13.3.8 ASDF itself is versioned</a></li>
      <li><a id="toc-ASDF-can-be-upgraded-1" href="#ASDF-can-be-upgraded">13.3.9 ASDF can be upgraded</a></li>
      <li><a id="toc-Decoupled-release-cycle-1" href="#Decoupled-release-cycle">13.3.10 Decoupled release cycle</a></li>
      <li><a id="toc-Pitfalls-of-the-transition-to-ASDF-2-1" href="#Pitfalls-of-the-transition-to-ASDF-2">13.3.11 Pitfalls of the transition to ASDF 2</a></li>
      <li><a id="toc-Pitfalls-of-the-upgrade-to-ASDF-3-1" href="#Pitfalls-of-the-upgrade-to-ASDF-3">13.3.12 Pitfalls of the upgrade to ASDF 3</a></li>
      <li><a id="toc-What-happened-to-the-bundle-operations_003f" href="#What-happened-to-the-bundle-operations">13.3.13 What happened to the bundle operations?</a></li>
    </ul></li>
    <li><a id="toc-Issues-with-installing-the-proper-version-of-ASDF-1" href="#Issues-with-installing-the-proper-version-of-ASDF">13.4 Issues with installing the proper version of ASDF</a>
    <ul class="toc-numbered-mark">
      <li><a id="toc-_0060_0060My-Common-Lisp-implementation-comes-with-an-outdated-version-of-ASDF_002e-What-to-do_003f_0027_0027" href="#My-Common-Lisp-implementation-comes-with-an-outdated-version-of-ASDF_002e-What-to-do_003f">13.4.1 &ldquo;My Common Lisp implementation comes with an outdated version of ASDF. What to do?&rdquo;</a></li>
      <li><a id="toc-_0060_0060I_0027m-a-Common-Lisp-implementation-vendor_002e-When-and-how-should-I-upgrade-ASDF_003f_0027_0027" href="#I_0027m-a-Common-Lisp-implementation-vendor_002e-When-and-how-should-I-upgrade-ASDF_003f">13.4.2 &ldquo;I&rsquo;m a Common Lisp implementation vendor. When and how should I upgrade ASDF?&rdquo;</a></li>
      <li><a id="toc-After-upgrading-ASDF_002c-ASDF-_0028and-Quicklisp_0029-can_0027t-find-my-systems" href="#After-upgrading-ASDF">13.4.3 After upgrading ASDF, ASDF (and Quicklisp) can&rsquo;t find my systems</a></li>
    </ul></li>
    <li><a id="toc-Issues-with-configuring-ASDF-1" href="#Issues-with-configuring-ASDF">13.5 Issues with configuring ASDF</a>
    <ul class="toc-numbered-mark">
      <li><a id="toc-_0060_0060How-can-I-customize-where-fasl-files-are-stored_003f_0027_0027" href="#How-can-I-customize-where-fasl-files-are-stored_003f">13.5.1 &ldquo;How can I customize where fasl files are stored?&rdquo;</a></li>
      <li><a id="toc-_0060_0060How-can-I-wholly-disable-the-compiler-output-cache_003f_0027_0027" href="#How-can-I-wholly-disable-the-compiler-output-cache_003f">13.5.2 &ldquo;How can I wholly disable the compiler output cache?&rdquo;</a></li>
      <li><a id="toc-How-can-I-debug-problems-finding-ASDF-systems_003f" href="#How-can-I-debug-problems-finding-ASDF-systems">13.5.3 How can I debug problems finding ASDF systems?</a></li>
    </ul></li>
    <li><a id="toc-Issues-with-using-and-extending-ASDF-to-define-systems-1" href="#Issues-with-using-and-extending-ASDF-to-define-systems">13.6 Issues with using and extending ASDF to define systems</a>
    <ul class="toc-numbered-mark">
      <li><a id="toc-_0060_0060How-can-I-cater-for-unit_002dtesting-in-my-system_003f_0027_0027" href="#How-can-I-cater-for-unit_002dtesting-in-my-system_003f">13.6.1 &ldquo;How can I cater for unit-testing in my system?&rdquo;</a></li>
      <li><a id="toc-_0060_0060How-can-I-cater-for-documentation-generation-in-my-system_003f_0027_0027" href="#How-can-I-cater-for-documentation-generation-in-my-system_003f">13.6.2 &ldquo;How can I cater for documentation generation in my system?&rdquo;</a></li>
      <li><a id="toc-_0060_0060How-can-I-maintain-non_002dLisp-_0028e_002eg_002e-C_0029-source-files_003f_0027_0027" href="#How-can-I-maintain-non_002dLisp-_0028e_002eg_002e-C_0029-source-files_003f">13.6.3 &ldquo;How can I maintain non-Lisp (e.g. C) source files?&rdquo;</a></li>
      <li><a id="toc-_0060_0060I-want-to-put-my-module_0027s-files-at-the-top-level_002e-How-do-I-do-this_003f_0027_0027" href="#I-want-to-put-my-module_0027s-files-at-the-top-level_002e-How-do-I-do-this_003f">13.6.4 &ldquo;I want to put my module&rsquo;s files at the top level.  How do I do this?&rdquo;</a></li>
      <li><a id="toc-How-do-I-create-a-system-definition-where-all-the-source-files-have-a-_002ecl-extension_003f-1" href="#How-do-I-create-a-system-definition-where-all-the-source-files-have-a-_002ecl-extension_003f">13.6.5 How do I create a system definition where all the source files have a .cl extension?</a></li>
      <li><a id="toc-How-do-I-mark-a-source-file-to-be-loaded-only-and-not-compiled_003f-1" href="#How-do-I-mark-a-source-file-to-be-loaded-only-and-not-compiled_003f">13.6.6 How do I mark a source file to be loaded only and not compiled?</a></li>
      <li><a id="toc-How-do-I-work-with-readtables_003f-1" href="#How-do-I-work-with-readtables_003f">13.6.7 How do I work with readtables?</a>
      <ul class="toc-numbered-mark">
        <li><a id="toc-How-should-my-system-use-a-readtable-exported-by-another-system_003f" href="#How-should-my-system-use-a-readtable-exported-by-another-system_003f">13.6.7.1 How should my system use a readtable exported by another system?</a></li>
        <li><a id="toc-How-should-my-library-make-a-readtable-available-to-other-systems_003f" href="#How-should-my-library-make-a-readtable-available-to-other-systems_003f">13.6.7.2 How should my library make a readtable available to other systems?</a></li>
      </ul></li>
      <li><a id="toc-How-can-I-capture-ASDF_0027s-output_003f-1" href="#How-can-I-capture-ASDF_0027s-output_003f">13.6.8 How can I capture ASDF&rsquo;s output?</a></li>
      <li><a id="toc-_002aLOAD_002dPATHNAME_002a-and-_002aLOAD_002dTRUENAME_002a-have-weird-values_002c-help_0021" href="#LOAD_002dPATHNAME-has-a-weird-value">13.6.9 *LOAD-PATHNAME* and *LOAD-TRUENAME* have weird values, help!</a></li>
      <li><a id="toc-How-can-I-produce-a-binary-at-a-specific-path-from-sources-at-a-specific-path_003f" href="#How-can-I-produce-a-binary-at-a-specific-path-from-sources-at-a-specific-path">13.6.10 How can I produce a binary at a specific path from sources at a specific path?</a></li>
    </ul></li>
    <li><a id="toc-ASDF-development-FAQs-1" href="#ASDF-development-FAQs">13.7 ASDF development FAQs</a>
    <ul class="toc-numbered-mark">
      <li><a id="toc-How-do-I-run-the-tests-interactively-in-a-REPL_003f-1" href="#How-do-I-run-the-tests-interactively-in-a-REPL_003f">13.7.1 How do I run the tests interactively in a REPL?</a></li>
    </ul></li>
  </ul></li>
  <li><a id="toc-Ongoing-Work-1" href="#Ongoing-Work">Ongoing Work</a></li>
  <li><a id="toc-Bibliography-1" href="#Bibliography">Bibliography</a></li>
  <li><a id="toc-Concept-Index-1" href="#Concept-Index" rel="index">Concept Index</a></li>
  <li><a id="toc-Function-and-Macro-Index-1" href="#Function-and-Macro-Index" rel="index">Function and Macro Index</a></li>
  <li><a id="toc-Variable-Index-1" href="#Variable-Index" rel="index">Variable Index</a></li>
  <li><a id="toc-Class-and-Type-Index-1" href="#Class-and-Type-Index" rel="index">Class and Type Index</a></li>
</ul>
</div>
</div>
<hr>
<div class="chapter-level-extent" id="Introduction">
<h2 class="chapter" id="Introduction-1">1 Introduction</h2>
<a class="index-entry-id" id="index-ASDF_002drelated-features"></a>
<a class="index-entry-id" id="index-_002afeatures_002a-1"></a>
<a class="index-entry-id" id="index-Testing-for-ASDF"></a>
<a class="index-entry-id" id="index-ASDF-versions"></a>
<a class="index-entry-id" id="index-_003aasdf"></a>
<a class="index-entry-id" id="index-_003aasdf2"></a>
<a class="index-entry-id" id="index-_003aasdf3"></a>

<p>ASDF, or Another System Definition Facility, is a <em class="emph">build system</em>:
a tool for specifying how systems of Common Lisp software
are made up of components (sub-systems and files),
and how to operate on these components in the right order
so that they can be compiled, loaded, tested, etc.
If you are new to ASDF, see <a class="pxref" href="#Quick-start-summary">the quick start
guide</a>.
</p>
<p>ASDF presents three faces:
one for users of Common Lisp software who want to reuse other people&rsquo;s code,
one for writers of Common Lisp software who want to specify how to build their systems,
and one for implementers of Common Lisp extensions who want to extend
the build system.
For more specifics,
see <a class="pxref" href="#Using-ASDF">Using ASDF</a>,
to learn how to use ASDF to load a system.
See <a class="xref" href="#Defining-systems-with-defsystem">Defining systems with defsystem</a>,
to learn how to define a system of your own.
See <a class="xref" href="#The-object-model-of-ASDF">The Object model of ASDF</a>, for a description of
the ASDF internals and how to extend ASDF.
</p>
<p>Note that
ASDF is <em class="emph">not</em> a tool for library and system <em class="emph">installation</em>;
it plays a role like <code class="code">make</code> or <code class="code">ant</code>, not like a package manager.
In particular, ASDF should not to be confused with Quicklisp or ASDF-Install,
that attempt to find and download ASDF systems for you.
Despite what the name might suggest,
ASDF-Install was never a part of ASDF; it was always a separate piece of software.
ASDF-Install has also been unmaintained and obsolete for a very long time.
We recommend you use Quicklisp
(<a class="uref" href="http://www.quicklisp.org/">http://www.quicklisp.org/</a>) instead,
a Common Lisp package manager which works well and is being actively maintained.
If you want to download software from version control instead of tarballs,
so you may more easily modify it,
we recommend clbuild (<a class="uref" href="http://common-lisp.net/project/clbuild/">http://common-lisp.net/project/clbuild/</a>).
As for where on your filesystem to install Common Lisp software,
we recommend subdirectories of <samp class="file">~/common-lisp/</samp>:
starting with ASDF 3.1.2 (2014), this hierarchy is included
in the default source-registry configuration.
</p>
<p>Finally, note that this manual is incomplete.
All the bases are covered,
but many advanced topics are only barely alluded to,
and there is not much in terms of examples.
The source code remains the ultimate source of information,
free software systems in Quicklisp remain the best source of examples,
and the mailing-list the best place to ask for help.
</p>

<hr>
</div>
<div class="chapter-level-extent" id="Quick-start-summary">
<h2 class="chapter" id="Quick-start-summary-1">2 Quick start summary</h2>

<ul class="itemize mark-bullet">
<li>To load an ASDF system:

<ul class="itemize mark-bullet">
<li>Load ASDF itself into your Lisp image, using
<code class="code">(require &quot;asdf&quot;)</code>.
Check that you have a recent version using <code class="code">(asdf:asdf-version)</code>.
For more details, or if any of the above fails, see <a class="pxref" href="#Loading-ASDF">Loading ASDF</a>.

</li><li>Make sure software is installed where ASDF can find it.
The simplest way is to put all your Lisp code in subdirectories of
<samp class="file">~/common-lisp/</samp> (starting with ASDF 3.1.2),
or <samp class="file">~/.local/share/common-lisp/source/</samp>
(for ASDF 2 and later, or if you want to keep source in a hidden directory).
For more details, see <a class="pxref" href="#Configuring-ASDF-to-find-your-systems">Configuring ASDF to find your systems</a>.

</li><li>Load your system with <code class="code">(asdf:load-system &quot;<var class="var">my-system</var>&quot;)</code>.
See <a class="xref" href="#Using-ASDF">Using ASDF</a>.

</li></ul>

</li><li>To make your own ASDF system:

<ul class="itemize mark-bullet">
<li>As above, load and configure ASDF.

</li><li>Make a new directory for your system, <code class="code"><var class="var">my-system</var>/</code>,
again in a location where ASDF can find it.
All else being equal, the easiest location is probably
<samp class="file">~/common-lisp/my-system/</samp>.
See <a class="xref" href="#Configuring-ASDF-to-find-your-systems">Configuring ASDF to find your systems</a>.


</li><li>Create an ASDF system definition listing the dependencies of
your system, its components, and their interdependencies,
and put it in <samp class="file"><var class="var">my-system</var>.asd</samp>.
This file must have the same name as your system, all lowercase.
See <a class="xref" href="#Defining-systems-with-defsystem">Defining systems with defsystem</a>.

</li><li>Use <code class="code">(asdf:load-system &quot;<var class="var">my-system</var>&quot;)</code>
to make sure it&rsquo;s all working properly. See <a class="xref" href="#Using-ASDF">Using ASDF</a>.

</li></ul>
</li></ul>






<hr>
</div>
<div class="chapter-level-extent" id="Loading-ASDF">
<h2 class="chapter" id="Loading-ASDF-1">3 Loading ASDF</h2>


<hr>
<div class="section-level-extent" id="Loading-a-pre_002dinstalled-ASDF">
<h3 class="section" id="Loading-a-pre_002dinstalled-ASDF-1">3.1 Loading a pre-installed ASDF</h3>

<p>The recommended way to load ASDF is via:
</p><div class="example lisp">
<pre class="lisp-preformatted">(require &quot;asdf&quot;)
</pre></div>

<p>All actively maintained Lisp implementations now include a copy of ASDF 3
that you can load this way using Common Lisp&rsquo;s <code class="code">require</code> function.<a class="footnote" id="DOCF1" href="#FOOT1"><sup>1</sup></a>
</p>
<p>If the implementation you are using doesn&rsquo;t provide a recent ASDF 3,
we recommend you upgrade it.
If for some reason you would rather not upgrade it,
we recommend you replace your implementation&rsquo;s ASDF.
See <a class="xref" href="#Replacing-your-implementation_0027s-ASDF">Replacing your implementation&rsquo;s ASDF</a>.
If all else fails, see see <a class="pxref" href="#Loading-ASDF-from-source">Loading ASDF from source</a> below.
</p>
<p>If you use an actively maintained implementation that fails to provide
an up-to-date enough stable release of ASDF,
you may also send a bug report to your Lisp vendor and complain about it
&mdash; or you may fix the issue yourself if it&rsquo;s free software.
</p>
<p>As of the writing of this manual,
the following implementations provide ASDF 3 this way:
ABCL, Allegro CL, CLASP, Clozure CL, CMUCL, ECL, GNU CLISP, LispWorks, MKCL, SBCL.
The following implementations only provide ASDF 2:
MOCL, XCL.
The following implementations don&rsquo;t provide ASDF:
Corman CL, GCL, Genera, MCL, SCL.
The latter implementations are not actively maintained (except maybe GCL);
if some of them are ever released again, they probably will include ASDF 3.
</p>
<p>For maximum convenience you might want to have ASDF loaded
whenever you start your Lisp implementation,
for example by loading it from the startup script or dumping a custom core
&mdash; check your Lisp implementation&rsquo;s manual for details.
SLIME notably sports a <code class="code">slime-asdf</code> contrib that makes life easier with ASDF.
</p>

<hr>
</div>
<div class="section-level-extent" id="Checking-whether-ASDF-is-loaded">
<h3 class="section" id="Checking-whether-ASDF-is-loaded-1">3.2 Checking whether ASDF is loaded</h3>

<p>To check that ASDF is properly loaded, you can run this form:
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(asdf:asdf-version)
</pre></div>

<p>If it returns a string,
that is the version of ASDF that is currently installed.
If that version is suitably recent (say, 3.1.2 or later),
then you can skip directly to next chapter: See <a class="xref" href="#Configuring-ASDF">Configuring ASDF</a>.
</p>
<p>If it raises an error,
then either ASDF is not loaded, or
you are using a very old version of ASDF,
and need to install ASDF 3.
</p>
<p>For more precision in detecting versions old and new,
see <a class="pxref" href="#How-do-I-detect-the-ASDF-version_003f">How do I detect the ASDF version?</a>.
</p>
<p>If you are experiencing problems with ASDF,
please try upgrading to the latest released version,
using the method below,
before you contact us and raise an issue.
</p>
<hr>
</div>
<div class="section-level-extent" id="Upgrading-ASDF">
<h3 class="section" id="Upgrading-ASDF-1">3.3 Upgrading ASDF</h3>

<p>If your implementation already provides ASDF 3 or later (and it should),
but you want a more recent ASDF version than your implementation provides, then
you just need to ensure the more recent ASDF is installed in a configured path,
like any other system.
We recommend you download an official tarball or checkout a release from git into
<samp class="file">~/common-lisp/asdf/</samp>.
(see <a class="pxref" href="#Configuring-ASDF-to-find-your-systems">Configuring ASDF to find your systems</a>).
</p>
<p>Once the source code for ASDF is installed,
you don&rsquo;t need any extra step to load it beyond the usual <code class="code">(require &quot;asdf&quot;)</code>:
ASDF 3 will automatically look whether an updated version of itself is available
amongst the regularly configured systems, before it compiles anything else.
</p>
<p>If your implementation fails to provide ASDF 3 or later,
see <a class="pxref" href="#Replacing-your-implementation_0027s-ASDF">Replacing your implementation&rsquo;s ASDF</a>.
</p>

<hr>
</div>
<div class="section-level-extent" id="Replacing-your-implementation_0027s-ASDF">
<h3 class="section" id="Replacing-your-implementation_0027s-ASDF-1">3.4 Replacing your implementation&rsquo;s ASDF</h3>

<p>All maintained implementations now provide ASDF 3 in their latest release.
If yours doesn&rsquo;t, we recommend you upgrade it.
</p>
<p>Now, if you insist on using an old implementation
that didn&rsquo;t provide ASDF or provided an old version,
we recommend installing a recent ASDF, as explained below,
into your implementation&rsquo;s installation directory.
Thus your modified implementation will now provide ASDF 3.
This requires proper write permissions and
may necessitate execution as a system administrator.
</p>
<p>The ASDF source repository contains a tool to
help you upgrade your implementation&rsquo;s ASDF.
You can invoke it from the shell command-line as
<code class="code">tools/asdf-tools install-asdf lispworks</code>
(where you can replace <code class="code">lispworks</code> by the name of the relevant implementation),
or you can <code class="code">(load &quot;tools/install-asdf.lisp&quot;)</code> from your Lisp REPL.
</p>
<p>This script works on
Allegro CL, Clozure CL, CMU CL, ECL, GCL, GNU CLISP, LispWorks, MKCL, SBCL, SCL, XCL.
It doesn&rsquo;t work on ABCL, Corman CL, Genera, MCL, MOCL.
Happily, ABCL is usually pretty up to date and shouldn&rsquo;t need that script.
GCL requires a very recent version, and hasn&rsquo;t been tested much.
Corman CL, Genera, MCL are obsolete anyway.
MOCL is incomplete.
</p>

<hr>
</div>
<div class="section-level-extent" id="Loading-ASDF-from-source">
<h3 class="section" id="Loading-ASDF-from-source-1">3.5 Loading ASDF from source</h3>

<p>If you write build scripts that must remain portable to old machines with old implementations
that you cannot ensure have been upgraded or modified to provide a recent ASDF,
you may have to install the file <samp class="file">asdf.lisp</samp>
somewhere and load it with:
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(load &quot;/path/to/your/installed/asdf.lisp&quot;)
</pre></div>

<p>The single file <samp class="file">asdf.lisp</samp> is all you normally need to use ASDF.
</p>
<p>You can extract this file from latest release tarball on the
<a class="url" href="https://common-lisp.net/project/asdf/">ASDF website</a>.
If you are daring and willing to report bugs, you can get
the latest and greatest version of ASDF from its git repository.
See <a class="xref" href="#Getting-the-latest-version">Getting the latest version</a>.
</p>
<p>For scripts that try to use ASDF simply via <code class="code">require</code> at first, and
make heroic attempts to load it the hard way if at first they don&rsquo;t succeed,
see <samp class="file">tools/load-asdf.lisp</samp> distributed with the ASDF source repository,
or the code of <a class="url" href="https://cliki.net/cl-launch"><code class="code">cl-launch</code></a>.
</p>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="Configuring-ASDF">
<h2 class="chapter" id="Configuring-ASDF-1">4 Configuring ASDF</h2>

<p>For standard use cases, ASDF should work pretty much out of the box.
We recommend you skim the sections on configuring ASDF to find your systems
and choose the method of installing Lisp software that works best for you.
Then skip directly to See <a class="xref" href="#Using-ASDF">Using ASDF</a>. That will probably be enough.
You are unlikely to have to worry about the way ASDF stores object files,
and resetting the ASDF configuration is usually only needed in corner cases.
</p>


<hr>
<div class="section-level-extent" id="Configuring-ASDF-to-find-your-systems">
<h3 class="section" id="Configuring-ASDF-to-find-your-systems-1">4.1 Configuring ASDF to find your systems</h3>

<p>In order to compile and load your systems, ASDF must be configured to find
the <samp class="file">.asd</samp> files that contain system definitions.
</p>
<p>There are a number of different techniques for setting yourself up with
ASDF, starting from easiest to the most complex:
</p>
<ul class="itemize mark-bullet">
<li>Put all of your systems in one of the standard locations,
subdirectories of
<ul class="itemize mark-bullet">
<li><samp class="file">~/common-lisp/</samp> or
</li><li><samp class="file">~/.local/share/common-lisp/source/</samp>.
</li></ul>
<p>If you install software there, you don&rsquo;t need further
configuration.<a class="footnote" id="DOCF2" href="#FOOT2"><sup>2</sup></a>
You can then skip to the next section. See <a class="xref" href="#Loading-a-system">Loading a system</a>.
</p>
</li><li>If you&rsquo;re using some tool to install software (e.g. Quicklisp),
the authors of that tool should already have configured ASDF.

</li><li>If you have more specific desires about how to lay out your software on
disk, the preferred way to configure where ASDF finds your systems is
the <code class="code">source-registry</code> facility,
fully described in its own chapter of this manual.
See <a class="xref" href="#Controlling-where-ASDF-searches-for-systems">Controlling where ASDF searches for systems</a>.
Here is a quick recipe for getting started.

<p>First create the directory
<samp class="file">~/.config/common-lisp/source-registry.conf.d/</samp><a class="footnote" id="DOCF3" href="#FOOT3"><sup>3</sup></a>;
there create a file with any name of your choice
but with the type <samp class="file">conf</samp><a class="footnote" id="DOCF4" href="#FOOT4"><sup>4</sup></a>,
for instance <samp class="file">50-luser-lisp.conf</samp>;
in this file, add the following line
to tell ASDF to recursively scan all the subdirectories under <samp class="file">/home/luser/lisp/</samp>
for <samp class="file">.asd</samp> files:
<kbd class="kbd">(:tree &quot;/home/luser/lisp/&quot;)</kbd>
</p>
<p>That&rsquo;s enough. You may replace <samp class="file">/home/luser/lisp/</samp> by wherever you want to install your source code.
You don&rsquo;t actually need to specify anything if you use the default <samp class="file">~/common-lisp/</samp> as above
and your implementation provides ASDF 3.1.2 or later.
If your implementation provides an earlier variant of ASDF 3,
you might want to specify <kbd class="kbd">(:tree (:home &quot;common-lisp/&quot;))</kbd> for bootstrap purposes,
then install a recent source tree of ASDF under <samp class="file">~/common-lisp/asdf/</samp>.
</p>
<p>If you prefer to use a &ldquo;link farm&rdquo;, which is faster to use but costlier to manage than a recursive traversal,
say at <samp class="file">/home/luser/.asd-link-farm/</samp>, then
you may instead (or additionally) create a file <samp class="file">42-asd-link-farm.conf</samp>, containing the line:
<kbd class="kbd">(:directory &quot;/home/luser/.asd-link-farm/&quot;)</kbd>
</p>
<p>ASDF will automatically read your configuration
the first time you try to find a system.
If necessary, you can reset the source-registry configuration with:
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(asdf:clear-source-registry)
</pre></div>

</li><li>In earlier versions of ASDF, the system source registry was configured
using a global variable, <code class="code">asdf:*central-registry*</code>.
For more details about this, see the following section,
<a class="ref" href="#Configuring-ASDF-to-find-your-systems-_002d_002d_002d-old-style">Configuring ASDF to find your systems &mdash; old style</a>.
Unless you need to understand this,
skip directly to <a class="ref" href="#Configuring-where-ASDF-stores-object-files">Configuring where ASDF stores object files</a>.

</li></ul>

<p>Note that your Operating System distribution or your system administrator
may already have configured system-managed libraries for you.
</p>


<hr>
</div>
<div class="section-level-extent" id="Configuring-ASDF-to-find-your-systems-_002d_002d_002d-old-style">
<h3 class="section" id="Configuring-ASDF-to-find-your-systems-_002d_002d_002d-old-style-1">4.2 Configuring ASDF to find your systems &mdash; old style</h3>



<p>Novices may skip this section.
Please <em class="emph">do not</em> use the central-registry if you are a novice,
and <em class="emph">do not</em> instruct novices to use the central-registry.
</p>
<p>The old way to configure ASDF to find your systems is by
<code class="code">push</code>ing directory pathnames onto the variable
<code class="code">asdf:*central-registry*</code>.
</p>
<p>You <em class="emph">must</em> configure this variable <em class="emph">after</em> you load ASDF 3 or later,
yet <em class="emph">before</em> the first time you try to use it.
This loading and configuring of ASDF must happen
as part of some initialization script:
typically, either a script you maintain that builds your project,
or your implementation&rsquo;s initialization script
(e.g. <samp class="file">~/.sbclrc</samp> for SBCL).
</p>
<p>Also, if you are using an ancient ASDF 2 or earlier to load ASDF 3 or later,
then after it loads the ancient ASDF, your script <em class="emph">must</em> configure
the central-registry a first time to tell ASDF 1 or 2 where to find ASDF 3,
then load ASDF 3 with e.g. <code class="code">(asdf:operate 'asdf:load-op &quot;asdf&quot;)</code>,
then configure the central-registry again, because
ASDF 3 will not preserve the central-registry from ASDF 2 when upgrading.
You should probably be using the source-registry instead, which will be preserved
(unless you manually called <code class="code">asdf:initialize-source-registry</code> with an argument,
in which case you will have to do it again indeed).
However, if you are using an ancient ASDF 2 or earlier,
we <em class="emph">strongly</em> recommend that you should instead upgrade your implementation,
or overwrite the ancient ASDF installation with a more recent one:
See <a class="xref" href="#Replacing-your-implementation_0027s-ASDF">Replacing your implementation&rsquo;s ASDF</a>.
</p>
<p>The <code class="code">asdf:*central-registry*</code> is empty by default in ASDF 2 or ASDF 3,
but is still supported for compatibility with ASDF 1.
When used, it takes precedence over the above source-registry.<a class="footnote" id="DOCF5" href="#FOOT5"><sup>5</sup></a>
</p>
<p>For example, let&rsquo;s say you want ASDF to find the <samp class="file">.asd</samp> file
<samp class="file">/home/me/src/foo/foo.asd</samp>.
In your Lisp initialization file, you could have the following:
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(require &quot;asdf&quot;)
(push &quot;/home/me/src/foo/&quot; asdf:*central-registry*)
</pre></div>

<p>Note the trailing slash: when searching for a system,
ASDF will evaluate each entry of the central registry
and coerce the result to a pathname.<a class="footnote" id="DOCF6" href="#FOOT6"><sup>6</sup></a>
The trailing directory name separator
is necessary to tell Lisp that you&rsquo;re discussing a directory
rather than a file.  If you leave it out, ASDF is likely to look in
<code class="code">/home/me/src/</code> instead of <code class="code">/home/me/src/foo/</code> as you
intended, and fail to find your system definition.
Modern versions of ASDF will issue an error and offer you to
remove such entries from the central-registry.
</p>
<p>Typically there are a lot of <samp class="file">.asd</samp> files, and
a common idiom was to put
<em class="emph">symbolic links</em> to all of one&rsquo;s <samp class="file">.asd</samp> files
in a common directory
and push <em class="emph">that</em> directory (the &ldquo;link farm&rdquo;)
onto
<code class="code">asdf:*central-registry*</code>,
instead of pushing each individual system directory.
</p>
<p>ASDF knows to follow <em class="emph">symlinks</em>
to the actual location of the systems.<a class="footnote" id="DOCF7" href="#FOOT7"><sup>7</sup></a>
</p>
<p>For example, if <code class="code">#p&quot;/home/me/cl/systems/&quot;</code>
is an element of <code class="code">*central-registry*</code>, you could set up the
system <var class="var">foo</var> as follows:
</p>
<div class="example">
<pre class="example-preformatted">$ cd /home/me/cl/systems/
$ ln -s ~/src/foo/foo.asd .
</pre></div>

<p>This old style for configuring ASDF is not recommended for new users,
but it is supported for old users, and for users who want a simple way to
programmatically control what directories are added to the ASDF search path.
</p>

<hr>
</div>
<div class="section-level-extent" id="Configuring-where-ASDF-stores-object-files">
<h3 class="section" id="Configuring-where-ASDF-stores-object-files-1">4.3 Configuring where ASDF stores object files</h3>
<a class="index-entry-id" id="index-clear_002doutput_002dtranslations"></a>

<p>ASDF lets you configure where object files will be stored.
Sensible defaults are provided and
you shouldn&rsquo;t normally have to worry about it.
</p>
<p>This allows the same source code repository to be shared
between several versions of several Common Lisp implementations,
between several users using different compilation options,
with users who lack write privileges on shared source directories, etc.
This also keeps source directories from being cluttered
with object/fasl files.
</p>
<p>Starting with ASDF 2, the <code class="code">asdf-output-translations</code> facility
was added to ASDF itself.  This facility controls where object files will be stored.
This facility is fully described in a chapter of this manual,
<a class="ref" href="#Controlling-where-ASDF-saves-compiled-files">Controlling where ASDF saves compiled files</a>.
</p>











<p>Note that before ASDF 2,
other ASDF add-ons offered the same functionality,
each in subtly different and incompatible ways:
ASDF-Binary-Locations, cl-launch, common-lisp-controller.
ASDF-Binary-Locations is now not needed anymore and should not be used.
cl-launch 3.000 and common-lisp-controller 7.2 have been updated
to delegate object file placement to ASDF.
</p>
<hr>
</div>
<div class="section-level-extent" id="Resetting-the-ASDF-configuration">
<h3 class="section" id="Resetting-the-ASDF-configuration-1">4.4 Resetting the ASDF configuration</h3>



<p>When you dump and restore an image, or when you tweak your configuration,
you may want to reset the ASDF configuration.
For that you may use the following function:
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-clear_002dconfiguration"><span class="category-def">Function: </span><span><strong class="def-name">clear-configuration</strong><a class="copiable-link" href='#index-clear_002dconfiguration'> &para;</a></span></dt>
<dd><p>Undoes any ASDF configuration
   regarding source-registry or output-translations.
</p></dd></dl>

<a class="index-entry-id" id="index-_002aimage_002ddump_002dhook_002a"></a>
<p>This function is pushed onto the <code class="code">uiop:*image-dump-hook*</code> by default,
which means that if you save an image using <code class="code">uiop:dump-image</code>,
or via <code class="code">asdf:image-op</code> and <code class="code">asdf:program-op</code>,
it will be automatically called to clear your configuration.
If for some reason you prefer to call your implementation&rsquo;s underlying functionality,
be sure to call <code class="code">clear-configuration</code> manually,
or push it into your implementation&rsquo;s equivalent of <code class="code">uiop:*image-dump-hook*</code>,
e.g. <code class="code">sb-ext:*save-hooks*</code> on SBCL, or <code class="code">ext:*before-save-initializations*</code>
on CMUCL and SCL, etc.
</p>
<hr>
</div>
</div>
<div class="chapter-level-extent" id="Using-ASDF">
<h2 class="chapter" id="Using-ASDF-1">5 Using ASDF</h2>


<hr>
<div class="section-level-extent" id="Loading-a-system">
<h3 class="section" id="Loading-a-system-1">5.1 Loading a system</h3>

<p>The system <var class="var">foo</var> is loaded (and compiled, if necessary)
by evaluating the following Lisp form:
</p>
<div class="example">
<pre class="example-preformatted">(asdf:load-system :<var class="var">foo</var>)
</pre></div>

<p>On some implementations (see <a class="pxref" href="#Convenience-Functions">Convenience Functions</a>),
ASDF hooks into the <code class="code">cl:require</code> facility and you can just use:
</p>
<div class="example">
<pre class="example-preformatted">(require :<var class="var">foo</var>)
</pre></div>

<p>Note that the canonical name of a system is a string, in <em class="emph">lowercase</em>.
System names can also be specified as symbols (including keyword
symbols).
If a symbol is given as argument, its package is ignored,
its <code class="code">symbol-name</code> is taken, and converted to lowercase.
The name must be a suitable value for the <code class="code">:name</code> initarg
to <code class="code">make-pathname</code> in whatever filesystem the system is to be found.
</p>
<p>Using lowercase as canonical is unconventional,
but was selected after some consideration.
The type of file systems we  support
either have lowercase as customary case (Unix, Mac, Windows)
or silently convert lowercase to uppercase (lpns).
</p>

<hr>
</div>
<div class="section-level-extent" id="Convenience-Functions">
<h3 class="section" id="Convenience-Functions-1">5.2 Convenience Functions</h3>


<p>ASDF provides three commands for the most common system operations:
<code class="code">load-system</code>, <code class="code">compile-system</code>, and <code class="code">test-system</code>.
</p>
<p>ASDF also provides <code class="code">require-system</code>, a variant of <code class="code">load-system</code>
that skips loading systems that are already loaded.  This is sometimes
useful, for example, in order to avoid re-loading libraries that come
pre-loaded into your  lisp implementation.
</p>
<p>ASDF also provides <code class="code">make</code>, a way of allowing system developers to
choose a default operation for their systems.  For example, a developer
who has created a system intended to format a specific document, might
make document-formatting the default operation invoked by <code class="code">make</code>,
instead of loading.  If the system developer doesn&rsquo;t specify in the
system definition, the default operation will be loading.
</p>


<a class="index-entry-id" id="index-operate"></a>
<a class="index-entry-id" id="index-oos"></a>

<p>Because ASDF is an extensible system
for defining <em class="emph">operations</em> on <em class="emph">components</em>,
it also provides a generic function <code class="code">operate</code>,
so you may arbitrarily operate on your systems beyond the default operations.
(At the interactive REPL, users often use its shorter alias <code class="code">oos</code>,
which stands for <code class="code">operate-on-system</code>, a name inherited from <code class="code">mk-defsystem</code>.)
You&rsquo;ll use <code class="code">operate</code> whenever you want to do something beyond
compiling, loading and testing.
</p>


<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-load_002dsystem"><span class="category-def">Function: </span><span><strong class="def-name">load-system</strong> <var class="def-var-arguments">system &amp;rest keys &amp;key force force-not verbose version &amp;allow-other-keys</var><a class="copiable-link" href='#index-load_002dsystem'> &para;</a></span></dt>
<dd><p>Apply <code class="code">operate</code> with the operation <code class="code">load-op</code>, the
<var class="var">system</var>, and any provided keyword arguments.  Calling
<code class="code">load-system</code> is the regular, recommended way to load a system
into the current image.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-compile_002dsystem"><span class="category-def">Function: </span><span><strong class="def-name">compile-system</strong> <var class="def-var-arguments">system &amp;rest keys &amp;key force force-not verbose version &amp;allow-other-keys</var><a class="copiable-link" href='#index-compile_002dsystem'> &para;</a></span></dt>
<dd><p>Apply <code class="code">operate</code> with the operation <code class="code">compile-op</code>,
the <var class="var">system</var>, and any provided keyword arguments.
This will make sure all the files in the system are compiled,
but not necessarily load any of them in the current image;
on most systems, it will <em class="emph">not</em> load all compiled files in the current image.
This function exists for symmetry with <code class="code">load-system</code> but is not recommended
unless you are writing build scripts and know what you&rsquo;re doing.
But then, you might be interested in <code class="code">program-op</code> rather than <code class="code">compile-op</code>.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-test_002dsystem"><span class="category-def">Function: </span><span><strong class="def-name">test-system</strong> <var class="def-var-arguments">system &amp;rest keys &amp;key force force-not verbose version &amp;allow-other-keys</var><a class="copiable-link" href='#index-test_002dsystem'> &para;</a></span></dt>
<dd><p>Apply <code class="code">operate</code> with the operation <code class="code">test-op</code>,
the <var class="var">system</var>, and any provided keyword arguments.
See <a class="xref" href="#test_002dop">test-op</a>.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-make"><span class="category-def">Function: </span><span><strong class="def-name">make</strong> <var class="def-var-arguments">system &amp;rest keys &amp;key &amp;allow-other-keys</var><a class="copiable-link" href='#index-make'> &para;</a></span></dt>
<dd><p>Do &ldquo;The Right Thing&rdquo; with your system.
Starting with ASDF 3.1, this function <code class="code">make</code> is also available.
The default behaviour is to load the system as if by <code class="code">load-system</code>;
but system authors can override this default in their system definition
they may specify an alternate operation as the intended use of their system,
with a <code class="code">:build-operation</code> option in the <code class="code">defsystem</code> form
(see <a class="pxref" href="#Build_002doperation">Build-operation</a>),
and an intended output pathname for that operation with
<code class="code">:build-pathname</code>.
This function is experimental and largely untested.  Use at your own risk.
</p></dd></dl>
<a class="index-entry-id" id="index-build_002doperation"></a>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-require_002dsystem"><span class="category-def">Function: </span><span><strong class="def-name">require-system</strong> <var class="def-var-arguments">system &amp;rest keys &amp;key &amp;allow-other-keys</var><a class="copiable-link" href='#index-require_002dsystem'> &para;</a></span></dt>
<dd><p><code class="code">require-system</code> skips any update to systems that have already been loaded,
in the spirit of <code class="code">cl:require</code>.
It does it by calling <code class="code">load-system</code> with a keyword option
excluding already loaded systems.<a class="footnote" id="DOCF8" href="#FOOT8"><sup>8</sup></a>.
On actively maintained free software implementations
(namely recent versions of ABCL, Clozure CL, CMUCL, ECL, GNU CLISP, MKCL and SBCL),
once ASDF itself is loaded, <code class="code">cl:require</code> too can load ASDF systems,
by falling back on <code class="code">require-system</code>
for module names not recognized by the implementation.
(Note however that <code class="code">require-system</code> does <em class="emph">not</em> fall back on <code class="code">cl:require</code>;
that would introduce an &ldquo;interesting&rdquo; potential infinite loop to break somehow.)
</p>
<p><code class="code">cl:require</code> and <code class="code">require-system</code> are appropriate to load code
that is not being modified during the current programming session.
<code class="code">cl:require</code> will notably load the implementation-provided extension modules;
<code class="code">require-system</code> won&rsquo;t, unless they are also defined as systems somehow,
which SBCL and MKCL do.
<code class="code">require-system</code> may also be used to load any number of ASDF systems
that the user isn&rsquo;t either developing or debugging,
for which a previously installed version is deemed to be satisfactory;
<code class="code">cl:require</code> on the above-mentioned implementations will delegate to <code class="code">require-system</code>
and may load them as well.
But for code that you are actively developing, debugging, or otherwise modifying,
you should use <code class="code">load-system</code>, so ASDF will pick on your modifications
and transitively re-build the modified files and everything that depends on them
(that the requested <var class="var">system</var> itself depends on &mdash;
ASDF itself never builds anything unless
it&rsquo;s an explicitly requested system or the dependencies thereof).
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-already_002dloaded_002dsystems"><span class="category-def">Function: </span><span><strong class="def-name">already-loaded-systems</strong><a class="copiable-link" href='#index-already_002dloaded_002dsystems'> &para;</a></span></dt>
<dd><p>Returns a list of names of the systems that have been successfully
loaded so far.
</p></dd></dl>




<hr>
</div>
<div class="section-level-extent" id="Moving-on">
<h3 class="section" id="Moving-on-1">5.3 Moving on</h3>

<p>That&rsquo;s all you need to know to use ASDF to load systems written by others.
The rest of this manual deals with writing system definitions
for Common Lisp software you write yourself,
including how to extend ASDF to define new operation and component types.
</p>

<hr>
</div>
</div>
<div class="chapter-level-extent" id="Defining-systems-with-defsystem">
<h2 class="chapter" id="Defining-systems-with-defsystem-1">6 Defining systems with defsystem</h2>

<p>This chapter describes how to use ASDF to define systems and develop
software.
</p>


<hr>
<div class="section-level-extent" id="The-defsystem-form">
<h3 class="section" id="The-defsystem-form-1">6.1 The defsystem form</h3>
<a class="index-entry-id" id="index-defsystem"></a>
<a class="index-entry-id" id="index-asdf_002duser"></a>
<a class="index-entry-id" id="index-load_002dasd"></a>

<p>This section begins with an example of a system definition,
then gives the full grammar of <code class="code">defsystem</code>.
</p>
<p>Let&rsquo;s look at a simple system.
This is a complete file that should be saved as <samp class="file">hello-lisp.asd</samp>
(in order that ASDF can find it
when ordered to operate on the system named <code class="code">&quot;hello-lisp&quot;</code>).
</p>
<div class="example lisp">
<pre class="lisp-preformatted">;; Usual Lisp comments are allowed here

(defsystem &quot;hello-lisp&quot;
  :description &quot;hello-lisp: a sample Lisp system.&quot;
  :version &quot;0.0.1&quot;
  :author &quot;Joe User &lt;joe@example.com&gt;&quot;
  :licence &quot;Public Domain&quot;
  :depends-on (&quot;optima.ppcre&quot; &quot;command-line-arguments&quot;)
  :components ((:file &quot;packages&quot;)
               (:file &quot;macros&quot; :depends-on (&quot;packages&quot;))
               (:file &quot;hello&quot; :depends-on (&quot;macros&quot;))))
</pre></div>

<p>Some notes about this example:
</p>
<ul class="itemize mark-bullet">
<li>The <code class="code">defsystem</code> form defines a system named <code class="code">hello-lisp</code>
that contains three source files:
<samp class="file">packages.lisp</samp>, <samp class="file">macros.lisp</samp> and <samp class="file">hello.lisp</samp>.

</li><li>The <samp class="file">.lisp</samp> suffix is implicit for Lisp source files.
The source files are located in the same directory
as the <code class="code">.asd</code> file with the system definition.

</li><li>The file <samp class="file">macros</samp> depends on <samp class="file">packages</samp>
(presumably because the package it&rsquo;s in is defined in <samp class="file">packages</samp>),
and the file <samp class="file">hello</samp> depends on <samp class="file">macros</samp>
(and hence, transitively on <samp class="file">packages</samp>).
This means that ASDF will compile and load <samp class="file">packages</samp> then <samp class="file">macros</samp>
before starting the compilation of file <samp class="file">hello</samp>.

</li><li>This example system has external dependencies on two other systems,
<code class="code">optima.ppcre</code> (that provides a friendly interface to matching regular expressions),
and <code class="code">command-line-arguments</code> (that provides a way to parse arguments passed from the shell command line).
To use this system, ASDF must be configured to find installed copies of these systems;
it will load them before it tries to compile and load <code class="code">hello-lisp</code>.

</li><li>This system also defines a bunch of metadata.
While it is optional to define these fields
(and other fields like <code class="code">:bug-tracker</code>, <code class="code">:mailto</code>, <code class="code">:long-name</code>,
<code class="code">:long-description</code>, <code class="code">:source-control</code>),
it is strongly recommended to define the fields <code class="code">:description</code>, <code class="code">:version</code>, <code class="code">:author</code>, and <code class="code">:licence</code>,
especially if you intend your software to be eventually included in Quicklisp.

</li><li>Make sure you know how the <code class="code">:version</code> numbers will be parsed!
Only period-separated non-negative integers are accepted at present.
See <a class="xref" href="#Version-specifiers">Version specifiers</a>.

</li><li>This file contains a single form, the <code class="code">defsystem</code> declaration.
No <code class="code">in-package</code> form, no <code class="code">asdf:</code> package prefix, no nothing.
Just the one naked <code class="code">defsystem</code> form.
This is what we recommend.
More complex system definition files are possible with arbitrary Lisp code,
but we recommend that you keep it simple if you can.
This will make your system definitions more robust and more future-proof.

<a class="index-entry-id" id="index-_003aversion"></a>

</li></ul>

<p>This is all you need to know to define simple systems.
The next example is much more involved, to give you a glimpse of how you can do more complex things.
However, since it&rsquo;s ultimately arbitrary Lisp code, there is no bottom to the rabbit hole.
</p>

<hr>
</div>
<div class="section-level-extent" id="A-more-involved-example">
<h3 class="section" id="A-more-involved-example-1">6.2 A more involved example</h3>
<a class="index-entry-id" id="index-defsystem-1"></a>

<p>Let&rsquo;s illustrate some more involved uses of <code class="code">defsystem</code> via a
slightly convoluted example:
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(in-package :asdf-user)

(defsystem &quot;foo&quot;
  :version (:read-file-form &quot;variables&quot; :at (3 2))
  :components
  ((:file &quot;package&quot;)
   (:file &quot;variables&quot; :depends-on (&quot;package&quot;))
   (:module &quot;mod&quot;
     :depends-on (&quot;package&quot;)
     :serial t
     :components ((:file &quot;utils&quot;)
                  (:file &quot;reader&quot;)
                  (:file &quot;cooker&quot;)
                  (:static-file &quot;data.raw&quot;))
     :output-files (compile-op (o c) (list &quot;data.cooked&quot;))
     :perform (compile-op :after (o c)
        (cook-data
         :in (component-pathname (find-component c &quot;data.raw&quot;))
         :out (first (output-files o c)))))
   (:file &quot;foo&quot; :depends-on (&quot;mod&quot;))))

(defmethod action-description
    ((o compile-op) (c (eql (find-component &quot;foo&quot; &quot;mod&quot;))))
  &quot;cooking data&quot;)
</pre></div>

<p>Here are some notes about this example:
</p>
<ul class="itemize mark-bullet">
<li>The main thing this file does is define a system <code class="code">foo</code>.
It also contains other Lisp forms, which we&rsquo;ll examine below.

</li><li>Besides Lisp source files, this system contains a <code class="code">:module</code> component
named <code class="code">&quot;mod&quot;</code>, which is a collection of three Lisp source files
<samp class="file">utils.lisp</samp>, <samp class="file">reader.lisp</samp>, <samp class="file">cooker.lisp</samp> and <samp class="file">data.raw</samp>

</li><li>Note that the <code class="code">:static-file</code> does not have an implicit file type,
unlike the Lisp source files.

</li><li>This files will be located in a subdirectory of the main code directory named
<samp class="file">mod/</samp> (this location could have been overridden to be
in the same directory, or in a different subdirectory;
see the discussion of the <code class="code">:pathname</code> option in <a class="ref" href="#The-defsystem-grammar">The defsystem grammar</a>).

</li><li>The <code class="code">:serial t</code> says that each sub-component of <code class="code">mod</code> depends on the previous components,
so that <samp class="file">cooker.lisp</samp> depends-on <samp class="file">reader.lisp</samp>, which depends-on <samp class="file">utils.lisp</samp>.
Also <samp class="file">data.raw</samp> depends on all of them, but that doesn&rsquo;t matter since it&rsquo;s a static file;
on the other hand, if it appeared first, then all the Lisp files would be recompiled
when the data is modified, which is probably not what is desired in this case.

</li><li>The method-form tokens provide a shorthand for defining methods on
particular components.  This part

<div class="example lisp">
<pre class="lisp-preformatted">     :output-files (compile-op (o c) (list &quot;data.cooked&quot;))
     :perform (compile-op :after (o c)
        (cook-data
         :in (component-pathname (find-component c &quot;data.raw&quot;))
         :out (first (output-files o c))))
</pre></div>

<p>has the effect of
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(defmethod output-files ((o compile-op) (c (eql ...)))
  (list &quot;data.cooked&quot;))
(defmethod perform :after ((o compile-op) (c (eql ...)))
  (cook-data
   :in (component-pathname (find-component c &quot;data.raw&quot;))
   :out (first (output-files o c))))
</pre></div>

<p>where <code class="code">...</code> is the component in question.
In this case <code class="code">...</code> would expand to something like
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(find-component &quot;foo&quot; &quot;mod&quot;)
</pre></div>

<p>For more details on the syntax of such forms,
see <a class="pxref" href="#The-defsystem-grammar">The defsystem grammar</a>.
For more details on what these methods do, see <a class="pxref" href="#Operations">Operations</a> in
<a class="ref" href="#The-object-model-of-ASDF">The Object model of ASDF</a>.
</p>
</li><li>There is an additional <code class="code">defmethod</code> with a similar effect,
because ASDF (as of ASDF 3.1.5)
fails to accept inline-methods as above for <code class="code">action-description</code>,
instead only supporting the deprecated <code class="code">explain</code> interface.


</li><li>In this case, these methods describe how this module defines code
that it then uses to cook some data.

</li><li>Importantly, ASDF is told about the input and output files
used by the data cooker,
and to make sure everyone agrees,
the cooking function explicitly uses ASDF to access pathnames
to the input and output data.


</li><li>The file starts with a form <code class="code">(in-package :asdf-user)</code>,
but it is actually redundant, not necessary and not recommended.
But yet more complex cases (also not recommended) may usefully use an <code class="code">in-package</code> form.

</li><li>Indeed, ASDF does not load <samp class="file">.asd</samp> files simply with <code class="code">cl:load</code>,
and neither should you.
You should let ASDF find and load them when you operate on systems.
If you somehow <em class="emph">must</em> load a <samp class="file">.asd</samp> file,
use the same function <code class="code">asdf:load-asd</code> that ASDF uses.
Among other things, it already binds the <code class="code">*package*</code> to <code class="code">asdf-user</code>.
Recent versions of SLIME (2013-02 and later) know to do that when you <kbd class="kbd">C-c C-k</kbd>
when you use the <code class="code">slime-asdf</code> contrib.

</li><li>You shouldn&rsquo;t use an <code class="code">in-package</code> form
if you&rsquo;re keeping things simple.
You should only use <code class="code">in-package</code> (and before it, a <code class="code">defpackage</code>)
when you&rsquo;re going to define new classes, functions, variables, macros, etc.,
in the <code class="code">.asd</code> file, and want to thereby avoid name clashes.
Manuals for old versions of ASDF recommended use of such an idiom in <samp class="file">.asd</samp> files,
but as of ASDF 3, we recommend that you don&rsquo;t do that anymore,
and instead define any ASDF extensions in their own system,
on which you can then declare a dependency using <code class="code">:defsystem-depends-on</code>.
See <a class="xref" href="#The-defsystem-grammar">The defsystem grammar</a>.

</li><li>More generally, you can always rely on symbols
from packages <code class="code">asdf</code>, <code class="code">common-lisp</code> and <code class="code">uiop</code>
being available in <code class="code">.asd</code> files &mdash;
most importantly including <code class="code">defsystem</code>.
It is therefore redundant and in bad taste to use a package-prefixed <code class="code">asdf:defsystem</code> symbol
in a <samp class="file">.asd</samp> file.
Just use <code class="code">(defsystem ...)</code>.
Only package-prefix it when somehow dynamically generating system definitions
from a package that doesn&rsquo;t already use the ASDF package.

</li><li><code class="code">asdf-user</code> is actually only available starting since ASDF 3, but then again,
ASDF 1 and 2 did crazy things with packages that ASDF 3 has stopped doing<a class="footnote" id="DOCF9" href="#FOOT9"><sup>9</sup></a>,
and since all implementations provide ASDF 3, you shouldn&rsquo;t care about compatibility with ASDF 2.
We do not support ASDF 2 anymore, and we recommend that neither should you.

</li><li>Starting with ASDF 3.1, <code class="code">asdf-user</code> uses <code class="code">uiop</code>,
whereas in earlier variants of ASDF 3 it only used <code class="code">uiop/package</code>.
We recommend you either prefix use of UIOP functions with the package prefix <code class="code">uiop:</code>,
or make sure your system <code class="code">:depends-on ((:version &quot;asdf&quot; &quot;3.1.2&quot;))</code>
or has a <code class="code">#-asdf3.1 (error &quot;MY-SYSTEM requires ASDF 3.1.2&quot;)</code>.

</li><li>Finally, we elided most metadata, but showed how you can have ASDF automatically extract
the system&rsquo;s version from a source file. In this case, the 3rd subform of the 4th form
(note that Lisp uses 0-based indexing, English uses 1-based indexing).
Presumably, the 4th form looks like <code class="code">(defparameter *foo-version* &quot;5.6.7&quot;)</code>.

</li></ul>


<hr>
</div>
<div class="section-level-extent" id="The-defsystem-grammar">
<h3 class="section" id="The-defsystem-grammar-1">6.3 The defsystem grammar</h3>
<a class="index-entry-id" id="index-defsystem-2"></a>
<a class="index-entry-id" id="index-DEFSYSTEM-grammar"></a>





<div class="example">
<pre class="example-preformatted"><a class="anchor" id="rule_002dsystem_002ddefinition"></a>system-definition := ( defsystem <a class="ref" href="#rule_002dsystem_002ddesignator">system-designator</a> <a class="ref" href="#rule_002dsystem_002doption">system-option</a>* )

<a class="anchor" id="rule_002dsystem_002ddesignator"></a>system-designator := <a class="ref" href="#rule_002dsimple_002dcomponent_002dname">simple-component-name</a>
                   | <a class="ref" href="#rule_002dcomplex_002dcomponent_002dname">complex-component-name</a>

# NOTE: Underscores are not permitted.
# see <a class="pxref" href="#Simple-component-names">Simple component names</a>
<a class="anchor" id="rule_002dsimple_002dcomponent_002dname"></a>simple-component-name := <var class="var">lower-case string</var> | <var class="var">symbol</var>

# see <a class="pxref" href="#Complex-component-names">Complex component names</a>
<a class="anchor" id="rule_002dcomplex_002dcomponent_002dname"></a>complex-component-name := <var class="var">string</var> | <var class="var">symbol</var>

<a class="anchor" id="rule_002dsystem_002doption"></a>system-option := :defsystem-depends-on <a class="ref" href="#rule_002ddependency_002ddef">dependency-def</a>
               | :weakly-depends-on <a class="ref" href="#rule_002dsystem_002dlist">system-list</a>
               | :class <var class="var">class-name</var> # see <a class="pxref" href="#System-class-names">System class names</a>
               | :build-pathname <a class="ref" href="#rule_002dpathname_002dspecifier">pathname-specifier</a>
               | :build-operation <a class="ref" href="#rule_002doperation_002dname">operation-name</a>
               | <a class="ref" href="#rule_002dsystem_002doption_002fasdf3">system-option/asdf3</a>
               | <a class="ref" href="#rule_002dmodule_002doption">module-option</a>
               | <a class="ref" href="#rule_002doption">option</a>

# These are only available since ASDF 3 (actually its alpha release
# 2.27)
<a class="anchor" id="rule_002dsystem_002doption_002fasdf3"></a>system-option/asdf3 := :homepage <var class="var">string</var>
                     | :bug-tracker <var class="var">string</var>
                     | :mailto <var class="var">string</var>
                     | :long-name <var class="var">string</var>
                     | :source-control <a class="ref" href="#rule_002dsource_002dcontrol">source-control</a>
                     | :version <a class="ref" href="#rule_002dversion_002dspecifier">version-specifier</a>
                     | :entry-point <var class="var">object</var> # see <a class="pxref" href="#Entry-point">Entry point</a>

<a class="anchor" id="rule_002dsource_002dcontrol"></a>source-control := ( <var class="var">keyword</var> <var class="var">string</var> )

<a class="anchor" id="rule_002dmodule_002doption"></a>module-option := :components <a class="ref" href="#rule_002dcomponent_002dlist">component-list</a>
               | :serial [ t | nil ]

<a class="anchor" id="rule_002doption"></a>option := :description <var class="var">string</var>
        | :long-description <var class="var">string</var>
        | :author <a class="ref" href="#rule_002dperson_002dor_002dpersons">person-or-persons</a>
        | :maintainer <a class="ref" href="#rule_002dperson_002dor_002dpersons">person-or-persons</a>
        | :pathname <a class="ref" href="#rule_002dpathname_002dspecifier">pathname-specifier</a>
        | :default-component-class <var class="var">class-name</var>
        | :perform <a class="ref" href="#rule_002dmethod_002dform">method-form</a>
        | :explain <a class="ref" href="#rule_002dmethod_002dform">method-form</a>
        | :output-files <a class="ref" href="#rule_002dmethod_002dform">method-form</a>
        | :operation-done-p <a class="ref" href="#rule_002dmethod_002dform">method-form</a>
        | :if-feature <a class="ref" href="#rule_002dfeature_002dexpression">feature-expression</a>
        | :depends-on ( <a class="ref" href="#rule_002ddependency_002ddef">dependency-def</a>* )
        | :in-order-to ( <a class="ref" href="#rule_002ddependency">dependency</a>+ )

<a class="anchor" id="rule_002dperson_002dor_002dpersons"></a>person-or-persons := <var class="var">string</var> | ( <var class="var">string</var>+ )

<a class="anchor" id="rule_002dsystem_002dlist"></a>system-list := ( <a class="ref" href="#rule_002dsimple_002dcomponent_002dname">simple-component-name</a>* )

<a class="anchor" id="rule_002dcomponent_002dlist"></a>component-list := ( <a class="ref" href="#rule_002dcomponent_002ddef">component-def</a>* )

<a class="anchor" id="rule_002dcomponent_002ddef"></a>component-def := ( <a class="ref" href="#rule_002dcomponent_002dtype">component-type</a> <a class="ref" href="#rule_002dsimple_002dcomponent_002dname">simple-component-name</a> <a class="ref" href="#rule_002doption">option</a>* )

<a class="anchor" id="rule_002dcomponent_002dtype"></a>component-type := :module | :file | :static-file | <a class="ref" href="#rule_002dother_002dcomponent_002dtype">other-component-type</a>

<a class="anchor" id="rule_002dother_002dcomponent_002dtype"></a>other-component-type := symbol-by-name # see <a class="pxref" href="#Component-types">Component types</a>

# This is used in :depends-on, as opposed to &quot;dependency&quot;, which is used
# in :in-order-to
<a class="anchor" id="rule_002ddependency_002ddef"></a>dependency-def := <a class="ref" href="#rule_002dsimple_002dcomponent_002dname">simple-component-name</a>
                | ( :feature <a class="ref" href="#rule_002dfeature_002dexpression">feature-expression</a> <a class="ref" href="#rule_002ddependency_002ddef">dependency-def</a> ) # see <a class="pxref" href="#Feature-dependencies">Feature dependencies</a>
                | ( :version <a class="ref" href="#rule_002dsimple_002dcomponent_002dname">simple-component-name</a> <a class="ref" href="#rule_002dversion_002dspecifier">version-specifier</a> )
                | ( :require <var class="var">module-name</var> )

# &quot;dependency&quot; is used in :in-order-to, as opposed to &quot;dependency-def&quot;
<a class="anchor" id="rule_002ddependency"></a>dependency := ( <a class="ref" href="#rule_002ddependent_002dop">dependent-op</a> <a class="ref" href="#rule_002drequirement">requirement</a>+ )
<a class="anchor" id="rule_002drequirement"></a>requirement := ( <a class="ref" href="#rule_002drequired_002dop">required-op</a> <var class="var">required-component</var>+ )
<a class="anchor" id="rule_002ddependent_002dop"></a>dependent-op := <a class="ref" href="#rule_002doperation_002dname">operation-name</a>
<a class="anchor" id="rule_002drequired_002dop"></a>required-op := <a class="ref" href="#rule_002doperation_002dname">operation-name</a>

# NOTE: pathnames should be all lower case, and have no underscores,
# although hyphens are permitted.
<a class="anchor" id="rule_002dpathname_002dspecifier"></a>pathname-specifier := <var class="var">pathname</var> | <var class="var">string</var> | <var class="var">symbol</var>

<a class="anchor" id="rule_002dversion_002dspecifier"></a>version-specifier := <var class="var">string</var>
                   | ( :read-file-form <a class="ref" href="#rule_002dpathname_002dspecifier">pathname-specifier</a> <a class="ref" href="#rule_002dform_002dspecifier">form-specifier</a>? )
                   | ( :read-file-line <a class="ref" href="#rule_002dpathname_002dspecifier">pathname-specifier</a> <a class="ref" href="#rule_002dline_002dspecifier">line-specifier</a>? )
<a class="anchor" id="rule_002dline_002dspecifier"></a>line-specifier := :at <var class="var">integer</var> # base zero
<a class="anchor" id="rule_002dform_002dspecifier"></a>form-specifier := :at [ <var class="var">integer</var> | ( <var class="var">integer</var>+ ) ]

<a class="anchor" id="rule_002dmethod_002dform"></a>method-form := ( <a class="ref" href="#rule_002doperation_002dname">operation-name</a> <a class="ref" href="#rule_002dqual">qual</a> <var class="var">lambda-list</var> &amp;rest <var class="var">body</var> )
<a class="anchor" id="rule_002dqual"></a>qual := <a class="ref" href="#rule_002dmethod_002dqualifier">method-qualifier</a>?
<a class="anchor" id="rule_002dmethod_002dqualifier"></a>method-qualifier := :before | :after | :around

<a class="anchor" id="rule_002dfeature_002dexpression"></a>feature-expression := <var class="var">keyword</var>
                    | ( :and <a class="ref" href="#rule_002dfeature_002dexpression">feature-expression</a>* )
                    | ( :or <a class="ref" href="#rule_002dfeature_002dexpression">feature-expression</a>* )
                    | ( :not <a class="ref" href="#rule_002dfeature_002dexpression">feature-expression</a> )

<a class="anchor" id="rule_002doperation_002dname"></a>operation-name := <var class="var">symbol</var>
</pre></div>

<div class="subsection-level-extent" id="System-designators">
<h4 class="subsection">6.3.1 System designators</h4>

<p>System designators are either simple component names, or
complex (&ldquo;slashy&rdquo;) component names.
</p>
</div>
<div class="subsection-level-extent" id="Simple-component-names-_0028simple_002dcomponent_002dname_0029">
<h4 class="subsection">6.3.2 Simple component names (<code class="code">simple-component-name</code>)</h4>
<a class="anchor" id="Simple-component-names"></a>
<p>Simple component names may be written as either strings or symbols.
</p>
<p>When using strings, use lower case exclusively.
</p>
<p>Symbols will be interpreted as convenient shorthand for the string
that is their <code class="code">symbol-name</code>, converted to lower case.  Put
differently, a symbol may be a simple component name <em class="emph">designator</em>,
but the simple component name itself is the string.
</p>
<p><strong class="strong">Never</strong>  use underscores in  component names, whether written as
strings or symbols.
</p>
<p><strong class="strong">Never</strong> use slashes (&ldquo;/&rdquo;) in simple component names.  A slash
indicates a <em class="emph">complex</em> component name; see below.  Using a slash
improperly will cause ASDF to issue a warning.
</p>
<p>Violating these constraints by mixing case, or including underscores in
component names, may lead to systems or components being impossible to
find, because component names are interpreted as file names.  These
problems will <em class="emph">definitely</em> occur for users who have configured ASDF
using logical pathnames.
</p>
</div>
<div class="subsection-level-extent" id="Complex-component-names-1">
<h4 class="subsection">6.3.3 Complex component names</h4>
<a class="anchor" id="Complex-component-names"></a>
<p>A complex component name is a master name followed by a slash, followed
by a subsidiary name.  This allows programmers to put multiple system
definitions in a single <code class="code">.asd</code> file, while still allowing ASDF to
find these systems.
</p>
<p>The master name of a complex system <strong class="strong">must</strong> be the same as the
name of the <code class="code">.asd</code> file.
</p>
<p>The file <code class="code">foo.asd</code> will contain the definition of the system
<code class="code">&quot;foo&quot;</code>.  However, it may <em class="emph">also</em> contain definitions of
subsidiary systems, such as <code class="code">&quot;foo/test&quot;</code>, <code class="code">&quot;foo/docs&quot;</code>, and so
forth.  ASDF will &ldquo;know&rdquo; that if you ask it to load system
<code class="code">&quot;foo/test&quot;</code> it should look for that system&rsquo;s definition in <code class="code">foo.asd</code>.
</p>
</div>
<div class="subsection-level-extent" id="Component-types-1">
<h4 class="subsection">6.3.4 Component types</h4>
<a class="anchor" id="Component-types"></a>
<p>Component type names, even if expressed as keywords, will be looked up
by name in the current package and in the asdf package, if not found in
the current package.  So a component type <code class="code">my-component-type</code>, in
the current package <code class="code">my-system-asd</code> can be specified as
<code class="code">:my-component-type</code>, or <code class="code">my-component-type</code>.
</p>
<p><code class="code">system</code> and its subclasses are <em class="emph">not</em>
allowed as component types for such children components.
</p>
</div>
<div class="subsection-level-extent" id="System-class-names-1">
<h4 class="subsection">6.3.5 System class names</h4>
<a class="anchor" id="System-class-names"></a>
<p>A system class name will be looked up
in the same way as a Component type (see above),
except that only <code class="code">system</code> and its subclasses are allowed.
Typically, one will not need to specify a system
class name, unless using a non-standard system class defined in some
ASDF extension, typically loaded through <code class="code">DEFSYSTEM-DEPENDS-ON</code>,
see below.  For such class names in the ASDF package, we recommend that
the <code class="code">:class</code> option be specified using a keyword symbol, such as
</p>
<div class="example">
<pre class="example-preformatted">:class :MY-NEW-SYSTEM-SUBCLASS
</pre></div>

<p>This practice will ensure that package name conflicts are avoided.
Otherwise, the symbol <code class="code">MY-NEW-SYSTEM-SUBCLASS</code> will be read into
the current package <em class="emph">before</em> it has been exported from the ASDF
extension loaded by <code class="code">:defsystem-depends-on</code>, causing a name
conflict in the current package.
</p>
</div>
<div class="subsection-level-extent" id="Defsystem-depends-on">
<h4 class="subsection">6.3.6 Defsystem depends on</h4>
<a class="index-entry-id" id="index-_003adefsystem_002ddepends_002don"></a>

<p>The <code class="code">:defsystem-depends-on</code> option to <code class="code">defsystem</code> allows the
programmer to specify another ASDF-defined system or set of systems that
must be loaded <em class="emph">before</em> the system definition is processed.
Typically this is used to load an ASDF extension that is used in the
system definition.
</p>
</div>
<div class="subsection-level-extent" id="Build_002doperation-1">
<h4 class="subsection">6.3.7 Build-operation</h4>
<a class="index-entry-id" id="index-_003abuild_002doperation"></a>
<a class="anchor" id="Build_002doperation"></a>
<p>The <code class="code">:build-operation</code> option to <code class="code">defsystem</code> allows the
programmer to specify an operation that will be applied, in place of
<code class="code">load-op</code> when <code class="code">make</code> (see <a class="pxref" href="#Convenience-Functions">make</a>)
is run on the system.    The option
value should be the name of an operation.  E.g., <code class="code">:build-operation doc-op</code>
</p>
<p>This feature is
experimental and largely untested.  Use at your own risk.
</p>
</div>
<div class="subsection-level-extent" id="Weakly-depends-on">
<h4 class="subsection">6.3.8 Weakly depends on</h4>
<a class="index-entry-id" id="index-_003aweakly_002ddepends_002don"></a>

<p>We do <em class="emph">NOT</em> recommend you use this feature.
If you are tempted to write a system <var class="var">foo</var>
that weakly-depends-on a system <var class="var">bar</var>,
we recommend that you should instead
write system <var class="var">foo</var> in a parametric way,
and offer some special variable and/or some hook to specialize its behaviour;
then you should write a system <var class="var">foo+bar</var>
that does the hooking of things together.
</p>
<p>The (deprecated) <code class="code">:weakly-depends-on</code> option to <code class="code">defsystem</code>
allows the programmer to specify another ASDF-defined system or set of systems
that ASDF should <em class="emph">try</em> to load,
but need not load in order to be successful.
Typically this is used if there are a number of systems
that, if present, could provide additional functionality,
but which are not necessary for basic function.
</p>
<p>Currently, although it is specified to be an option only to <code class="code">defsystem</code>,
this option is accepted at any component, but it probably
only makes sense at the <code class="code">defsystem</code> level.
Programmers are cautioned not
to use this component option except at the <code class="code">defsystem</code> level, as
this anomalous behaviour may be removed without warning.
</p>


</div>
<div class="subsection-level-extent" id="Pathname-specifiers-1">
<h4 class="subsection">6.3.9 Pathname specifiers</h4>
<a class="index-entry-id" id="index-pathname-specifiers"></a>
<a class="anchor" id="Pathname-specifiers"></a>
<p>A pathname specifier (<code class="code">pathname-specifier</code>)
may be a pathname, a string or a symbol.
When no pathname specifier is given for a component,
which is the usual case, the component name itself is used.
</p>
<p>If a string is given, which is the usual case,
the string will be interpreted as a Unix-style pathname
where <code class="code">/</code> characters will be interpreted as directory separators.
Usually, Unix-style relative pathnames are used
(i.e. not starting with <code class="code">/</code>, as opposed to absolute pathnames);
they are relative to the path of the parent component.
Finally, depending on the <code class="code">component-type</code>,
the pathname may be interpreted as either a file or a directory,
and if it&rsquo;s a file,
a file type may be added corresponding to the <code class="code">component-type</code>,
or else it will be extracted from the string itself (if applicable).
</p>
<p>For instance, the <code class="code">component-type</code> <code class="code">:module</code>
wants a directory pathname, and so a string <code class="code">&quot;foo/bar&quot;</code>
will be interpreted as the pathname <samp class="file">#p&quot;foo/bar/&quot;</samp>.
On the other hand, the <code class="code">component-type</code> <code class="code">:file</code>
wants a file of type <code class="code">lisp</code>, and so a string <code class="code">&quot;foo/bar&quot;</code>
will be interpreted as the pathname <samp class="file">#p&quot;foo/bar.lisp&quot;</samp>,
and a string <code class="code">&quot;foo/bar.quux&quot;</code>
will be interpreted as the pathname <samp class="file">#p&quot;foo/bar.quux.lisp&quot;</samp>.
Finally, the <code class="code">component-type</code> <code class="code">:static-file</code>
wants a file without specifying a type, and so a string <code class="code">&quot;foo/bar&quot;</code>
will be interpreted as the pathname <samp class="file">#p&quot;foo/bar&quot;</samp>,
and a string <code class="code">&quot;foo/bar.quux&quot;</code>
will be interpreted as the pathname <samp class="file">#p&quot;foo/bar.quux&quot;</samp>.
</p>
<p>ASDF interprets the string <code class="code">&quot;..&quot;</code>
as the pathname directory component word <code class="code">:back</code>,
which when merged, goes back one level in the directory hierarchy.
</p>
<p>If a symbol is given, it will be translated into a string,
and downcased in the process.
The downcasing of symbols is unconventional,
but was selected after some consideration.
The file systems we  support
either have lowercase as customary case (Unix, Mac, Windows)
or silently convert lowercase to uppercase (lpns),
so this makes more sense than attempting to use <code class="code">:case :common</code>
as argument to <code class="code">make-pathname</code>,
which is reported not to work on some implementations.
</p>
<p>Please avoid using underscores in system names, or component (module or
file) names,  since underscores are not
compatible with logical pathnames (see <a class="pxref" href="#Using-logical-pathnames">Using logical pathnames</a>).
</p>
<p>Pathname objects may be given to override the path for a component.
Such objects are typically specified using reader macros such as <code class="code">#p</code>
or <code class="code">#.(make-pathname ...)</code>.
Note however, that <code class="code">#p...</code> is
a shorthand for <code class="code">#.(parse-namestring ...)</code>
and that the behaviour of <code class="code">parse-namestring</code> is completely non-portable,
unless you are using Common Lisp <code class="code">logical-pathname</code>s,
which themselves involve other non-portable behaviour
(see <a class="pxref" href="#Using-logical-pathnames">Using logical pathnames</a>).
Pathnames made with <code class="code">#.(make-pathname ...)</code>
can usually be done more easily with the string syntax above.
The only case that you really need a pathname object is to override
the component-type default file type for a given component.
Therefore, pathname objects should only rarely be used.
Unhappily, ASDF 1 used not to properly support
parsing component names as strings specifying paths with directories,
and the cumbersome <code class="code">#.(make-pathname ...)</code> syntax had to be used.
An alternative to <code class="code">#.</code> read-time evaluation is to use
<code class="code">(eval `(defsystem ... ,pathname ...))</code>.
</p>
<p>Note that when specifying pathname objects,
ASDF does not do any special interpretation of the pathname
influenced by the component type, unlike the procedure for
pathname-specifying strings.
On the one hand, you have to be careful to provide a pathname that correctly
fulfills whatever constraints are required from that component type
(e.g. naming a directory or a file with appropriate type);
on the other hand, you can circumvent the file type that would otherwise
be forced upon you if you were specifying a string.
</p>
</div>
<div class="subsection-level-extent" id="Version-specifiers-1">
<h4 class="subsection">6.3.10 Version specifiers</h4>
<a class="index-entry-id" id="index-version-specifiers"></a>
<a class="index-entry-id" id="index-_003aversion-1"></a>
<a class="anchor" id="Version-specifiers"></a>
<p>Version specifiers are strings to be parsed as period-separated lists of integers.
I.e., in the example, <code class="code">&quot;0.2.1&quot;</code> is to be interpreted,
roughly speaking, as <code class="code">(0 2 1)</code>.
In particular, version <code class="code">&quot;0.2.1&quot;</code> is interpreted the same as <code class="code">&quot;0.0002.1&quot;</code>,
though the latter is not canonical and may lead to a warning being issued.
Also, <code class="code">&quot;1.3&quot;</code> and <code class="code">&quot;1.4&quot;</code> are both strictly <code class="code">uiop:version&lt;</code> to <code class="code">&quot;1.30&quot;</code>,
quite unlike what would have happened
had the version strings been interpreted as decimal fractions.
</p>
<p>Instead of a string representing the version,
the <code class="code">:version</code> argument can be an expression that is resolved to
such a string using the following trivial domain-specific language:
in addition to being a literal string, it can be an expression of the form
<code class="code">(:read-file-form &lt;pathname-or-string&gt; [:at &lt;access-at-specifier&gt;])</code>,
or <code class="code">(:read-file-line &lt;pathname-or-string&gt; [:at &lt;access-at-specifier&gt;])</code>.
As the name suggests, the former will be resolved by reading a form in the specified pathname
(read as a subpathname of the current system if relative or a
unix-namestring), and the latter by reading a line.
You may use a <code class="code">uiop:access-at</code> specifier
with the <code class="code">:at</code> keyword,
by default the specifier is <code class="code">0</code>, meaning the first form/line is
returned.
For <code class="code">:read-file-form</code>,
subforms can also be specified, with e.g. <code class="code">(1 2 2)</code> specifying
&ldquo;the third subform (index 2) of the third subform (index 2) of the second form (index 1)&rdquo;
in the file (mind the off-by-one error in the English language).
</p>
<p>System definers are encouraged to use version identifiers of the form
<var class="var">x</var>.<var class="var">y</var>.<var class="var">z</var> for
major version, minor version and patch level,
where significant API incompatibilities are signaled by an increased major number.
</p>
<p>See <a class="xref" href="#Common-attributes-of-components">Common attributes of components</a>.
</p>
</div>
<div class="subsection-level-extent" id="Require">
<h4 class="subsection">6.3.11 Require</h4>
<a class="index-entry-id" id="index-_003arequire-dependencies"></a>

<p>Use the implementation&rsquo;s own <code class="code">require</code> to load the <var class="var">module-name</var>.
</p>
<p>It is good taste to use <code class="code">(:feature <em class="emph">:implementation-name</em> (:require <var class="var">module-name</var>))</code>
rather than <code class="code">#+<em class="emph">implementation-name</em> (:require <var class="var">module-name</var>)</code>
to only depend on the specified module on the specific implementation that provides it.
See <a class="xref" href="#Feature-dependencies">Feature dependencies</a>.
</p>
</div>
<div class="subsection-level-extent" id="Feature-dependencies-1">
<h4 class="subsection">6.3.12 Feature dependencies</h4>
<a class="index-entry-id" id="index-_003afeature-dependencies"></a>
<a class="anchor" id="Feature-dependencies"></a>
<p>A feature dependency is of the form
<code class="code">(:feature <var class="var">feature-expression</var> <var class="var">dependency</var>)</code>
If the <var class="var">feature-expression</var> is satisfied by the running lisp at the
time the system definition is parsed, then the <var class="var">dependency</var> will be
added to the system&rsquo;s dependencies.  If the <var class="var">feature-expression</var> is
<em class="emph">not</em> satisfied, then the feature dependency form is ignored.
</p>
<p>Note that this means that <code class="code">:feature</code> <strong class="strong">cannot</strong> be used to
enforce a feature dependency for the system in question.  I.e., it
cannot be used to require that a feature hold in order for the system
definition to be loaded.  E.g., one cannot use <code class="code">(:feature :sbcl)</code>
to require that a system only be used on SBCL.
</p>
<p>Feature dependencies are not to be confused with the obsolete
feature requirement (see <a class="pxref" href="#feature-requirement">feature requirement</a>), or
with <code class="code">if-feature</code>.
</p>
</div>
<div class="subsection-level-extent" id="Using-logical-pathnames-1">
<h4 class="subsection">6.3.13 Using logical pathnames</h4>
<a class="index-entry-id" id="index-logical-pathnames"></a>
<a class="anchor" id="Using-logical-pathnames"></a>
<p>We do not generally recommend the use of logical pathnames,
especially not so to newcomers to Common Lisp.
However, we do support the use of logical pathnames by old timers,
when such is their preference.
</p>
<p>To use logical pathnames,
you will have to provide a pathname object as a <code class="code">:pathname</code> specifier
to components that use it, using such syntax as
<code class="code">#p&quot;LOGICAL-HOST:absolute;path;to;component.lisp&quot;</code>.
</p>
<p>You only have to specify such logical pathname
for your system or some top-level component.
Sub-components&rsquo; relative pathnames,
specified using the string syntax for names,
will be properly merged with the pathnames of their parents.
The specification of a logical pathname host however is <em class="emph">not</em>
otherwise directly supported in the ASDF syntax
for pathname specifiers as strings.
</p>
<p>The <code class="code">asdf-output-translation</code> layer will
avoid trying to resolve and translate logical pathnames.
The advantage of this is that
you can define yourself what translations you want to use
with the logical pathname facility.
The disadvantage is that if you do not define such translations,
any system that uses logical pathnames will behave differently under
asdf-output-translations than other systems you use.
</p>
<p>If you wish to use logical pathnames you will have to configure the
translations yourself before they may be used.
ASDF currently provides no specific support
for defining logical pathname translations.
</p>
<p>Note that the reasons we do not recommend logical pathnames are that
(1) there is no portable way to set up logical pathnames <em class="emph">before</em> they are used,
(2) logical pathnames are limited to only portably use
a single character case, digits and hyphens.
While you can solve the first issue on your own,
describing how to do it on each of fifteen implementations supported by ASDF
is more than we can document.
As for the second issue, mind that the limitation is notably enforced on SBCL,
and that you therefore can&rsquo;t portably violate the limitations
but must instead define some encoding of your own and add individual mappings
to name physical pathnames that do not fit the restrictions.
This can notably be a problem when your Lisp files are part of a larger project
in which it is common to name files or directories in a way that
includes the version numbers of supported protocols,
or in which files are shared with software written
in different programming languages where conventions include the use of
underscores, dots or CamelCase in pathnames.
</p>

</div>
<div class="subsection-level-extent" id="Serial-dependencies">
<h4 class="subsection">6.3.14 Serial dependencies</h4>
<a class="index-entry-id" id="index-serial-dependencies"></a>

<p>If the <code class="code">:serial t</code> option is specified for a module,
ASDF will add dependencies for each child component,
on all the children textually preceding it.
This is done as if by <code class="code">:depends-on</code>.
</p>
<div class="example lisp">
<pre class="lisp-preformatted">:serial t
:components ((:file &quot;a&quot;) (:file &quot;b&quot;) (:file &quot;c&quot;))
</pre></div>

<p>is equivalent to
</p>
<div class="example lisp">
<pre class="lisp-preformatted">:components ((:file &quot;a&quot;)
             (:file &quot;b&quot; :depends-on (&quot;a&quot;))
             (:file &quot;c&quot; :depends-on (&quot;a&quot; &quot;b&quot;)))
</pre></div>


</div>
<div class="subsection-level-extent" id="Source-location-_0028_003apathname_0029">
<h4 class="subsection">6.3.15 Source location (<code class="code">:pathname</code>)</h4>

<p>The <code class="code">:pathname</code> option is optional in all cases for systems
defined via <code class="code">defsystem</code>, and generally is unnecessary.  In the
simple case, source files will be found in the same directory as the
system or, in the case of modules, in a subdirectory with the same name
as the module.
</p>

<p>More specifically, ASDF follows a hairy set of rules that are designed so that
</p><ol class="enumerate">
<li> <code class="code">find-system</code>
will load a system from disk
and have its pathname default to the right place.

</li><li> This pathname information will not be overwritten with
<code class="code">*default-pathname-defaults*</code>
(which could be somewhere else altogether)
if the user loads up the <samp class="file">.asd</samp> file into his editor
and interactively re-evaluates that form.
</li></ol>

<p>If a system is being loaded for the first time,
its top-level pathname will be set to:
</p>
<ul class="itemize mark-bullet">
<li>The host/device/directory parts of <code class="code">*load-truename*</code>,
if it is bound.
</li><li><code class="code">*default-pathname-defaults*</code>, otherwise.
</li></ul>

<p>If a system is being redefined, the top-level pathname will be
</p>
<ul class="itemize mark-bullet">
<li>changed, if explicitly supplied or obtained from <code class="code">*load-truename*</code>
(so that an updated source location is reflected in the system definition)

</li><li>changed if it had previously been set from <code class="code">*default-pathname-defaults*</code>

</li><li>left as before, if it had previously been set from <code class="code">*load-truename*</code>
and <code class="code">*load-truename*</code> is currently unbound
(so that a developer can evaluate a <code class="code">defsystem</code> form
from within an editor without clobbering its source location)
</li></ul>

</div>
<div class="subsection-level-extent" id="if_002dfeature-option-1">
<h4 class="subsection">6.3.16 if-feature option</h4>
<a class="index-entry-id" id="index-_003aif_002dfeature-component-option"></a>
<a class="anchor" id="if_002dfeature-option"></a>
<p>This option allows you to specify a feature expression to be evaluated
as if by <code class="code">#+</code> to conditionally include a component in your build.
If the expression is false, the component is dropped
as well as any dependency pointing to it.
As compared to using <code class="code">#+</code> which is expanded at read-time,
this allows you to have an object in your component hierarchy
that can be used for manipulations beside building your project, and
that is accessible to outside code that wishes to reason about system
structure.
</p>
<p>Programmers should be careful to consider <strong class="strong">when</strong> the
<code class="code">:if-feature</code> is evaluated.  Recall that ASDF first computes a
build plan, and then executes that plan.  ASDF will check to see whether
or not a feature is present <strong class="strong">at planning time</strong>, not during the
build.  It follows that one cannot use <code class="code">:if-feature</code> to check
features that are set during the course of the build.  It can only be
used to check the state of features before any build operations have
been performed.
</p>
<p>This option was added in ASDF 3.  For more information,
See <a class="xref" href="#required_002dfeatures">Required features</a>.
</p>
</div>
<div class="subsection-level-extent" id="Entry-point-1">
<h4 class="subsection">6.3.17 Entry point</h4>
<a class="index-entry-id" id="index-_003aentry_002dpoint"></a>
<a class="anchor" id="Entry-point"></a><p>The <code class="code">:entry-point</code> option allows a developer to specify the entry point of an executable program created by <code class="code">program-op</code>.
</p>
<p>When <code class="code">program-op</code> is invoked, the form passed to this option is converted to a function by <code class="code">uiop:ensure-function</code> and bound to <code class="code">uiop:*image-entry-point*</code>. Typically one will specify a string, e.g. <code class="code">&quot;foo:main&quot;</code>, so that the executable starts with the <code class="code">foo:main</code> function. Note that using the symbol <code class="code">foo:main</code> instead might not work because the <code class="code">foo</code> package doesn&rsquo;t necessarily exist when ASDF reads the <code class="code">defsystem</code> form. For more information on <code class="code">program-op</code>, see <a class="pxref" href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a>.
</p>
</div>
<div class="subsection-level-extent" id="feature-requirement-1">
<h4 class="subsection">6.3.18 feature requirement</h4>
<a class="anchor" id="feature-requirement"></a><p>This requirement was removed in ASDF 3.1.  Please do not use it.  In
most cases, <code class="code">:if-feature</code> (see <a class="pxref" href="#if_002dfeature-option">if-feature option</a>) will provide
an adequate substitute.
</p>
<p>The <code class="code">feature</code> requirement used to ensure that a chain of component
dependencies would fail when a key feature was absent.
Used in conjunction with <code class="code">:if-component-dep-fails</code>
this provided
a roundabout way to express conditional compilation.
</p>

<hr>
</div>
</div>
<div class="section-level-extent" id="Other-code-in-_002easd-files">
<h3 class="section" id="Other-code-in-_002easd-files-1">6.4 Other code in .asd files</h3>

<p>Files containing <code class="code">defsystem</code> forms
are regular Lisp files that are executed by <code class="code">load</code>.
Consequently, you can put whatever Lisp code you like into these files.
However, it is recommended to keep such forms to a minimal,
and to instead define <code class="code">defsystem</code> extensions
that you use with <code class="code">:defsystem-depends-on</code>.
</p>
<p>If however, you might insist on including code in the <samp class="file">.asd</samp> file itself,
e.g., to examine and adjust the compile-time environment,
possibly adding appropriate features to <code class="code">*features*</code>.
If so, here are some conventions we recommend you follow,
so that users can control certain details of execution
of the Lisp in <samp class="file">.asd</samp> files:
</p>
<ul class="itemize mark-bullet">
<li>Any informative output
(other than warnings and errors,
which are the condition system&rsquo;s to dispose of)
should be sent to the standard CL stream <code class="code">*standard-output*</code>,
so that users can easily control the disposition
of output from ASDF operations.
</li></ul>


<hr>
</div>
<div class="section-level-extent" id="The-package_002dinferred_002dsystem-extension">
<h3 class="section" id="The-package_002dinferred_002dsystem-extension-1">6.5 The package-inferred-system extension</h3>
<a class="index-entry-id" id="index-Package-inferred-systems"></a>
<a class="index-entry-id" id="index-Packages_002c-inferring-dependencies-from"></a>
<a class="index-entry-id" id="index-package_002dinferred_002dsystem"></a>
<a class="index-entry-id" id="index-One-package-per-file-systems"></a>

<p>Starting with release 3.1.2,
ASDF supports a one-package-per-file style of programming,
in which each file is its own system,
and dependencies are deduced from the <code class="code">defpackage</code> form
or its variant, <code class="code">uiop:define-package</code>.
</p>
<p>In this style of system definition, package names map to systems with
the same name (in lower case letters),
and if a system is defined with <code class="code">:class package-inferred-system</code>,
then system names that start with that name
(using the slash <code class="code">/</code> separator)
refer to files under the filesystem hierarchy where the system is defined.
For instance, if system <code class="code">my-lib</code> is defined in
<samp class="file">/foo/bar/my-lib/my-lib.asd</samp>, then system <code class="code">my-lib/src/utility</code>
will be found in file <samp class="file">/foo/bar/my-lib/src/utility.lisp</samp>.
</p>
<p>One package per file style was made popular by <code class="code">faslpath</code> and <code class="code">quick-build</code>,
and at the cost of stricter package discipline,
may yield more maintainable code.
This style is used in ASDF itself (starting with ASDF 3), by <code class="code">lisp-interface-library</code>,
and a few other libraries.
</p>
<p>To use this style, choose a toplevel system name, e.g. <code class="code">my-lib</code>,
and create a file <samp class="file">my-lib.asd</samp>.
Define <code class="code">my-lib</code>
using the <code class="code">:class :package-inferred-system</code> option in its <code class="code">defsystem</code>.
For instance:
</p><div class="example">
<pre class="example-preformatted">;; This example is based on lil.asd of LISP-INTERFACE-LIBRARY.

#-asdf3.1 (error &quot;MY-LIB requires ASDF 3.1 or later.&quot;)
(defsystem &quot;my-lib&quot;
  :class :package-inferred-system
  :depends-on (&quot;my-lib/interface/all&quot;
                        &quot;my-lib/src/all&quot;
                        &quot;my-lib/extras/all&quot;)
  :in-order-to ((test-op (load-op &quot;my-lib/test/all&quot;)))
  :perform (test-op (o c) (symbol-call :my-lib/test/all :test-suite)))

(defsystem &quot;my-lib/test&quot; :depends-on (&quot;my-lib/test/all&quot;))

(register-system-packages &quot;my-lib/interface/all&quot; '(:my-lib-interface))
(register-system-packages &quot;my-lib/src/all&quot; '(:my-lib-implementation))
(register-system-packages &quot;my-lib/test/all&quot; '(:my-lib-test))

(register-system-packages
 &quot;closer-mop&quot;
 '(:c2mop
   :closer-common-lisp
   :c2cl
   :closer-common-lisp-user
   :c2cl-user))
</pre></div>

<p>In the code above, the first form checks that we are using ASDF 3.1 or
later, which provides <code class="code">package-inferred-system</code>.  This is probably
no longer necessary, since none of the major lisp implementations
provides an older version of ASDF.
</p>
<a class="index-entry-id" id="index-register_002dsystem_002dpackages"></a>
<p>The function <code class="code">register-system-packages</code> must be called to register
packages used or provided by your system
when the name of the system/file that provides the package
is not the same as the package name (converted to lower case).
</p>
<p>Each file under the <code class="code">my-lib</code> hierarchy will start with a
package definition.
<a class="index-entry-id" id="index-define_002dpackage"></a>
<a class="index-entry-id" id="index-uiop_003adefine_002dpackage"></a>
The form <code class="code">uiop:define-package</code> is supported as well as
<code class="code">defpackage</code>.
ASDF will compute dependencies from the
<code class="code">:use</code>, <code class="code">:mix</code>, and other importation clauses of this package definition. Take the file
<samp class="file">interface/order.lisp</samp> as an example:
</p>
<div class="example">
<pre class="example-preformatted">(uiop:define-package :my-lib/interface/order
  (:use :closer-common-lisp
   :my-lib/interface/definition
   :my-lib/interface/base)
  (:mix :fare-utils :uiop :alexandria)
  (:export ...))
</pre></div>

<p>ASDF can tell that this file/system depends on system <code class="code">closer-mop</code> (registered above),
<code class="code">my-lib/interface/definition</code>, and <code class="code">my-lib/interface/base</code>.
</p>
<p>How can ASDF find the file <samp class="file">interface/order.lisp</samp> from the
toplevel system <code class="code">my-lib</code>, however? In the example above,
<samp class="file">interface/all.lisp</samp> (and other <samp class="file">all.lisp</samp>) reexport
all the symbols exported from the packages at the same or lower levels
of the hierarchy. This can be easily done with
<code class="code">uiop:define-package</code>, which has many options that prove useful in this
context.  For example:
</p>
<div class="example">
<pre class="example-preformatted">(uiop:define-package :my-lib/interface/all
  (:nicknames :my-lib-interface)
  (:use :closer-common-lisp)
  (:mix :fare-utils :uiop :alexandria)
  (:use-reexport
   :my-lib/interface/definition
   :my-lib/interface/base
   :my-lib/interface/order
   :my-lib/interface/monad/continuation))
</pre></div>

<p>Thus the top level system need only depend on the <code class="code">my-lib/.../all</code> systems
because ASDF detects
<samp class="file">interface/order.lisp</samp> and all other dependencies from <code class="code">all</code>
systems&rsquo; <code class="code">:use-reexport</code> clauses, which effectively
allow for &ldquo;inheritance&rdquo; of symbols being exported.
</p>
<p>ASDF also detects dependencies from <code class="code">:import-from</code> clauses.
You may thus import a well-defined set of symbols from an existing
package, and ASDF will know to load the system that provides that
package.  In the following example, ASDF will infer that the current
system depends on <code class="code">foo/baz</code> from the first <code class="code">:import-from</code>.
If you prefer to use any such symbol fully qualified by a package prefix,
you may declare a dependency on such a package and its corresponding system
via an <code class="code">:import-from</code> clause with an empty list of symbols.  For
example, if we preferred to use the name &lsquo;foo/quux:bletch&lsquo;, the second,
empty, <code class="code">:import-from</code> form would cause ASDF to load
<code class="code">foo/quux</code>.
</p>
<div class="example">
<pre class="example-preformatted">(defpackage :foo/bar
  (:use :cl)
  (:import-from :foo/baz #:sym1 #:sym2)
  (:import-from :foo/quux)
  (:export ...))
</pre></div>

<p>Note that starting with ASDF 3.1.5.6 only, ASDF will look for source files under
the <code class="code">component-pathname</code> (specified via the <code class="code">:pathname</code> option),
whereas earlier versions ignore this option and use the <code class="code">system-source-directory</code>
where the <samp class="file">.asd</samp> file resides.
</p>


<hr>
</div>
</div>
<div class="chapter-level-extent" id="The-object-model-of-ASDF">
<h2 class="chapter" id="The-Object-model-of-ASDF">7 The Object model of ASDF</h2>
<a class="index-entry-id" id="index-component-1"></a>
<a class="index-entry-id" id="index-operation-1"></a>

<p>ASDF is designed in an object-oriented way from the ground up.
Both a system&rsquo;s structure and the operations that can be performed on systems
follow an extensible protocol, allowing programmers to add new behaviours to ASDF.
For example, <code class="code">cffi</code> adds support for special FFI description files
that interface with C libraries and for wrapper files that embed C code in Lisp.
<code class="code">asdf-jar</code> supports creating Java JAR archives in ABCL.
<code class="code">poiu</code> supports compiling code in parallel using background processes.
</p>
<p>The key classes in ASDF are <code class="code">component</code> and <code class="code">operation</code>.
A <code class="code">component</code> represents an individual source file or a group of source files,
and the products (e.g., fasl files) produced from it.
An <code class="code">operation</code> represents a transformation that can be performed on a component,
turning them from source files to intermediate results to final outputs.
Components are related by <em class="emph">dependencies</em>, specified in system
definitions.
</p>
<p>When ordered to <code class="code">operate</code> with some operation on a component (usually a system),
ASDF will first compute a <em class="emph">plan</em>
by traversing the dependency graph using function <code class="code">make-plan</code>.<a class="footnote" id="DOCF10" href="#FOOT10"><sup>10</sup></a>
The resulting plan object contains an ordered list of <em class="emph">actions</em>.
An action is a pair of an <code class="code">operation</code> and a <code class="code">component</code>,
representing  a particular build step to be <code class="code">perform</code>ed.
The ordering of the plan ensures that no action is performed before
all its dependencies have been fulfilled.<a class="footnote" id="DOCF11" href="#FOOT11"><sup>11</sup></a>
</p>
<p>In this chapter, we describe ASDF&rsquo;s object-oriented protocol,
the classes that make it up, and the generic functions on those classes.
These generic functions often take
both an operation and a component as arguments:
much of the power and configurability of ASDF is provided by
this use of CLOS&rsquo;s multiple dispatch.
We will describe the built-in component and operation classes, and
explain how to extend the ASDF protocol by defining new classes and
methods for ASDF&rsquo;s generic functions.
We will also describe the many <em class="emph">hooks</em> that can be configured to
customize the behaviour of existing <em class="emph">functions</em>.
</p>

<hr>
<div class="section-level-extent" id="Operations">
<h3 class="section" id="Operations-1">7.1 Operations</h3>
<a class="index-entry-id" id="index-operation"></a>

<p>An <em class="dfn">operation</em> object of the appropriate type is instantiated
whenever the user wants to do something with a system like
</p>
<ul class="itemize mark-bullet">
<li>compile all its files
</li><li>load the files into a running lisp environment
</li><li>copy its source files somewhere else
</li></ul>

<p>Operations can be invoked directly, or examined
to see what their effects would be without performing them.
There are a bunch of methods specialised on operation and component type
that actually do the grunt work.
Operations are invoked on systems via <code class="code">operate</code> (see <a class="pxref" href="#operate">operate</a>).
</p>
<p>ASDF contains a number of pre-defined <code class="t">operation</code> classes for common,
and even fairly uncommon tasks that you might want to do with it.
In addition, ASDF contains &ldquo;abstract&rdquo; <code class="t">operation</code> classes that
programmers can use as building blocks to define ASDF extensions.  We
discuss these in turn below.
</p>


<p>Operations are invoked on systems via <code class="code">operate</code>.
<a class="anchor" id="operate"></a></p><dl class="first-deffn">
<dt class="deffn" id="index-operate-1"><span class="category-def">Generic function: </span><span><strong class="def-name">operate</strong> <var class="def-var-arguments"><var class="var">operation</var> <var class="var">component</var> &amp;rest <var class="var">initargs</var> &amp;key <code class="code">force</code> <code class="code">force-not</code> <code class="code">verbose</code> &amp;allow-other-keys</var><a class="copiable-link" href='#index-operate-1'> &para;</a></span></dt>
<dt class="deffnx def-cmd-deffn" id="index-oos-1"><span class="category-def">Generic function: </span><span><strong class="def-name">oos</strong> <var class="def-var-arguments"><var class="var">operation</var> <var class="var">component</var> &amp;rest <var class="var">initargs</var> &amp;key &amp;allow-other-keys</var><a class="copiable-link" href='#index-oos-1'> &para;</a></span></dt>
<dd><p><code class="code">operate</code> invokes <var class="var">operation</var> on <var class="var">system</var>.
<code class="code">oos</code> is a synonym for <code class="code">operate</code> (it stands for operate-on-system).
</p>
<p><var class="var">operation</var> is an operation designator:
it can be an operation object itself, or, typically,
a symbol that is passed to <code class="code">make-operation</code> (which will call <code class="code">make-instance</code>),
to create the operation object.
<var class="var">component</var> is a component designator:
it can be a component object itself, or, typically,
a string or symbol (to be <code class="code">string-downcase</code>d) that names a system,
more rarely a list of strings or symbols that designate a subcomponent of a system.
</p>
<p>The ability to pass <var class="var">initargs</var> to <code class="code">make-operation</code> is now deprecated, and will be removed.
For more details, see <a class="pxref" href="#make_002doperation">make-operation</a>.
Note that dependencies may cause the operation
to invoke other operations on the system or its components:
the new operations may or may not be created
with the same <var class="var">initargs</var> as the original one (for the moment).
</p>
<p>If <var class="var">force</var> is <code class="code">:all</code>, then all systems
are forced to be recompiled even if not modified since last compilation.
If <var class="var">force</var> is <code class="code">t</code>, then only the system being loaded
is forced to be recompiled even if not modified since last compilation,
but other systems are not affected.
If <var class="var">force</var> is a list, then it specifies a list of systems that
are forced to be recompiled even if not modified since last compilation.
If <var class="var">force-not</var> is <code class="code">:all</code>, then all systems
are forced not to be recompiled even if modified since last compilation.
If <var class="var">force-not</var> is <code class="code">t</code>, then all systems but the system being loaded
are forced not to be recompiled even if modified since last compilation
(note: this was changed in ASDF 3.1.2).
If <var class="var">force-not</var> is a list, then it specifies a list of systems that
are forced not to be recompiled even if modified since last compilation.
</p>
<a class="index-entry-id" id="index-register_002dimmutable_002dsystem"></a>
<a class="index-entry-id" id="index-immutable-systems"></a>
<p>Both <var class="var">force</var> and <var class="var">force-not</var> apply to systems that are dependencies and were already compiled.
<var class="var">force-not</var> takes precedences over <var class="var">force</var>,
as it should, really, but unhappily only since ASDF 3.1.2.
Moreover, systems which have been registered as immutable by <code class="code">register-immutable-system</code> (since ASDF 3.1.5)
are always considered <var class="var">forced-not</var>, and even their <samp class="file">.asd</samp> are not refreshed from the filesystem.
See <a class="xref" href="#Miscellaneous-Functions">Miscellaneous Functions</a>.
</p>
<a class="index-entry-id" id="index-traverse"></a>
<p>To see what <code class="code">operate</code> would do, you can use:
</p><div class="example">
<pre class="example-preformatted">(asdf:traverse operation-class system-name)
</pre></div>

</dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-make_002doperation"><span class="category-def">Function: </span><span><strong class="def-name">make-operation</strong> <var class="def-var-arguments"><var class="var">operation-class</var> &amp;rest <var class="var">initargs</var></var><a class="copiable-link" href='#index-make_002doperation'> &para;</a></span></dt>
<dd><a class="anchor" id="make_002doperation"></a>
<p>The <var class="var">initargs</var> are passed to <code class="code">make-instance</code> call
when creating the operation object.
</p>
<p><strong class="strong">Note:</strong><var class="var">initargs</var> for <code class="code">operation</code>s are now deprecated,
and will be removed from ASDF in the near future.
</p>
<p><strong class="strong">Note:</strong> <code class="code">operation</code> instances must <strong class="strong">never</strong> be created
using <code class="code">make-instance</code> directly: only through
<code class="code">make-operation</code>. Attempts to directly make <code class="code">operation</code>
instances will cause a run-time error.
</p></dd></dl>


<hr>
<div class="subsection-level-extent" id="Predefined-operations-of-ASDF">
<h4 class="subsection" id="Predefined-operations-of-ASDF-1">7.1.1 Predefined operations of ASDF</h4>

<p>All the operations described in this section are in the <code class="code">asdf</code> package.
They are invoked via the <code class="code">operate</code> generic function.
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(asdf:operate 'asdf:<var class="var">operation-name</var> :<var class="var">system-name</var> {<var class="var">operation-options ...</var>})
</pre></div>

<dl class="first-deftp">
<dt class="deftp" id="index-compile_002dop"><span class="category-def">Operation: </span><span><strong class="def-name">compile-op</strong><a class="copiable-link" href='#index-compile_002dop'> &para;</a></span></dt>
<dd>
<p>This operation compiles the specified component.
A <code class="code">cl-source-file</code> will be <code class="code">compile-file</code>&rsquo;d.
All the children and dependencies of a system or module
will be recursively compiled by <code class="code">compile-op</code>.
</p>
<p><code class="code">compile-op</code> depends on <code class="code">prepare-op</code> which
itself depends on a <code class="code">load-op</code> of all of a component&rsquo;s dependencies,
as well as of its parent&rsquo;s dependencies.
When <code class="code">operate</code> is called on <code class="code">compile-op</code>,
all these dependencies will be loaded as well as compiled;
yet, some parts of the system main remain unloaded,
because nothing depends on them.
Use <code class="code">load-op</code> to load a system.
</p></dd></dl>

<dl class="first-deftp">
<dt class="deftp" id="index-load_002dop"><span class="category-def">Operation: </span><span><strong class="def-name">load-op</strong><a class="copiable-link" href='#index-load_002dop'> &para;</a></span></dt>
<dd>
<p>This operation loads the compiled code for a specified component.
A <code class="code">cl-source-file</code> will have its compiled fasl <code class="code">load</code>ed,
which fasl is the output of <code class="code">compile-op</code> that <code class="code">load-op</code> depends on.
</p>
<p><code class="code">load-op</code> will recursively load all the children of a system or module.
</p>
<p><code class="code">load-op</code> also depends on <code class="code">prepare-op</code> which
itself depends on a <code class="code">load-op</code> of all of a component&rsquo;s dependencies,
as well as of its parent&rsquo;s dependencies.
</p></dd></dl>

<dl class="first-deftp">
<dt class="deftp" id="index-prepare_002dop"><span class="category-def">Operation: </span><span><strong class="def-name">prepare-op</strong><a class="copiable-link" href='#index-prepare_002dop'> &para;</a></span></dt>
<dd>
<p>This operation ensures that the dependencies of a component
and its recursive parents are loaded (as per <code class="code">load-op</code>),
as a prerequisite before <code class="code">compile-op</code> and <code class="code">load-op</code> operations
may be performed on a given component.
</p></dd></dl>

<dl class="first-deftp">
<dt class="deftp" id="index-load_002dsource_002dop"><span class="category-def">Operation: </span><span><strong class="def-name">load-source-op</strong><a class="copiable-link" href='#index-load_002dsource_002dop'> &para;</a></span></dt>
<dt class="deftpx def-cmd-deftp" id="index-prepare_002dsource_002dop"><span class="category-def">Operation: </span><span><strong class="def-name">prepare-source-op</strong><a class="copiable-link" href='#index-prepare_002dsource_002dop'> &para;</a></span></dt>
<dd>
<p><code class="code">load-source-op</code> will load the source for the files in a module
rather than the compiled fasl output.
It has a <code class="code">prepare-source-op</code> analog to <code class="code">prepare-op</code>,
that ensures the dependencies are themselves loaded via <code class="code">load-source-op</code>.
</p>
</dd></dl>

<a class="anchor" id="test_002dop"></a><dl class="first-deftp">
<dt class="deftp" id="index-test_002dop"><span class="category-def">Operation: </span><span><strong class="def-name">test-op</strong><a class="copiable-link" href='#index-test_002dop'> &para;</a></span></dt>
<dd>
<p>This operation will perform some tests on the module.
The default method will do nothing.
The default dependency is to require
<code class="code">load-op</code> to be performed on the module first.
Its default <code class="code">operation-done-p</code> method returns <code class="code">nil</code>,
which means that the operation is <em class="emph">never</em> done
&ndash;
we assume that if you invoke the <code class="code">test-op</code>,
you want to test the system, even if you have already done so.
</p>
<p>The results of this operation are not defined by ASDF.
It has proven difficult to define how the test operation
should signal its results to the user
in a way that is compatible with all of the various test libraries
and test techniques in use in the community, and
given the fact that ASDF operations do not return a value indicating
success or failure.
For those willing to go to the effort, we suggest defining conditions to
signal when a <code class="code">test-op</code> fails, and storing in those conditions
information that describes which tests fail.
</p>
<p>People typically define a separate test <em class="emph">system</em> to hold the tests.
Doing this avoids unnecessarily adding a test framework as a dependency
on a library.  For example, one might have
</p><div class="example lisp">
<pre class="lisp-preformatted">(defsystem &quot;foo&quot;
  :in-order-to ((test-op (test-op &quot;foo/test&quot;)))
 ...)

(defsystem &quot;foo/test&quot;
  :depends-on (&quot;foo&quot; &quot;fiveam&quot;) ; fiveam is a test framework library
  ...)
</pre></div>

<p>Then one defines <code class="code">perform</code> methods on
<code class="code">test-op</code> such as the following:
</p><div class="example lisp">
<pre class="lisp-preformatted">(defsystem &quot;foo/test&quot;
  :depends-on (&quot;foo&quot; &quot;fiveam&quot;) ; fiveam is a test framework library
  :perform (test-op (o s)
                    (uiop:symbol-call :fiveam '#:run!
                       (uiop:find-symbol* '#:foo-test-suite
                                            :foo-tests)))
  ...)
</pre></div>

</dd></dl>


<a class="index-entry-id" id="index-bundle-operations"></a>
<dl class="first-deftp">
<dt class="deftp" id="index-compile_002dbundle_002dop"><span class="category-def">Operation: </span><span><strong class="def-name">compile-bundle-op</strong><a class="copiable-link" href='#index-compile_002dbundle_002dop'> &para;</a></span></dt>
<dt class="deftpx def-cmd-deftp" id="index-monolithic_002dcompile_002dbundle_002dop"><span class="category-def">Operation: </span><span><strong class="def-name">monolithic-compile-bundle-op</strong><a class="copiable-link" href='#index-monolithic_002dcompile_002dbundle_002dop'> &para;</a></span></dt>
<dt class="deftpx def-cmd-deftp" id="index-load_002dbundle_002dop"><span class="category-def">Operation: </span><span><strong class="def-name">load-bundle-op</strong><a class="copiable-link" href='#index-load_002dbundle_002dop'> &para;</a></span></dt>
<dt class="deftpx def-cmd-deftp" id="index-monolithic_002dload_002dbundle_002dop"><span class="category-def">Operation: </span><span><strong class="def-name">monolithic-load-bundle-op</strong><a class="copiable-link" href='#index-monolithic_002dload_002dbundle_002dop'> &para;</a></span></dt>
<dt class="deftpx def-cmd-deftp" id="index-deliver_002dasd_002dop"><span class="category-def">Operation: </span><span><strong class="def-name">deliver-asd-op</strong><a class="copiable-link" href='#index-deliver_002dasd_002dop'> &para;</a></span></dt>
<dt class="deftpx def-cmd-deftp" id="index-monolithic_002ddeliver_002dasd_002dop"><span class="category-def">Operation: </span><span><strong class="def-name">monolithic-deliver-asd-op</strong><a class="copiable-link" href='#index-monolithic_002ddeliver_002dasd_002dop'> &para;</a></span></dt>
<dt class="deftpx def-cmd-deftp" id="index-lib_002dop"><span class="category-def">Operation: </span><span><strong class="def-name">lib-op</strong><a class="copiable-link" href='#index-lib_002dop'> &para;</a></span></dt>
<dt class="deftpx def-cmd-deftp" id="index-monolithic_002dlib_002dop"><span class="category-def">Operation: </span><span><strong class="def-name">monolithic-lib-op</strong><a class="copiable-link" href='#index-monolithic_002dlib_002dop'> &para;</a></span></dt>
<dt class="deftpx def-cmd-deftp" id="index-dll_002dop"><span class="category-def">Operation: </span><span><strong class="def-name">dll-op</strong><a class="copiable-link" href='#index-dll_002dop'> &para;</a></span></dt>
<dt class="deftpx def-cmd-deftp" id="index-monolithic_002ddll_002dop"><span class="category-def">Operation: </span><span><strong class="def-name">monolithic-dll-op</strong><a class="copiable-link" href='#index-monolithic_002ddll_002dop'> &para;</a></span></dt>
<dt class="deftpx def-cmd-deftp" id="index-image_002dop"><span class="category-def">Operation: </span><span><strong class="def-name">image-op</strong><a class="copiable-link" href='#index-image_002dop'> &para;</a></span></dt>
<dt class="deftpx def-cmd-deftp" id="index-program_002dop"><span class="category-def">Operation: </span><span><strong class="def-name">program-op</strong><a class="copiable-link" href='#index-program_002dop'> &para;</a></span></dt>
<dd>
<p>These are &ldquo;bundle&rdquo; operations, that can create a single-file &ldquo;bundle&rdquo;
for all the contents of each system in an application,
or for the entire application.
</p>
<p><code class="code">compile-bundle-op</code> will create a single fasl file for each of the systems needed,
grouping all its many fasls in one,
so you can deliver each system as a single fasl.
<code class="code">monolithic-compile-bundle-op</code> will create a single fasl file for the target system
and all its dependencies,
so you can deliver your entire application as a single fasl.
<code class="code">load-bundle-op</code> will load the output of <code class="code">compile-bundle-op</code>.
Note that if the output is not up-to-date,
<code class="code">compile-bundle-op</code> may load the intermediate fasls as a side-effect.
Bundling fasls together matters a lot on ECL,
where the dynamic linking involved in loading tens of individual fasls
can be noticeably more expensive than loading a single one.
</p>
<p>NB: <code class="code">compile-bundle-op</code>, <code class="code">monolithic-compile-bundle-op</code>, <code class="code">load-bundle-op</code>, <code class="code">monolithic-load-bundle-op</code>, <code class="code">deliver-asd-op</code>, <code class="code">monolithic-deliver-asd-op</code> were respectively called
<code class="code">fasl-op</code>, <code class="code">monolithic-fasl-op</code>, <code class="code">load-fasl-op</code>, <code class="code">monolithic-load-fasl-op</code>, <code class="code">binary-op</code>, <code class="code">monolithic-binary-op</code> before ASDF 3.1.
The old names still exist for backward compatibility,
though they poorly label what is going on.
</p>
<p>Once you have created a fasl with <code class="code">compile-bundle-op</code>,
you can use <code class="code">precompiled-system</code> to deliver it in a way
that is compatible with clients having dependencies on your system,
whether it is distributed as source or as a single binary;
the <samp class="file">.asd</samp> file to be delivered with the fasl will look like this:
</p><div class="example">
<pre class="example-preformatted">(defsystem :mysystem :class :precompiled-system
  :fasl (some expression that will evaluate to a pathname))
</pre></div>
<p>Or you can use <code class="code">deliver-asd-op</code> to let ASDF create such a system for you
as well as the <code class="code">compile-bundle-op</code> output,
or <code class="code">monolithic-deliver-asd-op</code>.
This allows you to deliver code for your systems or applications
as a single file.
Of course, if you want to test the result in the current image,
<em class="emph">before</em> you try to use any newly created <samp class="file">.asd</samp> files,
you should not forget to <code class="code">(asdf:clear-configuration)</code>
or at least <code class="code">(asdf:clear-source-registry)</code>,
so it re-populates the source-registry from the filesystem.
</p>
<p>The <code class="code">program-op</code> operation will create an executable program
from the specified system and its dependencies.
You can use UIOP for its pre-image-dump hooks, its post-image-restore hooks,
and its access to command-line arguments.
And you can specify an entry point <code class="code">my-app:main</code>
by specifying in your <code class="code">defsystem</code>
the option <code class="code">:entry-point &quot;my-app:main&quot;</code>.
Depending on your implementation,
running <code class="code">(asdf:operate 'asdf:program-op :my-app)</code>
may quit the current Lisp image upon completion.
See the example in
<samp class="file">test/hello-world-example.asd</samp> and <samp class="file">test/hello.lisp</samp>,
as built and tested by
<samp class="file">test/test-program.script</samp> and <samp class="file">test/make-hello-world.lisp</samp>.
<code class="code">image-op</code> will dump an image that may not be standalone
and does not start its own function,
but follows the usual execution convention of the underlying Lisp,
just with more code pre-loaded,
for use as an intermediate build result or with a wrapper invocation script.
</p>
<p>There is also <code class="code">lib-op</code>
for building a linkable <samp class="file">.a</samp> file (Windows: <samp class="file">.lib</samp>)
from all linkable object dependencies (FFI files, and on ECL, Lisp files too),
and its monolithic equivalent <code class="code">monolithic-lib-op</code>.
And there is also <code class="code">dll-op</code>
(respectively its monolithic equivalent <code class="code">monolithic-dll-op</code>)
for building a linkable <samp class="file">.so</samp> file
(Windows: <samp class="file">.dll</samp>, MacOS X: <samp class="file">.dynlib</samp>)
to create a single dynamic library
for all the extra FFI code to be linked into each of your systems
(respectively your entire application).
</p>
<p>All these &ldquo;bundle&rdquo; operations are available since ASDF 3
on all actively supported Lisp implementations,
but may be unavailable on unmaintained legacy implementations.
This functionality was previously available for select implementations,
as part of a separate system <code class="code">asdf-bundle</code>,
itself descended from the ECL-only <code class="code">asdf-ecl</code>.
</p>
<p>The pathname of the output of bundle operations
is subject to output-translation as usual,
unless the operation is equal to
the <code class="code">:build-operation</code> argument to <code class="code">defsystem</code>.
This behaviour is not very satisfactory and may change in the future.
Maybe you have suggestions on how to better configure it?
</p></dd></dl>

<dl class="first-deftp">
<dt class="deftp" id="index-concatenate_002dsource_002dop"><span class="category-def">Operation: </span><span><strong class="def-name">concatenate-source-op</strong><a class="copiable-link" href='#index-concatenate_002dsource_002dop'> &para;</a></span></dt>
<dt class="deftpx def-cmd-deftp" id="index-monolithic_002dconcatenate_002dsource_002dop"><span class="category-def">Operation: </span><span><strong class="def-name">monolithic-concatenate-source-op</strong><a class="copiable-link" href='#index-monolithic_002dconcatenate_002dsource_002dop'> &para;</a></span></dt>
<dt class="deftpx def-cmd-deftp" id="index-load_002dconcatenated_002dsource_002dop"><span class="category-def">Operation: </span><span><strong class="def-name">load-concatenated-source-op</strong><a class="copiable-link" href='#index-load_002dconcatenated_002dsource_002dop'> &para;</a></span></dt>
<dt class="deftpx def-cmd-deftp" id="index-compile_002dconcatenated_002dsource_002dop"><span class="category-def">Operation: </span><span><strong class="def-name">compile-concatenated-source-op</strong><a class="copiable-link" href='#index-compile_002dconcatenated_002dsource_002dop'> &para;</a></span></dt>
<dt class="deftpx def-cmd-deftp" id="index-load_002dcompiled_002dconcatenated_002dsource_002dop"><span class="category-def">Operation: </span><span><strong class="def-name">load-compiled-concatenated-source-op</strong><a class="copiable-link" href='#index-load_002dcompiled_002dconcatenated_002dsource_002dop'> &para;</a></span></dt>
<dt class="deftpx def-cmd-deftp" id="index-monolithic_002dload_002dconcatenated_002dsource_002dop"><span class="category-def">Operation: </span><span><strong class="def-name">monolithic-load-concatenated-source-op</strong><a class="copiable-link" href='#index-monolithic_002dload_002dconcatenated_002dsource_002dop'> &para;</a></span></dt>
<dt class="deftpx def-cmd-deftp" id="index-monolithic_002dcompile_002dconcatenated_002dsource_002dop"><span class="category-def">Operation: </span><span><strong class="def-name">monolithic-compile-concatenated-source-op</strong><a class="copiable-link" href='#index-monolithic_002dcompile_002dconcatenated_002dsource_002dop'> &para;</a></span></dt>
<dt class="deftpx def-cmd-deftp" id="index-monolithic_002dload_002dcompiled_002dconcatenated_002dsource_002dop"><span class="category-def">Operation: </span><span><strong class="def-name">monolithic-load-compiled-concatenated-source-op</strong><a class="copiable-link" href='#index-monolithic_002dload_002dcompiled_002dconcatenated_002dsource_002dop'> &para;</a></span></dt>
<dd>
<p>These operations, as their respective names indicate,
will concatenate all the <code class="code">cl-source-file</code> source files in a system
(or in a system and all its dependencies, if monolithic),
in the order defined by dependencies,
then load the result, or compile and then load the result.
</p>
<p>These operations are useful to deliver a system or application
as a single source file,
and for testing that said file loads properly, or compiles and then loads properly.
</p>
<p>ASDF itself is delivered as a single source file this way,
using <code class="code">monolithic-concatenate-source-op</code>,
prepending a prelude and the <code class="code">uiop</code> library
before the <code class="code">asdf/defsystem</code> system itself.
</p></dd></dl>

<p>See also FAQ entries see <a class="pxref" href="#What-happened-to-the-bundle-operations">What happened to the bundle operations?</a> and see <a class="pxref" href="#How-can-I-produce-a-binary-at-a-specific-path-from-sources-at-a-specific-path">How can I produce a binary at a specific path from sources at a specific path?</a>.
</p>

<hr>
</div>
<div class="subsection-level-extent" id="Creating-new-operations">
<h4 class="subsection" id="Creating-new-operations-1">7.1.2 Creating new operations</h4>

<p>ASDF was designed to be extensible in an object-oriented fashion.
To teach ASDF new tricks, a programmer can implement the behaviour he wants
by creating a subclass of <code class="code">operation</code>.
</p>
<p>ASDF&rsquo;s pre-defined operations are in no way &ldquo;privileged&rdquo;,
but it is requested that developers never use the <code class="code">asdf</code> package
for operations they develop themselves.
The rationale for this rule is that we don&rsquo;t want to establish a
&ldquo;global asdf operation name registry&rdquo;,
but also want to avoid name clashes.
</p>
<p>Your operation <em class="emph">must</em> usually provide methods
for one or more of the following generic functions:
</p>
<ul class="itemize mark-bullet">
<li><a class="index-entry-id" id="index-perform"></a>
<code class="code">perform</code>
Unless your operation, like <code class="code">prepare-op</code>,
is for dependency propagation only,
the most important function for which to define a method
is usually <code class="code">perform</code>,
which will be called to perform the operation on a specified component,
after all dependencies have been performed.

<p>The <code class="code">perform</code> method must call <code class="code">input-files</code> and <code class="code">output-files</code> (see below)
to locate its inputs and outputs,
because the user is allowed to override the method
or tweak the output-translation mechanism.
Perform should only use the primary value returned by <code class="code">output-files</code>.
If one and only one output file is expected,
it can call <code class="code">output-file</code> that checks that this is the case
and returns the first and only list element.
</p>
</li><li><a class="index-entry-id" id="index-output_002dfiles"></a>
<code class="code">output-files</code>
If your perform method has any output,
you must define a method for this function.
for ASDF to determine where the outputs of performing operation lie.

<p>Your method may return two values, a list of pathnames, and a boolean.
If the boolean is <code class="code">nil</code> (or you fail to return multiple values),
then enclosing <code class="code">:around</code> methods may translate these pathnames,
e.g. to ensure object files are somehow stored
in some implementation-dependent cache.
If the boolean is <code class="code">t</code> then the pathnames are marked
not be translated by the enclosing <code class="code">:around</code> method.
</p>
</li><li><a class="index-entry-id" id="index-component_002ddepends_002don"></a>
<code class="code">component-depends-on</code>
<em class="emph">Previously,</em> if you were adding a new operation, and it had
dependencies, it was necessary to define
a method on <code class="code">component-depends-on</code>.

<a class="index-entry-id" id="index-downward_002doperation"></a>
<a class="index-entry-id" id="index-upward_002doperation"></a>
<a class="index-entry-id" id="index-sideway_002doperation"></a>
<a class="index-entry-id" id="index-selfward_002doperation"></a>
<a class="index-entry-id" id="index-non_002dpropagating_002doperation"></a>
<p><em class="emph">For most cases this is no longer necessary,</em> now ASDF has built in
<code class="code">operation</code> subclasses that provide dependency management for you,
specifically the classes
<code class="code">downward-operation</code> <code class="code">upward-operation</code>
<code class="code">sideway-operation</code> <code class="code">selfward-operation</code>
<code class="code">non-propagating-operation</code>.
</p>
<p>Only if one of those operations does not meet your needs should you
write a method for <code class="code">component-depends-on</code>.
In this case, your method will take as specialized arguments
an <code class="code">operation</code> and a <code class="code">component</code> which together identify an action,
and return a list of entries describing actions that this action depends on.
The format of entries is described below.
</p>
<p>We <em class="emph">strongly</em> advise
appending the results of <code class="code">(call-next-method)</code>
to the results of your method,
or &ldquo;interesting&rdquo; failures are likely to occur,
unless you&rsquo;re a true expert in ASDF internals.
It is unhappily too late to compatibly use the <code class="code">append</code> method combination,
but conceptually that&rsquo;s the protocol that is being manually implemented.
</p>
<p>Each entry returned by <code class="code">component-depends-on</code> is itself a list.
</p>
<p>The first element of an entry is an operation designator:
either an operation object designating itself, or
a symbol that names an operation class
(that ASDF will instantiate using <code class="code">make-operation</code>).
For instance, <code class="code">load-op</code>, <code class="code">compile-op</code> and <code class="code">prepare-op</code>
are common such names, denoting the respective operations.
</p>
<a class="index-entry-id" id="index-coerce_002dname"></a>
<a class="index-entry-id" id="index-find_002dcomponent"></a>
<p>The rest of each entry is a list of component designators:
either a component object designating itself,
or an identifier to be used with <code class="code">find-component</code>.
<code class="code">find-component</code> will be called with the current component&rsquo;s parent as parent,
and the identifier as second argument.
The identifier is typically a string,
a symbol (to be downcased as per <code class="code">coerce-name</code>),
or a list of strings or symbols.
In particular, the empty list <code class="code">nil</code> denotes the parent itself.
</p>
</li></ul>

<p>An operation <em class="emph">may</em> provide methods for the following generic functions:
</p>
<ul class="itemize mark-bullet">
<li><code class="code">input-files</code>
<a class="index-entry-id" id="index-input_002dfiles"></a>
<code class="code">(input-files <var class="var">operation</var> <var class="var">component</var>)</code> should return a
list of the files taken as input when applying <var class="var">operation</var> to
<var class="var">component</var>. ASDF will inspect the file modification timestamps on
these files to decide whether to re-run an action. A return value of <code class="code">nil</code>
denotes an action which takes no files as input.

<p>Operations which subclass <code class="code">selfward-operation</code> will usually not need to define a method on <code class="code">input-files</code>, as a method on <code class="code">selfward-operation</code> collects the <code class="code">output-files</code> of all the selfward dependencies.
</p>
<p>Operations which take no files as input need not define a method, as a default method returns <code class="code">nil</code>.
</p>
<p>Operations which are not selfward and read files as input should define methods on this function.
</p>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-input_002dfiles-1"><span class="category-def">Function: </span><span><strong class="def-name">input-files</strong> <var class="def-var-arguments">operation component</var><a class="copiable-link" href='#index-input_002dfiles-1'> &para;</a></span></dt>
<dd><p>Return a list of pathnames that represent the input to <var class="var">operation</var>
performed on <var class="var">component</var>.
</p></dd></dl>

</li><li><code class="code">operation-done-p</code>
<a class="index-entry-id" id="index-operation_002ddone_002dp"></a>
You only need to define a method on that function
if you can detect conditions that invalidate previous runs of the operation,
even though no filesystem timestamp has changed,
in which case you return <code class="code">nil</code> (the default is <code class="code">t</code>).

<p>For instance, the method for <code class="code">test-op</code> always returns <code class="code">nil</code>,
so that tests are always run afresh.
Of course, the <code class="code">test-op</code> for your system could depend
on a deterministically repeatable <code class="code">test-report-op</code>,
and just read the results from the report files,
in which case you could have this method return <code class="code">t</code>.
</p>
</li></ul>

<p>Operations that print output should send that output to the standard
CL stream <code class="code">*standard-output*</code>, as the Lisp compiler and loader do.
</p>
<hr>
</div>
</div>
<div class="section-level-extent" id="Components">
<h3 class="section" id="Components-1">7.2 Components</h3>
<a class="index-entry-id" id="index-component"></a>
<a class="index-entry-id" id="index-system"></a>
<a class="index-entry-id" id="index-system-designator"></a>
<a class="index-entry-id" id="index-component-designator"></a>
<a class="index-entry-id" id="index-_002asystem_002ddefinition_002dsearch_002dfunctions_002a"></a>

<p>A <code class="code">component</code> represents an individual source file or a group of source files,
and the things that get transformed into.
A <code class="code">system</code> is a component at the top level of the component hierarchy,
that can be found via <code class="code">find-system</code>.
A <code class="code">source-file</code> is a component representing a single source-file
and the successive output files into which it is transformed.
A <code class="code">module</code> is an intermediate component itself grouping several other components,
themselves source-files or further modules.
</p>
<p>A <em class="dfn">system designator</em> is a system itself,
or a string or symbol that behaves just like any other component name
(including with regard to the case conversion rules for component names).
</p>
<p>A <em class="dfn">component designator</em>, relative to a base component,
is either a component itself,
or a string or symbol,
or a list of designators.
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-find_002dsystem"><span class="category-def">Function: </span><span><strong class="def-name">find-system</strong> <var class="def-var-arguments">system-designator &amp;optional (error-p t)</var><a class="copiable-link" href='#index-find_002dsystem'> &para;</a></span></dt>
<dd>
<p>Given a system designator, <code class="code">find-system</code> finds and returns a system.
If no system is found, an error of type
<code class="code">missing-component</code> is thrown,
or <code class="code">nil</code> is returned if <code class="code">error-p</code> is false.
</p>
<p>To find and update systems, <code class="code">find-system</code> funcalls each element
in the <code class="code">*system-definition-search-functions*</code> list,
expecting a pathname to be returned, or a system object,
from which a pathname may be extracted, and that will be registered.
The resulting pathname (if any) is loaded
if one of the following conditions is true:
</p>
<ul class="itemize mark-bullet">
<li>there is no system of that name in memory
</li><li>the pathname is different from that which was previously loaded
</li><li>the file&rsquo;s <code class="code">last-modified</code> time exceeds the <code class="code">last-modified</code> time
of the system in memory
</li></ul>

<a class="index-entry-id" id="index-ASDF_002dUSER-package"></a>
<p>When system definitions are loaded from <samp class="file">.asd</samp> files,
they are implicitly loaded into the <code class="code">ASDF-USER</code> package,
which uses <code class="code">ASDF</code>, <code class="code">UIOP</code> and <code class="code">UIOP/COMMON-LISP</code><a class="footnote" id="DOCF12" href="#FOOT12"><sup>12</sup></a>
Programmers who do anything non-trivial in a <samp class="file">.asd</samp> file,
such as defining new variables, functions or classes,
should include <code class="code">defpackage</code> and <code class="code">in-package</code> forms in this file,
so they will not overwrite each others&rsquo; extensions.
Such forms might also help the files behave identically
if loaded manually with <code class="code">cl:load</code> for development or debugging,
though we recommend you use the function <code class="code">asdf::load-asd</code> instead,
which the <code class="code">slime-asdf</code> contrib knows about.
</p>
<p>The default value of <code class="code">*system-definition-search-functions*</code>
is a list of three functions.
The first function looks in each of the directories given
by evaluating members of <code class="code">*central-registry*</code>
for a file whose name is the name of the system and whose type is <samp class="file">asd</samp>;
the first such file is returned,
whether or not it turns out to actually define the appropriate system.
The second function does something similar,
for the directories specified in the <code class="code">source-registry</code>,
but searches the filesystem only once and caches its results.
The third function makes the <code class="code">package-inferred-system</code> extension work,
see <a class="pxref" href="#The-package_002dinferred_002dsystem-extension">The package-inferred-system extension</a>.
</p>
<p>Because of the way these search functions are defined,
you should put the definition for a system
<var class="var">foo</var> in a file named <samp class="file">foo.asd</samp>,
in a directory that is
in the central registry or
which can be found using the
source registry configuration.
</p>
<a class="anchor" id="System-names"></a><a class="index-entry-id" id="index-System-names"></a>
<a class="index-entry-id" id="index-Primary-system-name"></a>
<a class="index-entry-id" id="index-primary_002dsystem_002dname"></a>
<p>It is often useful to define multiple systems in a same file,
but ASDF can only locate a system&rsquo;s definition file based on the system
name.
For this reason,
ASDF 3&rsquo;s system search algorithm has been extended to
allow a file <samp class="file">foo.asd</samp> to contain
secondary systems named <var class="var">foo/bar</var>, <var class="var">foo/baz</var>, <var class="var">foo/quux</var>, etc.,
in addition to the primary system named <var class="var">foo</var>.
The first component of a system name,
separated by the slash character, <code class="code">/</code>,
is called the primary name of a system.
The primary name may be
extracted by function <code class="code">asdf::primary-system-name</code>;
when ASDF 3 is told to find a system whose name has a slash,
it will first attempt to load the corresponding primary system,
and will thus see any such definitions, and/or any
definition of a <code class="code">package-inferred-system</code>.<a class="footnote" id="DOCF13" href="#FOOT13"><sup>13</sup></a>
If your file <samp class="file">foo.asd</samp> also defines systems
that do not follow this convention, e.g., a system named <var class="var">foo-test</var>,
ASDF will not be able to automatically locate a definition for these systems,
and will only see their definition
if you explicitly find or load the primary system
using e.g. <code class="code">(asdf:find-system &quot;foo&quot;)</code> before you try to use them.
We strongly recommend against this practice,
though it is currently supported for backward compatibility.
</p>
</dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-primary_002dsystem_002dname-1"><span class="category-def">Function: </span><span><strong class="def-name">primary-system-name</strong> <var class="def-var-arguments">name</var><a class="copiable-link" href='#index-primary_002dsystem_002dname-1'> &para;</a></span></dt>
<dd>
<p>Internal (not exported) function, <code class="code">asdf::primary-system-name</code>.
Returns the primary system name (the portion before
the slash, <code class="code">/</code>, in a secondary system name) from <var class="var">name</var>.
</p>
</dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-locate_002dsystem"><span class="category-def">Function: </span><span><strong class="def-name">locate-system</strong> <var class="def-var-arguments">name</var><a class="copiable-link" href='#index-locate_002dsystem'> &para;</a></span></dt>
<dd>
<p>This function should typically <em class="emph">not</em> be invoked directly.  It is
exported as part of the API only for programmers who wish to provide
their own <code class="code">*system-definition-search-functions*</code>.
</p>
<p>Given a system <var class="var">name</var> designator,
try to locate where to load the system definition from.
Returns five values: <var class="var">foundp</var>, <var class="var">found-system</var>, <var class="var">pathname</var>,
<var class="var">previous</var>, and <var class="var">previous-time</var>.
<var class="var">foundp</var> is true when a system was found,
either a new as yet unregistered one, or a previously registered one.
The <var class="var">found-system</var> return value
will be a <code class="code">system</code> object, if a system definition is found in your
source registry.
The system definition will <em class="emph">not</em> be
loaded if it hasn&rsquo;t been loaded already.
<var class="var">pathname</var> when not null is a path from which to load the system,
either associated with <var class="var">found-system</var>, or with the <var class="var">previous</var> system.
If <var class="var">previous</var> is not null, it will be a <em class="emph">previously loaded</em>
<code class="code">system</code> object of the same name (note that the system
<em class="emph">definition</em> is previously-loaded: the system itself may or may not be).
<var class="var">previous-time</var> when not null is
the timestamp of the previous system definition file, at the
time when the <var class="var">previous</var> system definition was loaded.
</p>
<p>For example, if your current registry has <samp class="file">foo.asd</samp> in
<samp class="file">/current/path/to/foo.asd</samp>,
but system <code class="code">foo</code> was previously loaded from <samp class="file">/previous/path/to/foo.asd</samp>
then <var class="var">locate-system</var> will return the following values:
</p><ol class="enumerate">
<li> <var class="var">foundp</var> will be <code class="code">t</code>,
</li><li> <var class="var">found-system</var> will be <code class="code">nil</code>,
</li><li> <var class="var">pathname</var> will be <code class="code">#p&quot;/current/path/to/foo.asd&quot;</code>,
</li><li> <var class="var">previous</var> will be an object of type <code class="code">SYSTEM</code> with
<code class="code">system-source-file</code> slot value of
<code class="code">#p&quot;/previous/path/to/foo.asd&quot;</code>
</li><li> <var class="var">previous-time</var> will be the timestamp of
<code class="code">#p&quot;/previous/path/to/foo.asd&quot;</code> at the time it was loaded.
</li></ol>
</dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-find_002dcomponent-1"><span class="category-def">Function: </span><span><strong class="def-name">find-component</strong> <var class="def-var-arguments">base path</var><a class="copiable-link" href='#index-find_002dcomponent-1'> &para;</a></span></dt>
<dd>
<p>Given a <var class="var">base</var> component (or designator for such),
and a <var class="var">path</var>, find the component designated by the <var class="var">path</var>
starting from the <var class="var">base</var>.
</p>
<p>If <var class="var">path</var> is a component object, it designates itself,
independently from the base.
</p>
<a class="index-entry-id" id="index-coerce_002dname-1"></a>
<p>If <var class="var">path</var> is a string, or symbol denoting a string via <code class="code">coerce-name</code>,
then <var class="var">base</var> is resolved to a component object,
which must be a system or module,
and the designated component is the child named by the <var class="var">path</var>.
</p>
<p>If <var class="var">path</var> is a <code class="code">cons</code> cell,
<code class="code">find-component</code> with the base and the <code class="code">car</code> of the <var class="var">path</var>,
and the resulting object is used as the base for a tail call
to <code class="code">find-component</code> with the <code class="code">car</code> of the <var class="var">path</var>.
</p>
<p>If <var class="var">base</var> is a component object, it designates itself.
</p>
<p>If <var class="var">base</var> is null, then <var class="var">path</var> is used as the base, with <code class="code">nil</code> as the path.
</p>
<p>If <var class="var">base</var> is a string, or symbol denoting a string via <code class="code">coerce-name</code>,
it designates a system as per <code class="code">find-system</code>.
</p>
<p>If <var class="var">base</var> is a <code class="code">cons</code> cell, it designates the component found by
<code class="code">find-component</code> with its <code class="code">car</code> as base and <code class="code">cdr</code> as path.
</p></dd></dl>



<hr>
<div class="subsection-level-extent" id="Common-attributes-of-components">
<h4 class="subsection" id="Common-attributes-of-components-1">7.2.1 Common attributes of components</h4>

<p>All components, regardless of type, have the following attributes.
All attributes except <code class="code">name</code> are optional.
</p>
<div class="subsubsection-level-extent" id="Name">
<h4 class="subsubsection">7.2.1.1 Name</h4>
<a class="index-entry-id" id="index-coerce_002dname-2"></a>
<p>A component name is a string or a symbol.
If a symbol, its name is taken and lowercased.  This translation is
performed by the exported function <code class="code">coerce-name</code>.
</p>
<p>Unless overridden by a <code class="code">:pathname</code> attribute,
the name will be interpreted as a pathname specifier according
to a Unix-style syntax.
See <a class="xref" href="#Pathname-specifiers">Pathname specifiers</a>.
</p>
</div>
<div class="subsubsection-level-extent" id="Version-identifier">
<h4 class="subsubsection">7.2.1.2 Version identifier</h4>
<a class="index-entry-id" id="index-version_002dsatisfies"></a>
<a class="index-entry-id" id="index-_003aversion-2"></a>

<p>This optional attribute specifies a version for the current component.
The version should typically be a string of integers separated by dots,
for example &lsquo;<samp class="samp">1.0.11</samp>&rsquo;. See <a class="xref" href="#Version-specifiers">Version specifiers</a>.
</p>
<p>A version may then be queried by the generic function <code class="code">version-satisfies</code>,
to see if <code class="code">:version</code> dependencies are satisfied,
and when specifying dependencies, a constraint of minimal version to satisfy
can be specified using e.g. <code class="code">(:version &quot;mydepname&quot; &quot;1.0.11&quot;)</code>.
</p>
<p>Note that in the wild, we typically see version numbering
only on components of type <code class="code">system</code>.
Presumably it is much less useful within a given system,
wherein the library author is responsible to keep the various files in synch.
</p>
</div>
<div class="subsubsection-level-extent" id="Required-features">
<h4 class="subsubsection">7.2.1.3 Required features</h4>
<a class="anchor" id="required_002dfeatures"></a>
<p>Traditionally defsystem users have used <code class="code">#+</code> reader conditionals
to include or exclude specific per-implementation files.
For example, CFFI, the portable C foreign function interface contained
lines like:
</p><div class="example lisp">
<pre class="lisp-preformatted">     #+sbcl       (:file &quot;cffi-sbcl&quot;)
</pre></div>
<p>An unfortunate side effect of this approach is that no single
implementation can read the entire system.
This causes problems if, for example, one wished to design an <code class="code">archive-op</code>
that would create an archive file containing all the sources, since
for example the file <code class="code">cffi-sbcl.lisp</code> above would be invisible when
running the <code class="code">archive-op</code> on any implementation other than SBCL.
</p>
<p>Starting with ASDF 3,
components may therefore have an <code class="code">:if-feature</code> option.
The value of this option should be
a feature expression using the same syntax as <code class="code">#+</code> does.
If that feature expression evaluates to false, any reference to the component will be ignored
during compilation, loading and/or linking.
Since the expression is read by the normal reader,
you must explicitly prefix your symbols with <code class="code">:</code> so they be read as keywords;
this is as contrasted with the <code class="code">#+</code> syntax
that implicitly reads symbols in the keyword package by default.
</p>
<p>For instance, <code class="code">:if-feature (:and :x86 (:or :sbcl :cmu :scl))</code> specifies that
the given component is only to be compiled and loaded
when the implementation is SBCL, CMUCL or Scieneer CL on an x86 machine.
You cannot write it as <code class="code">:if-feature (and x86 (or sbcl cmu scl))</code>
since the symbols would not be read as keywords.
</p>
<p>See <a class="xref" href="#if_002dfeature-option">if-feature option</a>.
</p>
</div>
<div class="subsubsection-level-extent" id="Dependencies-1">
<h4 class="subsubsection">7.2.1.4 Dependencies</h4>

<p>This attribute specifies dependencies of the component on its siblings.
It is optional but often necessary.
</p>
<p>There is an excitingly complicated relationship between the initarg
and the method that you use to ask about dependencies
</p>
<p>Dependencies are between (operation component) pairs.
In your initargs for the component, you can say
</p>
<div class="example lisp">
<pre class="lisp-preformatted">:in-order-to ((compile-op (load-op &quot;a&quot; &quot;b&quot;) (compile-op &quot;c&quot;))
              (load-op (load-op &quot;foo&quot;)))
</pre></div>

<p>This means the following things:
</p><ul class="itemize mark-bullet">
<li>before performing compile-op on this component, we must perform
load-op on <var class="var">a</var> and <var class="var">b</var>, and compile-op on <var class="var">c</var>,
</li><li>before performing <code class="code">load-op</code>, we have to load <var class="var">foo</var>
</li></ul>

<p>The syntax is approximately
</p>
<pre class="verbatim">(this-op @{(other-op required-components)@}+)

simple-component-name := string
                      |  symbol

required-components := simple-component-name
                     | (required-components required-components)

component-name := simple-component-name
                | (:version simple-component-name minimum-version-object)
</pre>
<p>Side note:
</p>
<p>This is on a par with what ACL defsystem does.
mk-defsystem is less general: it has an implied dependency
</p>
<pre class="verbatim">  for all source file x, (load x) depends on (compile x)
</pre>
<p>and using a <code class="code">:depends-on</code> argument to say that <var class="var">b</var> depends on
<var class="var">a</var> <em class="emph">actually</em> means that
</p>
<pre class="verbatim">  (compile b) depends on (load a)
</pre>
<p>This is insufficient for e.g. the McCLIM system, which requires that
all the files are loaded before any of them can be compiled ]
</p>
<p>End side note
</p>
<p>In ASDF, the dependency information for a given component and operation
can be queried using <code class="code">(component-depends-on operation component)</code>,
which returns a list of sublists, each of which defines an action.
</p>
<div class="example lisp">
<pre class="lisp-preformatted">((load-op &quot;a&quot;) (load-op &quot;b&quot;) (compile-op &quot;c&quot;) (load-op &quot;d&quot; &quot;e&quot;) ...)
</pre></div>

<p>For more information about <code class="code">component-depends-on</code>, see <a class="pxref" href="#Creating-new-operations">Creating new operations</a>.
</p>
<p>A minimal version can be specified for a component you depend on
(typically another system), by specifying <code class="code">(:version &quot;other-system&quot; &quot;1.2.3&quot;)</code>
instead of simply <code class="code">&quot;other-system&quot;</code> as the dependency.
See the discussion of the semantics of <code class="code">:version</code>
in the defsystem grammar.
</p>


</div>
<div class="subsubsection-level-extent" id="pathname">
<h4 class="subsubsection">7.2.1.5 pathname</h4>

<p>This attribute is optional and if absent (which is the usual case),
the component name will be used.
</p>
<p>See <a class="xref" href="#Pathname-specifiers">Pathname specifiers</a>,
for an explanation of how this attribute is interpreted.
</p>
<p>Note that the <code class="code">defsystem</code> macro (used to create a &ldquo;top-level&rdquo; system)
does additional processing to set the filesystem location of
the top component in that system.
This is detailed elsewhere. See <a class="xref" href="#Defining-systems-with-defsystem">Defining systems with defsystem</a>.
</p>
<p>To find the CL pathname corresponding to a component, use
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-component_002dpathname"><span class="category-def">Function: </span><span><strong class="def-name">component-pathname</strong> <var class="def-var-arguments">component</var><a class="copiable-link" href='#index-component_002dpathname'> &para;</a></span></dt>
<dd><p>Returns the pathname corresponding to <var class="var">component</var>.  For components
such as source files, this will be a filename pathname.  For example:
</p>
<div class="example lisp">
<pre class="lisp-preformatted">CL-USER&gt; (asdf:component-pathname (asdf:find-system &quot;xmls&quot;))
#P&quot;/Users/rpg/lisp/xmls/&quot;
</pre></div>

<p>and
</p>
<div class="example lisp">
<pre class="lisp-preformatted">CL-USER&gt; (asdf:component-pathname
           (asdf:find-component
              (asdf:find-system &quot;xmls&quot;) &quot;xmls&quot;))
#P&quot;/Users/rpg/lisp/xmls/xmls.lisp&quot;
</pre></div>
</dd></dl>




</div>
<div class="subsubsection-level-extent" id="Properties">
<h4 class="subsubsection">7.2.1.6 Properties</h4>

<p>This attribute is optional.
</p>
<p>Packaging systems often require information about files or systems
in addition to that specified by ASDF&rsquo;s pre-defined component attributes.
Programs that create vendor packages out of ASDF systems therefore
have to create &ldquo;placeholder&rdquo; information to satisfy these systems.
Sometimes the creator of an ASDF system may know the additional
information and wish to provide it directly.
</p>
<p><code class="code">(component-property component property-name)</code> and
associated <code class="code">setf</code> method will allow
the programmatic update of this information.
Property names are compared as if by <code class="code">EQL</code>,
so use symbols or keywords or something.
</p>

<hr>
</div>
</div>
<div class="subsection-level-extent" id="Pre_002ddefined-subclasses-of-component">
<h4 class="subsection" id="Pre_002ddefined-subclasses-of-component-1">7.2.2 Pre-defined subclasses of component</h4>

<dl class="first-deftp">
<dt class="deftp" id="index-source_002dfile"><span class="category-def">Component: </span><span><strong class="def-name">source-file</strong><a class="copiable-link" href='#index-source_002dfile'> &para;</a></span></dt>
<dd>
<p>A source file is any file that the system does not know how to
generate from other components of the system.
</p>
<p>Note that this is not necessarily the same thing as
&ldquo;a file containing data that is typically fed to a compiler&rdquo;.
If a file is generated by some pre-processor stage
(e.g. a <samp class="file">.h</samp> file from <samp class="file">.h.in</samp> by autoconf)
then it is not, by this definition, a source file.
Conversely, we might have a graphic file
that cannot be automatically regenerated,
or a proprietary shared library that we received as a binary:
these do count as source files for our purposes.
</p>
<p>Subclasses of source-file exist for various languages.
<em class="emph">FIXME: describe these.</em>
</p></dd></dl>

<dl class="first-deftp">
<dt class="deftp" id="index-module"><span class="category-def">Component: </span><span><strong class="def-name">module</strong><a class="copiable-link" href='#index-module'> &para;</a></span></dt>
<dd>
<p>A module is a collection of sub-components.
</p>
<p>A module component has the following extra initargs:
</p>
<ul class="itemize mark-bullet">
<li><code class="code">:components</code> the components contained in this module

</li><li><code class="code">:default-component-class</code>
All children components which don&rsquo;t specify their class explicitly
are inferred to be of this type.

</li><li><code class="code">:if-component-dep-fails</code>
This attribute was removed in ASDF 3. Do not use it.
Use <code class="code">:if-feature</code> instead (see <a class="pxref" href="#required_002dfeatures">required-features</a>, and see <a class="pxref" href="#if_002dfeature-option">if-feature option</a>).

</li><li><code class="code">:serial</code> When this attribute is set,
each subcomponent of this component is assumed to depend on all subcomponents
before it in the list given to <code class="code">:components</code>, i.e.
all of them are loaded before a compile or load operation is performed on it.

</li></ul>

<p>The default operation knows how to traverse a module, so
most operations will not need to provide methods specialised on modules.
</p>
<p><code class="code">module</code> may be subclassed to represent components such as
foreign-language linked libraries or archive files.
</p></dd></dl>

<dl class="first-deftp">
<dt class="deftp" id="index-system-1"><span class="category-def">Component: </span><span><strong class="def-name">system</strong><a class="copiable-link" href='#index-system-1'> &para;</a></span></dt>
<dd>
<p><code class="code">system</code> is a subclass of <code class="code">module</code>.
</p>
<p>A system is a module with a few extra attributes for documentation
purposes; these are given elsewhere.
See <a class="xref" href="#The-defsystem-grammar">The defsystem grammar</a>.
</p>
<p>Users can create new classes for their systems:
the default <code class="code">defsystem</code> macro takes a <code class="code">:class</code> keyword argument.
</p></dd></dl>

<hr>
</div>
<div class="subsection-level-extent" id="Creating-new-component-types">
<h4 class="subsection" id="Creating-new-component-types-1">7.2.3 Creating new component types</h4>

<p>New component types are defined by subclassing one of the existing
component classes and specializing methods on the new component class.
</p>

<p>As an example, suppose we have some implementation-dependent
functionality that we want to isolate
in one subdirectory per Lisp implementation our system supports.
We create a subclass of
<code class="code">cl-source-file</code>:
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(defclass unportable-cl-source-file (cl-source-file)
  ())
</pre></div>

<p>Function <code class="code">asdf:implementation-type</code> (exported since 2.014.14)
gives us the name of the subdirectory.
All that&rsquo;s left is to define how to calculate the pathname
of an <code class="code">unportable-cl-source-file</code>.
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(defmethod component-pathname ((component unportable-cl-source-file))
  (merge-pathnames*
   (parse-unix-namestring (format nil &quot;~(~A~)/&quot; (asdf:implementation-type)))
   (call-next-method)))
</pre></div>

<p>The new component type is used in a <code class="code">defsystem</code> form in this way:
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(defsystem :foo
    :components
    ((:file &quot;packages&quot;)
     ...
     (:unportable-cl-source-file &quot;threads&quot;
      :depends-on (&quot;packages&quot; ...))
     ...
    )
</pre></div>

<hr>
</div>
</div>
<div class="section-level-extent" id="Dependencies">
<h3 class="section" id="Dependencies-2">7.3 Dependencies</h3>

<p>To be successfully build-able, this graph of actions must be acyclic.
If, as a user, extender or implementer of ASDF, you introduce
a cycle into the dependency graph,
ASDF will fail loudly.
To clearly distinguish the direction of dependencies,
ASDF 3 uses the words <em class="emph">requiring</em> and <em class="emph">required</em>
as applied to an action depending on the other:
the requiring action <code class="code">depends-on</code> the completion of all required actions
before it may itself be <code class="code">perform</code>ed.
</p>
<p>Using the <code class="code">defsystem</code> syntax, users may easily express
direct dependencies along the graph of the object hierarchy:
between a component and its parent, its children, and its siblings.
By defining custom CLOS methods, you can express more elaborate dependencies as you wish.
Most common operations, such as <code class="code">load-op</code>, <code class="code">compile-op</code> or <code class="code">load-source-op</code>
are automatically propagate &ldquo;downward&rdquo; the component hierarchy and are &ldquo;covariant&rdquo; with it:
to act the operation on the parent module, you must first act it on all the children components,
with the action on the parent being parent of the action on each child.
Other operations, such as <code class="code">prepare-op</code> and <code class="code">prepare-source-op</code>
(introduced in ASDF 3) are automatically propagated &ldquo;upward&rdquo; the component hierarchy
and are &ldquo;contravariant&rdquo; with it:
to perform the operation of preparing for compilation of a child component,
you must perform the operation of preparing for compilation of its parent component, and so on,
ensuring that all the parent&rsquo;s dependencies are (compiled and) loaded
before the child component may be compiled and loaded.
Yet other operations, such as <code class="code">test-op</code> or <code class="code">load-bundle-op</code>
remain at the system level, and are not propagated along the hierarchy,
but instead do something global on the system.
</p>

<hr>
</div>
<div class="section-level-extent" id="Functions">
<h3 class="section" id="Functions-1">7.4 Functions</h3>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-version_002dsatisfies-1"><span class="category-def">Function: </span><span><strong class="def-name">version-satisfies</strong> <var class="def-var-arguments"><var class="var">version</var> <var class="var">version-spec</var></var><a class="copiable-link" href='#index-version_002dsatisfies-1'> &para;</a></span></dt>
<dd><p>Does <var class="var">version</var> satisfy the <var class="var">version-spec</var>.  A generic function.
ASDF provides built-in methods for <var class="var">version</var> being a <code class="code">component</code> or <code class="code">string</code>.
<var class="var">version-spec</var> should be a string.
If it&rsquo;s a component, its version is extracted as a string before further processing.
</p>
<p>A version string satisfies the version-spec if after parsing,
the former is no older than the latter.
Therefore <code class="code">&quot;1.9.1&quot;</code>, <code class="code">&quot;1.9.2&quot;</code> and <code class="code">&quot;1.10&quot;</code> all satisfy <code class="code">&quot;1.9.1&quot;</code>,
but <code class="code">&quot;1.8.4&quot;</code> or <code class="code">&quot;1.9&quot;</code> do not.
For more information about how <code class="code">version-satisfies</code> parses and interprets
version strings and specifications,
see <a class="pxref" href="#Version-specifiers">Version specifiers</a> and
<a class="ref" href="#Common-attributes-of-components">Common attributes of components</a>.
</p>
<p>Note that in versions of ASDF prior to 3.0.1,
including the entire ASDF 1 and ASDF 2 series,
<code class="code">version-satisfies</code> would also require that the version and the version-spec
have the same major version number (the first integer in the list);
if the major version differed, the version would be considered as not matching the spec.
But that feature was not documented, therefore presumably not relied upon,
whereas it was a nuisance to several users.
Starting with ASDF 3.0.1,
<code class="code">version-satisfies</code> does not treat the major version number specially,
and returns T simply if the first argument designates a version that isn&rsquo;t older
than the one specified as a second argument.
If needs be, the <code class="code">(:version ...)</code> syntax for specifying dependencies
could be in the future extended to specify an exclusive upper bound for compatible versions
as well as an inclusive lower bound.
</p></dd></dl>

<hr>
</div>
<div class="section-level-extent" id="Parsing-system-definitions">
<h3 class="section" id="Parsing-system-definitions-1">7.5 Parsing system definitions</h3>
<a class="index-entry-id" id="index-Parsing-system-definitions"></a>
<a class="index-entry-id" id="index-Extending-ASDF_0027s-defsystem-parser"></a>

<p>Thanks to Eric Timmons, ASDF now provides hooks to extend how it parses
<code class="code">defsystem</code> forms.
</p>
<p><strong class="strong">Warning!</strong> These interfaces are experimental, and as such are not
exported from the ASDF package yet. We plan to export them in ASDF
3.4.0. If you use them before they are exported, please subscribe to
<a class="url" href="https://gitlab.common-lisp.net/asdf/asdf/-/issues/76">https://gitlab.common-lisp.net/asdf/asdf/-/issues/76</a> so you are
made aware of any changes.
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-parse_002dcomponent_002dform"><span class="category-def">Function: </span><span><strong class="def-name">parse-component-form</strong> <var class="def-var-arguments"><var class="var">parent</var> <var class="var">options</var> &amp;key <var class="var">previous-serial-components</var></var><a class="copiable-link" href='#index-parse_002dcomponent_002dform'> &para;</a></span></dt>
<dd>
<p>This is the core function for parsing a system definition. At the
moment, we do not expect ASDF extenders to modify this function.
</p>
<p>When being called on a <code class="code">component</code> of type <code class="code">system</code> (i.e.,
inside the <code class="code">defsystem</code> macro), <var class="var">parent</var> will be <code class="code">NIL</code>.
</p></dd></dl>

<dl class="first-deffn">
<dt class="deffn" id="index-compute_002dcomponent_002dchildren"><span class="category-def">Generic function: </span><span><strong class="def-name">compute-component-children</strong> <var class="def-var-arguments"><var class="var">component</var> <var class="var">components</var> <var class="var">serial-p</var></var><a class="copiable-link" href='#index-compute_002dcomponent_002dchildren'> &para;</a></span></dt>
<dd>
<p>This generic function provides standard means for computing component
children, but can be extended with additional methods by a programmer.
</p>
<p>Returns a list of children (of type <code class="code">component</code>) for <var class="var">component</var>.
<var class="var">components</var> is a list of the explicitly defined children descriptions.
<var class="var">serial-p</var> is non-<code class="code">NIL</code> if each child in <var class="var">components</var> should depend on the previous
children.
</p>

</dd></dl>

<dl class="first-deffn">
<dt class="deffn" id="index-class_002dfor_002dtype"><span class="category-def">Generic function: </span><span><strong class="def-name">class-for-type</strong> <var class="def-var-arguments"><var class="var">parent</var> <var class="var">type-designator</var></var><a class="copiable-link" href='#index-class_002dfor_002dtype'> &para;</a></span></dt>
<dd>
<p>Return a <code class="code">class</code> designator to be used to instantiate a component
whose type is specified by <var class="var">type-designator</var> in the context of
<var class="var">parent</var>, which should be either a <code class="code">parent-component</code> &ndash; or subclass
thereof &ndash; or <code class="code">nil</code> (if the type designator is some class of system).
</p>
<p>This generic function provides a means for changing how ASDF translates
type-designators (like <code class="code">:file</code>) into CLOS classes.  It is intended
for programmers to extend by adding new methods.
</p>
<p><strong class="strong">Warning!</strong> Adding new methods for <code class="code">class-for-type</code> is
typically <em class="emph">not</em> necessary: much can already be done by using
<code class="code">:default-component-class</code> and defining (and explicitly calling
for) new component types.
</p>
</dd></dl>



<hr>
</div>
</div>
<div class="chapter-level-extent" id="Controlling-where-ASDF-searches-for-systems">
<h2 class="chapter" id="Controlling-where-ASDF-searches-for-systems-1">8 Controlling where ASDF searches for systems</h2>




<hr>
<div class="section-level-extent" id="Configurations">
<h3 class="section" id="Configurations-1">8.1 Configurations</h3>

<p>Configurations specify paths where to find system files.
</p>
<ol class="enumerate">
<li> The search registry may use some hardcoded wrapping registry specification.
This allows some implementations (notably SBCL) to specify where to find
some special implementation-provided systems that
need to precisely match the version of the implementation itself.

</li><li> An application may explicitly initialize the source-registry configuration
using the configuration API
(see <a class="pxref" href="#Controlling-where-ASDF-searches-for-systems">Configuration API</a>, below)
in which case this takes precedence.
It may itself compute this configuration from the command-line,
from a script, from its own configuration file, etc.

</li><li> The source registry will be configured from
the environment variable <code class="code">CL_SOURCE_REGISTRY</code> if it exists.

</li><li> The source registry will be configured from
user configuration file
<samp class="file">$XDG_CONFIG_DIRS/common-lisp/source-registry.conf</samp>
(which defaults to
<samp class="file">~/.config/common-lisp/source-registry.conf</samp>)
if it exists.

</li><li> The source registry will be configured from
user configuration directory
<samp class="file">$XDG_CONFIG_DIRS/common-lisp/source-registry.conf.d/</samp>
(which defaults to
<samp class="file">~/.config/common-lisp/source-registry.conf.d/</samp>)
if it exists.

</li><li> The source registry will be configured from
default user configuration trees
<samp class="file">~/common-lisp/</samp> (since ASDF 3.1.2 only),
<samp class="file">~/.sbcl/systems/</samp> (on SBCL only),
<samp class="file">$XDG_DATA_HOME/common-lisp/systems/</samp> (no recursion, link farm)
<samp class="file">$XDG_DATA_HOME/common-lisp/source/</samp>.
The <code class="code">XDG_DATA_HOME</code> directory defaults to <samp class="file">~/.local/share/</samp>.
On Windows, the <code class="code">local-appdata</code> and <code class="code">appdata</code> directories are used instead.

</li><li> The source registry will be configured from
system configuration file
<samp class="file">/etc/common-lisp/source-registry.conf</samp>
if it exists.

</li><li> The source registry will be configured from
system configuration directory
<samp class="file">/etc/common-lisp/source-registry.conf.d/</samp>
if it exists.

</li><li> The source registry will be configured from a default configuration.
This configuration may allow for implementation-specific systems
to be found, for systems to be found the current directory
(at the time that the configuration is initialized) as well as
<code class="code">:directory</code> entries for <samp class="file">$XDG_DATA_DIRS/common-lisp/systems/</samp> and
<code class="code">:tree</code> entries for <samp class="file">$XDG_DATA_DIRS/common-lisp/source/</samp>,
where <code class="code">XDG_DATA_DIRS</code> defaults to <samp class="file">/usr/local/share</samp> and <samp class="file">/usr/share</samp> on Unix,
and the <code class="code">common-appdata</code> directory on Windows.

</li><li> The source registry may include implementation-dependent directories
that correspond to implementation-provided extensions.

</li></ol>

<p>Each of these configurations is specified as an s-expression
in a trivial domain-specific language (defined below).
Additionally, a more shell-friendly syntax is available
for the environment variable (defined yet below).
</p>
<p>Each of these configurations is only used if the previous
configuration explicitly or implicitly specifies that it
includes its inherited configuration.
</p>
<p>Additionally, some implementation-specific directories
may be automatically prepended to whatever directories are specified
in configuration files, no matter if the last one inherits or not.
</p>
<hr>
</div>
<div class="section-level-extent" id="Truenames-and-other-dangers">
<h3 class="section" id="Truenames-and-other-dangers-1">8.2 Truenames and other dangers</h3>

<p>One great innovation of the original ASDF was its ability to leverage
<code class="code">CL:TRUENAME</code> to locate where your source code was and where to build it,
allowing for symlink farms as a simple but effective configuration mechanism
that is easy to control programmatically.
ASDF 3 still supports this configuration style, and it is enabled by default;
however we recommend you instead use
our source-registry configuration mechanism described below,
because it is easier to setup in a portable way across users and implementations.
</p>
<p>Additionally, some people dislike truename,
either because it is very slow on their system, or
because they are using content-addressed storage where the truename of a file
is related to a digest of its individual contents,
and not to other files in the same intended project.
For these people, ASDF 3 allows to eschew the <code class="code">TRUENAME</code> mechanism,
by setting the variable <var class="var">asdf:*resolve-symlinks*</var> to <code class="code">nil</code>.
</p>
<p>PS: Yes, if you haven&rsquo;t read Vernor Vinge&rsquo;s short but great classic
&ldquo;True Names... and Other Dangers&rdquo; then you&rsquo;re in for a treat.
</p>
<hr>
</div>
<div class="section-level-extent" id="XDG-base-directory">
<h3 class="section" id="XDG-base-directory-1">8.3 XDG base directory</h3>

<p>Note that we purport to respect the XDG base directory specification
as to where configuration files are located,
where data files are located,
where output file caches are located.
Mentions of XDG variables refer to that document.
</p>
<p><a class="url" href="http://standards.freedesktop.org/basedir-spec/basedir-spec-latest.html">http://standards.freedesktop.org/basedir-spec/basedir-spec-latest.html</a>
</p>
<p>This specification allows the user to specify some environment variables
to customize how applications behave to his preferences.
</p>
<p>On Windows platforms, even when not using Cygwin, and starting with ASDF 3.1.5,
we still do a best effort at following the XDG base directory specification,
even though it doesn&rsquo;t exactly fit common practice for Windows applications.
However, we replace the fixed Unix paths <samp class="file">~/.local</samp>, <samp class="file">/usr/local</samp> and <samp class="file">/usr</samp>
with their rough Windows equivalent <samp class="file">Local AppData</samp>, <samp class="file">AppData</samp>, <samp class="file">Common AppData</samp>, etc.
Since support for querying the Windows registry
is not possible to do in reasonable amounts of portable Common Lisp code,
ASDF 3 relies on the environment variables that Windows usually exports,
and are hopefully in synch with the Windows registry.
If you care about the details, see <samp class="file">uiop/configuration.lisp</samp> and don&rsquo;t hesitate to suggest improvements.
</p>
<hr>
</div>
<div class="section-level-extent" id="Backward-Compatibility">
<h3 class="section" id="Backward-Compatibility-1">8.4 Backward Compatibility</h3>

<p>For backward compatibility as well as to provide a practical backdoor for hackers,
ASDF will first search for <samp class="file">.asd</samp> files in the directories specified in
<code class="code">asdf:*central-registry*</code>
before it searches in the source registry above.
</p>
<p>See <a class="xref" href="#Configuring-ASDF">Configuring ASDF to find your systems &mdash; old style</a>.
</p>
<p>By default, <code class="code">asdf:*central-registry*</code> will be empty.
</p>
<p>This old mechanism will therefore not affect you if you don&rsquo;t use it,
but will take precedence over the new mechanism if you do use it.
</p>
<hr>
</div>
<div class="section-level-extent" id="Configuration-DSL">
<h3 class="section" id="Configuration-DSL-1">8.5 Configuration DSL</h3>
<a class="index-entry-id" id="index-_003ainherit_002dconfiguration-source-config-directive"></a>
<a class="index-entry-id" id="index-inherit_002dconfiguration-source-config-directive"></a>
<a class="index-entry-id" id="index-_003aignore_002dinvalid_002dentries-source-config-directive"></a>
<a class="index-entry-id" id="index-ignore_002dinvalid_002dentries-source-config-directive"></a>
<a class="index-entry-id" id="index-_003adirectory-source-config-directive"></a>
<a class="index-entry-id" id="index-directory-source-config-directive"></a>
<a class="index-entry-id" id="index-_003atree-source-config-directive"></a>
<a class="index-entry-id" id="index-tree-source-config-directive"></a>
<a class="index-entry-id" id="index-_003aexclude-source-config-directive"></a>
<a class="index-entry-id" id="index-exclude-source-config-directive"></a>
<a class="index-entry-id" id="index-_003aalso_002dexclude-source-config-directive"></a>
<a class="index-entry-id" id="index-also_002dexclude-source-config-directive"></a>
<a class="index-entry-id" id="index-_003ainclude-source-config-directive"></a>
<a class="index-entry-id" id="index-include-source-config-directive"></a>
<a class="index-entry-id" id="index-_003adefault_002dregistry-source-config-directive"></a>
<a class="index-entry-id" id="index-default_002dregistry-source-config-directive"></a>

<p>Here is the grammar of the s-expression (SEXP) DSL for source-registry
configuration:
</p>

<div class="example">
<pre class="example-preformatted">;; A configuration is a single SEXP starting with the keyword
;; :source-registry followed by a list of directives.
CONFIGURATION := (:source-registry DIRECTIVE ...)

;; A directive is one of the following:
DIRECTIVE :=
    ;; INHERITANCE DIRECTIVE:
    ;; Your configuration expression MUST contain
    ;; exactly one of the following:
    :inherit-configuration |
    ;; splices inherited configuration (often specified last) or
    :ignore-inherited-configuration |
    ;; drop inherited configuration (specified anywhere)

    ;; forward compatibility directive (since ASDF 2.011.4), useful when
    ;; you want to use new configuration features but have to bootstrap
    ;; the newer required ASDF from an older release that doesn't
    ;; support said features:
    :ignore-invalid-entries |

    ;; add a single directory to be scanned (no recursion)
    (:directory DIRECTORY-PATHNAME-DESIGNATOR) |

    ;; add a directory hierarchy, recursing but
    ;; excluding specified patterns
    (:tree DIRECTORY-PATHNAME-DESIGNATOR) |

    ;; override the defaults for exclusion patterns
    (:exclude EXCLUSION-PATTERN ...) |
    ;; augment the defaults for exclusion patterns
    (:also-exclude EXCLUSION-PATTERN ...) |
    ;; Note that the scope of a an exclude pattern specification is
    ;; the rest of the current configuration expression or file.

    ;; splice the parsed contents of another config file
    (:include REGULAR-FILE-PATHNAME-DESIGNATOR) |

    ;; This directive specifies that some default must be spliced.
    :default-registry

REGULAR-FILE-PATHNAME-DESIGNATOR
    := PATHNAME-DESIGNATOR ; interpreted as a file
DIRECTORY-PATHNAME-DESIGNATOR
    := PATHNAME-DESIGNATOR ; interpreted as a directory

PATHNAME-DESIGNATOR :=
    NIL | ;; Special: skip this entry.
    ABSOLUTE-COMPONENT-DESIGNATOR ;; see pathname DSL

EXCLUSION-PATTERN := a string without wildcards, that will be matched
    exactly against the name of a any subdirectory in the directory
    component of a path. e.g. <code class="code">&quot;_darcs&quot;</code> will match
    <samp class="file">#p&quot;/foo/bar/_darcs/src/bar.asd&quot;</samp>
</pre></div>

<p>Pathnames are designated using another DSL,
shared with the output-translations configuration DSL below.
The DSL is resolved by the function <code class="code">asdf::resolve-location</code>,
to be documented and exported at some point in the future.
</p>
<div class="example">
<pre class="example-preformatted">ABSOLUTE-COMPONENT-DESIGNATOR :=
    (ABSOLUTE-COMPONENT-DESIGNATOR RELATIVE-COMPONENT-DESIGNATOR ...) |
    STRING |
    ;; namestring (better be absolute or bust, directory assumed where
    ;; applicable).  In output-translations, directory is assumed and
    ;; **/*.*.* added if it's last.  On MCL, a MacOSX-style POSIX
    ;; namestring (for MacOS9 style, use #p&quot;...&quot;); Note that none of the
    ;; above applies to strings used in *central-registry*, which
    ;; doesn't use this DSL: they are processed as normal namestrings.
    ;; however, you can compute what you put in the *central-registry*
    ;; based on the results of say
    ;; (asdf::resolve-location &quot;/Users/fare/cl/cl-foo/&quot;)
    PATHNAME |
    ;; pathname (better be an absolute path, or bust)
    ;; In output-translations, unless followed by relative components,
    ;; it better have appropriate wildcards, as in **/*.*.*
    :HOME | ; designates the user-homedir-pathname ~/
    :USER-CACHE | ; designates the default location for the user cache
    :HERE |
    ;; designates the location of the configuration file
    ;; (or *default-pathname-defaults*, if invoked interactively)
    :ROOT
    ;; magic, for output-translations source only: paths that are relative
    ;; to the root of the source host and device

They keyword :SYSTEM-CACHE is not accepted in ASDF 3.1 and beyond: it
was a security hazard.

RELATIVE-COMPONENT-DESIGNATOR :=
    (RELATIVE-COMPONENT-DESIGNATOR RELATIVE-COMPONENT-DESIGNATOR ...) |
    STRING |
      ;; relative directory pathname as interpreted by
      ;; parse-unix-namestring.
      ;; In output translations, if last component, **/*.*.* is added
    PATHNAME | ; pathname; unless last component, directory is assumed.
    :IMPLEMENTATION |
       ;; directory based on implementation, e.g. sbcl-1.0.45-linux-x64
    :IMPLEMENTATION-TYPE |
       ;; a directory based on lisp-implementation-type only, e.g. sbcl
    :DEFAULT-DIRECTORY |
       ;; a relativized version of the default directory
    :*/ | ;; any direct subdirectory (since ASDF 2.011.4)
    :**/ | ;; any recursively inferior subdirectory (since ASDF 2.011.4)
    :*.*.* | ;; any file (since ASDF 2.011.4)

The keywords :UID and :USERNAME are no longer supported.
</pre></div>

<p>For instance, as a simple case, my <samp class="file">~/.config/common-lisp/source-registry.conf</samp>,
which is the default place ASDF looks for this configuration, once contained:
</p><div class="example">
<pre class="example-preformatted">(:source-registry
  (:tree (:home &quot;cl&quot;)) ;; will expand to e.g. &quot;/home/joeluser/cl/&quot;
  :inherit-configuration)
</pre></div>

<hr>
</div>
<div class="section-level-extent" id="Configuration-Directories">
<h3 class="section" id="Configuration-Directories-1">8.6 Configuration Directories</h3>

<p>Configuration directories consist in files each containing
a list of directives without any enclosing <code class="code">(:source-registry ...)</code> form.
The files will be sorted by namestring as if by <code class="code">string&lt;</code> and
the lists of directives of these files with be concatenated in order.
An implicit <code class="code">:inherit-configuration</code> will be included
at the <em class="emph">end</em> of the list.
</p>
<p>System-wide or per-user Common Lisp software distributions
such as Debian packages or some future version of <code class="code">clbuild</code>
may then include files such as
<samp class="file">/etc/common-lisp/source-registry.conf.d/10-foo.conf</samp> or
<samp class="file">~/.config/common-lisp/source-registry.conf.d/10-foo.conf</samp>
to easily and modularly register configuration information
about software being distributed.
</p>
<p>The convention is that, for sorting purposes,
the names of files in such a directory begin with two digits
that determine the order in which these entries will be read.
Also, the type of these files must be <samp class="file">.conf</samp>,
which not only simplifies the implementation by allowing
for more portable techniques in finding those files,
but also makes it trivial to disable a file, by renaming it to a different file type.
</p>
<p>Directories may be included by specifying a directory pathname
or namestring in an <code class="code">:include</code> directive, e.g.:
</p>
<div class="example">
<pre class="example-preformatted">	(:include &quot;/foo/bar/&quot;)
</pre></div>

<p>Hence, to achieve the same effect as
my example <samp class="file">~/.config/common-lisp/source-registry.conf</samp> above,
I could simply create a file
<samp class="file">~/.config/common-lisp/source-registry.conf.d/33-home-fare-cl.conf</samp>
alone in its directory with the following contents:
</p><div class="example">
<pre class="example-preformatted">(:tree &quot;/home/fare/cl/&quot;)
</pre></div>


<hr>
<div class="subsection-level-extent" id="The-here-directive">
<h4 class="subsection" id="The-_003ahere-directive">8.6.1 The :here directive</h4>

<p>The <code class="code">:here</code> directive is an absolute pathname designator that
refers to the directory containing the configuration file currently
being processed.
</p>
<p>The <code class="code">:here</code> directive is intended to simplify the delivery of
complex CL systems, and for easy configuration of projects shared through
revision control systems, in accordance with our design principle that
each participant should be able to provide all and only the information
available to him or her.
</p>
<p>Consider a person X who has set up the source code repository for a
complex project with a master directory <samp class="file">dir/</samp>.  Ordinarily, one
might simply have the user add a directive that would look something
like this:
</p><div class="example">
<pre class="example-preformatted">   (:tree &quot;path/to/dir&quot;)
</pre></div>
<p>But what if X knows that there are very large subtrees
under dir that are filled with, e.g., Java source code, image files for
icons, etc.?  All of the asdf system definitions are contained in the
subdirectories <samp class="file">dir/src/lisp/</samp> and <samp class="file">dir/extlib/lisp/</samp>, and
these are the only directories that should be searched.
</p>
<p>In this case, X can put into <samp class="file">dir/</samp> a file <samp class="file">asdf.conf</samp> that
contains the following:
</p><div class="example">
<pre class="example-preformatted">(:source-registry
   (:tree (:here &quot;src/lisp/&quot;))
   (:tree (:here &quot;extlib/lisp&quot;))
   (:directory (:here &quot;outlier/&quot;)))
</pre></div>

<p>Then when someone else (call her Y) checks out a copy of this
repository, she need only add
</p><div class="example">
<pre class="example-preformatted">(:include &quot;/path/to/my/checkout/directory/asdf.conf&quot;)
</pre></div>
<p>to one of her previously-existing asdf source location configuration
files, or invoke <code class="code">initialize-source-registry</code> with a configuration
form containing that s-expression.  ASDF will find the .conf file that X
has provided, and then set up source locations within the working
directory according to X&rsquo;s (relative) instructions.
</p>
<hr>
</div>
</div>
<div class="section-level-extent" id="Shell_002dfriendly-syntax-for-configuration">
<h3 class="section" id="Shell_002dfriendly-syntax-for-configuration-1">8.7 Shell-friendly syntax for configuration</h3>

<p>When considering environment variable <code class="code">CL_SOURCE_REGISTRY</code>
ASDF will skip to next configuration if it&rsquo;s an empty string.
It will <code class="code">READ</code> the string as a SEXP in the DSL
if it begins with a paren <code class="code">(</code>,
otherwise it will be interpreted much like <code class="code">TEXINPUTS</code>,
as a list of paths, where
</p>
<ul class="itemize mark-bullet">
<li>paths are separated by a <code class="code">:</code> (colon) on Unix platforms
   (including cygwin), by a <code class="code">;</code> (semicolon) on other platforms
   (mainly, Windows).

</li><li>each entry is a directory to add to the search path.

</li><li>if the entry ends with a double slash <code class="code">//</code> then it instead
   indicates a tree in the subdirectories of which to recurse.

</li><li>if the entry is the empty string (which may only appear once),
   then it indicates that the inherited configuration should be spliced
   there.
</li></ul>

<hr>
</div>
<div class="section-level-extent" id="Search-Algorithm">
<h3 class="section" id="Search-Algorithm-1">8.8 Search Algorithm</h3>
<a class="index-entry-id" id="index-_002adefault_002dsource_002dregistry_002dexclusions_002a"></a>

<p>In case that isn&rsquo;t clear, the semantics of the configuration is that
when searching for a system of a given name,
directives are processed in order.
</p>
<p>When looking in a directory, if the system is found, the search succeeds,
otherwise it continues.
</p>
<p>When looking in a tree, if one system is found, the search succeeds.
If multiple systems are found, the consequences are unspecified:
the search may succeed with any of the found systems,
or an error may be raised.
ASDF 3.2.1 or later returns the pathname whose normalized directory component
has the shortest length (as a list), and breaks ties by choosing the system
with the smallest <code class="code">unix-namestring</code> when compared with <code class="code">string&lt;</code>.
Earlier versions of ASDF return ASDF return the first system found,
which is implementation-dependent, and may or may not be the pathname
with the smallest <code class="code">unix-namestring</code> when compared with <code class="code">string&lt;</code>.
XCVB raises an error.
If none is found, the search continues.
</p>
<p>Exclude statements specify patterns of subdirectories
the systems from which to ignore.
Typically you don&rsquo;t want to use copies of files kept by such
version control systems as Darcs.
Exclude statements are not propagated to further included or inherited
configuration files or expressions;
instead the defaults are reset around every configuration statement
to the default defaults from <code class="code">asdf::*default-source-registry-exclusions*</code>.
</p>
<p>Include statements cause the search to recurse with the path specifications
from the file specified.
</p>
<p>An inherit-configuration statement cause the search to recurse with the path
specifications from the next configuration
(see <a class="pxref" href="#Configurations">Configurations</a> above).
</p>

<hr>
</div>
<div class="section-level-extent" id="Caching-Results">
<h3 class="section" id="Caching-Results-1">8.9 Caching Results</h3>

<p>The implementation is allowed to either eagerly compute the information
from the configurations and file system, or to lazily re-compute it
every time, or to cache any part of it as it goes.
In practice, the recommended <code class="code">source-registry</code> eagerly collects and caches results
and you need to explicitly flush the cache for change to be taken into account,
whereas the old-style <code class="code">*central-registry*</code> mechanism queries the filesystem every time.
</p>
<p>To explicitly flush any information cached by the system
after a change was made in the filesystem, See <a class="xref" href="#Configuration-API">Configuration API</a>,
and e.g. call <code class="code">asdf:clear-source-registry</code>.
</p>
<p>Starting with ASDF 3.1.4, you can also explicitly build a persistent cache
of the <samp class="file">.asd</samp> files found under a tree:
when recursing into a directory declared by <code class="code">:tree</code> and its transitive subdirectories,
if a file <samp class="file">.cl-source-registry.cache</samp> exists containing a form
that is a list starting with <code class="code">:source-registry-cache</code> followed by a list of strings,
as in <code class="code">(:source-registry-cache <em class="emph">&quot;foo/bar.asd&quot; &quot;path/to/more.asd&quot; ...</em>)</code>,
then the strings are assumed to be <code class="code">unix-namestring</code>s designating
the available asd files under that tree, and the recursion otherwise stops.
The list can also be empty, allowing to stop a costly recursion in a huge directory tree.
</p>
<p>To update such a cache after you install, update or remove source repositories,
you can run a script distributed with ASDF:
<code class="code">tools/cl-source-registry-cache.lisp <em class="emph">/path/to/directory</em></code>.
To wholly invalidate the cache, you can
delete the file <samp class="file">.cl-source-registry.cache</samp> in that directory.
In either case, for an existing Lisp process to see this change,
it needs to clear its own cache with e.g. <code class="code">(asdf:clear-source-registry)</code>.
</p>
<p>Developers may safely create a cache in their development tree,
and we recommend they do it at the top of their source tree if
it contains more than a small number of files and directories;
they only need update it when they create, remove or move <samp class="file">.asd</samp> files.
Software distribution managers may also safely create such a cache,
but they must be careful to update it every time they install, update or remove
a software source repository or installation package.
Finally, advanced developers who juggle with a lot of code
in their <code class="code">source-registry</code> may manually manage such a cache,
to allow for faster startup of Lisp programs.
</p>
<p>This persistence cache can help you reduce startup latency.
For instance, on one machine with hundreds of source repositories,
such a cache shaves half a second at the startup
of every <code class="code">#!/usr/bin/cl</code> script using SBCL, more on other implementations;
this makes a notable difference as to
their subjective interactivity and usability.
The speedup will only happen if the implementation-provided ASDF is recent enough
(3.1.3.7 or later); it is not enough for a recent ASDF upgrade to be present,
since the upgrade will itself be found but
after the old version has scanned the directories without heeding such a cache.
To upgrade the implementation-provided ASDF,
see <a class="pxref" href="#Replacing-your-implementation_0027s-ASDF">Replacing your implementation&rsquo;s ASDF</a>.
</p>

<hr>
</div>
<div class="section-level-extent" id="Configuration-API">
<h3 class="section" id="Configuration-API-1">8.10 Configuration API</h3>

<p>The specified functions are exported from your build system&rsquo;s package.
Thus for ASDF the corresponding functions are in package ASDF,
and for XCVB the corresponding functions are in package XCVB.
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-initialize_002dsource_002dregistry"><span class="category-def">Function: </span><span><strong class="def-name">initialize-source-registry</strong> <var class="def-var-arguments">&amp;optional PARAMETER</var><a class="copiable-link" href='#index-initialize_002dsource_002dregistry'> &para;</a></span></dt>
<dd><p>will read the configuration and initialize all internal variables.
   You may extend or override configuration
   from the environment and configuration files
   with the given <var class="var">PARAMETER</var>, which can be
   <code class="code">nil</code> (no configuration override),
   or a SEXP (in the SEXP DSL),
   a string (as in the string DSL),
   a pathname (of a file or directory with configuration),
   or a symbol (fbound to function that when called returns one of the above).
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-clear_002dsource_002dregistry"><span class="category-def">Function: </span><span><strong class="def-name">clear-source-registry</strong><a class="copiable-link" href='#index-clear_002dsource_002dregistry'> &para;</a></span></dt>
<dd><p>undoes any source registry configuration
   and clears any cache for the search algorithm.
   You might want to call this function
   (or better, <code class="code">clear-configuration</code>)
   before you dump an image that would be resumed
   with a different configuration,
   and return an empty configuration.
   Note that this does not include clearing information about
   systems defined in the current image, only about
   where to look for systems not yet defined.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-ensure_002dsource_002dregistry"><span class="category-def">Function: </span><span><strong class="def-name">ensure-source-registry</strong> <var class="def-var-arguments">&amp;optional PARAMETER</var><a class="copiable-link" href='#index-ensure_002dsource_002dregistry'> &para;</a></span></dt>
<dd><p>checks whether a source registry has been initialized.
   If not, initialize it with the given <var class="var">PARAMETER</var>.
</p></dd></dl>

<p>Every time you use ASDF&rsquo;s <code class="code">find-system</code>, or
anything that uses it (such as <code class="code">operate</code>, <code class="code">load-system</code>, etc.),
<code class="code">ensure-source-registry</code> is called with parameter <code class="code">nil</code>,
which the first time around causes your configuration to be read.
If you change a configuration file,
you need to explicitly <code class="code">initialize-source-registry</code> again,
or maybe simply to <code class="code">clear-source-registry</code> (or <code class="code">clear-configuration</code>)
which will cause the initialization to happen next time around.
</p>
<hr>
</div>
<div class="section-level-extent" id="Introspection">
<h3 class="section" id="Introspection-1">8.11 Introspection</h3>


<hr>
<div class="subsection-level-extent" id="g_t_002asource_002dregistry_002dparameter_002a-variable">
<h4 class="subsection" id="g_t_002asource_002dregistry_002dparameter_002a-variable-1">8.11.1 *source-registry-parameter* variable</h4>
<a class="index-entry-id" id="index-_002asource_002dregistry_002dparameter_002a"></a>

<p>We have made available the variable <code class="code">*source-registry-parameter*</code>
that can be used by code that wishes to introspect about the (past)
configuration of ASDF&rsquo;s source registry.  <strong class="strong">This variable should
never be set!</strong>  It will be set as a side-effect of calling
<code class="code">initialize-source-registry</code>; user code should treat it as
read-only.
</p>
<hr>
</div>
<div class="subsection-level-extent" id="Information-about-system-dependencies">
<h4 class="subsection" id="Information-about-system-dependencies-1">8.11.2 Information about system dependencies</h4>

<p>ASDF makes available three functions to read system interdependencies.
These are intended to aid programmers who wish to perform dependency
analyses.
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-system_002ddefsystem_002ddepends_002don"><span class="category-def">Function: </span><span><strong class="def-name">system-defsystem-depends-on</strong> <var class="def-var-arguments">system</var><a class="copiable-link" href='#index-system_002ddefsystem_002ddepends_002don'> &para;</a></span></dt>
</dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-system_002ddepends_002don"><span class="category-def">Function: </span><span><strong class="def-name">system-depends-on</strong> <var class="def-var-arguments">system</var><a class="copiable-link" href='#index-system_002ddepends_002don'> &para;</a></span></dt>
</dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-system_002dweakly_002ddepends_002don"><span class="category-def">Function: </span><span><strong class="def-name">system-weakly-depends-on</strong> <var class="def-var-arguments">system</var><a class="copiable-link" href='#index-system_002dweakly_002ddepends_002don'> &para;</a></span></dt>
<dd><p>Returns a list of names of systems that are weakly depended on by
<var class="var">system</var>.  Weakly depended on systems are optionally loaded only if
ASDF can find them; failure to find such systems does <em class="emph">not</em> cause an
error in loading.
</p>
<p>Note that the return value for <code class="code">system-weakly-depends-on</code> is simpler
than the return values of the other two system dependency introspection
functions.
</p></dd></dl>

<hr>
</div>
</div>
<div class="section-level-extent" id="Status">
<h3 class="section" id="Status-1">8.12 Status</h3>

<p>This mechanism is vastly successful, and we have declared
that <code class="code">asdf:*central-registry*</code> is not recommended anymore,
though we will continue to support it.
All hooks into implementation-specific search mechanisms
have been integrated in the <code class="code">wrapping-source-registry</code>
that everyone uses implicitly.
</p>
<hr>
</div>
<div class="section-level-extent" id="Rejected-ideas">
<h3 class="section" id="Rejected-ideas-1">8.13 Rejected ideas</h3>

<p>Alternatives I (FRR) considered and rejected while developing ASDF 2 included:
</p>
<ol class="enumerate">
<li> Keep <code class="code">asdf:*central-registry*</code> as the master with its current semantics,
   and somehow the configuration parser expands the new configuration
   language into a expanded series of directories of subdirectories to
   lookup, pre-recursing through specified hierarchies. This is kludgy,
   and leaves little space of future cleanups and extensions.

</li><li> Keep <code class="code">asdf:*central-registry*</code> as the master but extend its semantics
   in completely new ways, so that new kinds of entries may be implemented
   as a recursive search, etc. This seems somewhat backwards.

</li><li> Completely remove <code class="code">asdf:*central-registry*</code>
   and break backwards compatibility.
   Hopefully this will happen in a few years after everyone migrate to
   a better ASDF and/or to XCVB, but it would be very bad to do it now.

</li><li> Replace <code class="code">asdf:*central-registry*</code> by a symbol-macro with appropriate magic
   when you dereference it or setf it. Only the new variable with new
   semantics is handled by the new search procedure.
   Complex and still introduces subtle semantic issues.
</li></ol>


<p>I&rsquo;ve been suggested the below features, but have rejected them,
for the sake of keeping ASDF no more complex than strictly necessary.
</p>
<ul class="itemize mark-bullet">
<li>More syntactic sugar: synonyms for the configuration directives, such as
  <code class="code">(:add-directory X)</code> for <code class="code">(:directory X)</code>, or <code class="code">(:add-directory-hierarchy X)</code>
  or <code class="code">(:add-directory X :recurse t)</code> for <code class="code">(:tree X)</code>.

</li><li>The possibility to register individual files instead of directories.

</li><li>Integrate Xach Beane&rsquo;s tilde expander into the parser,
  or something similar that is shell-friendly or shell-compatible.
  I&rsquo;d rather keep ASDF minimal. But maybe this precisely keeps it
  minimal by removing the need for evaluated entries that ASDF has?
  i.e. uses of <code class="code">USER-HOMEDIR-PATHNAME</code> and <code class="code">$SBCL_HOME</code>
  Hopefully, these are already superseded by the <code class="code">:default-registry</code>

</li><li>Using the shell-unfriendly syntax <code class="code">/**</code> instead of TEXINPUTS-like <code class="code">//</code> to specify recursion
  down a filesystem tree in the environment variable.
  It isn&rsquo;t that Lisp friendly either.
</li></ul>

<hr>
</div>
<div class="section-level-extent" id="TODO">
<h3 class="section" id="TODO-1">8.14 TODO</h3>

<ul class="itemize mark-bullet">
<li>Add examples
</li></ul>

<hr>
</div>
<div class="section-level-extent" id="Credits-for-the-source_002dregistry">
<h3 class="section" id="Credits-for-the-source_002dregistry-1">8.15 Credits for the source-registry</h3>

<p>Thanks a lot to Stelian Ionescu for the initial idea.
</p>
<p>Thanks to Rommel Martinez for the initial implementation attempt.
</p>
<p>All bad design ideas and implementation bugs are mine, not theirs.
But so are good design ideas and elegant implementation tricks.
</p>
<p>&mdash; Francois-Rene Rideau <a class="email" href="mailto:fare@tunes.org">fare@tunes.org</a>, Mon, 22 Feb 2010 00:07:33 -0500
</p>


<hr>
</div>
</div>
<div class="chapter-level-extent" id="Controlling-where-ASDF-saves-compiled-files">
<h2 class="chapter" id="Controlling-where-ASDF-saves-compiled-files-1">9 Controlling where ASDF saves compiled files</h2>
<a class="index-entry-id" id="index-asdf_002doutput_002dtranslations"></a>
<a class="index-entry-id" id="index-ASDF_005fOUTPUT_005fTRANSLATIONS"></a>

<p>Each Common Lisp implementation has its own format
for compiled files or fasls.<a class="footnote" id="DOCF14" href="#FOOT14"><sup>14</sup></a>
If you use multiple implementations
(or multiple versions of the same implementation),
you&rsquo;ll soon find your source directories
littered with various <samp class="file">fasl</samp>s, <samp class="file">dfsl</samp>s, <samp class="file">cfsl</samp>s and so
on.
Worse yet, multiple implementations use the same file extension and
some implementations maintain the same file extension
while changing formats from version to version (or platform to
platform).
This can lead to many errors and much confusion
as you switch from one implementation to the next.
Finally, this requires write access to the source directory,
and therefore precludes sharing of a same source code directory between multiple users.
</p>
<p>Since ASDF 2, ASDF includes the <code class="code">asdf-output-translations</code> facility
to mitigate the problem.
</p>

<hr>
<div class="section-level-extent" id="Output-Configurations">
<h3 class="section" id="Configurations-2">9.1 Configurations</h3>



<p>Configurations specify mappings from input locations to output locations.
Once again we rely on the XDG base directory specification for configuration.
See <a class="xref" href="#Controlling-where-ASDF-searches-for-systems">XDG base directory</a>.
</p>
<ol class="enumerate">
<li> Some hardcoded wrapping output translations configuration may be used.
This allows special output translations (or usually, invariant directories)
to be specified corresponding to the similar special entries in the source registry.

</li><li> An application may explicitly initialize the output-translations
configuration using the Configuration API
in which case this takes precedence.
(see <a class="pxref" href="#Controlling-where-ASDF-saves-compiled-files">Configuration API</a>.)
It may itself compute this configuration from the command-line,
from a script, from its own configuration file, etc.

</li><li> The source registry will be configured from
the environment variable <code class="code">ASDF_OUTPUT_TRANSLATIONS</code> if it exists.

</li><li> The source registry will be configured from
user configuration file
<samp class="file">$XDG_CONFIG_DIRS/common-lisp/asdf-output-translations.conf</samp>
(which defaults to
<samp class="file">~/.config/common-lisp/asdf-output-translations.conf</samp>)
if it exists.

</li><li> The source registry will be configured from
user configuration directory
<samp class="file">$XDG_CONFIG_DIRS/common-lisp/asdf-output-translations.conf.d/</samp>
(which defaults to
<samp class="file">~/.config/common-lisp/asdf-output-translations.conf.d/</samp>)
if it exists.

</li><li> The source registry will be configured from
system configuration file
<samp class="file">/etc/common-lisp/asdf-output-translations.conf</samp>
if it exists.

</li><li> The source registry will be configured from
system configuration directory
<samp class="file">/etc/common-lisp/asdf-output-translations.conf.d/</samp>
if it exists.

</li></ol>

<p>Each of these configurations is specified as a SEXP
in a trivial domain-specific language (see <a class="pxref" href="#Configuration-DSL">Configuration DSL</a>).
Additionally, a more shell-friendly syntax is available
for the environment variable (see <a class="pxref" href="#Shell_002dfriendly-syntax-for-configuration">Shell-friendly syntax for configuration</a>).
</p>
<p>When processing an entry in the above list of configuration methods,
ASDF will stop unless that entry
explicitly or implicitly specifies that it
includes its inherited configuration.
</p>
<p>Note that by default, a per-user cache is used for output files.
This allows the seamless use of shared installations of software
between several users, and takes files out of the way of the developers
when they browse source code,
at the expense of taking a small toll when developers have to clean up
output files and find they need to get familiar with output-translations
first.<a class="footnote" id="DOCF15" href="#FOOT15"><sup>15</sup></a>
</p>

<hr>
</div>
<div class="section-level-extent" id="Output-Backward-Compatibility">
<h3 class="section" id="Backward-Compatibility-2">9.2 Backward Compatibility</h3>
<a class="index-entry-id" id="index-ASDF_002dBINARY_002dLOCATIONS-compatibility"></a>


<p>We purposely do <em class="emph">not</em> provide backward compatibility with earlier versions of
<code class="code">ASDF-Binary-Locations</code> (8 Sept 2009),
<code class="code">common-lisp-controller</code> (7.0) or
<code class="code">cl-launch</code> (2.35),
each of which had similar general capabilities.
The APIs of these programs were not designed
for easy user configuration
through configuration files.
Recent versions of <code class="code">common-lisp-controller</code> (7.2) and <code class="code">cl-launch</code> (3.000)
use the new <code class="code">asdf-output-translations</code> API as defined below.
<code class="code">ASDF-Binary-Locations</code> is fully superseded and not to be used anymore.
</p>
<p>This incompatibility shouldn&rsquo;t inconvenience many people.
Indeed, few people use and customize these packages;
these few people are experts who can trivially adapt to the new configuration.
Most people are not experts, could not properly configure these features
(except inasmuch as the default configuration of
<code class="code">common-lisp-controller</code> and/or <code class="code">cl-launch</code>
might have been doing the right thing for some users),
and yet will experience software that &ldquo;just works&rdquo;,
as configured by the system distributor, or by default.
</p>
<p>Nevertheless, if you are a fan of <code class="code">ASDF-Binary-Locations</code>,
we provide a limited emulation mode:
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-enable_002dasdf_002dbinary_002dlocations_002dcompatibility"><span class="category-def">Function: </span><span><strong class="def-name">enable-asdf-binary-locations-compatibility</strong> <var class="def-var-arguments">&amp;key centralize-lisp-binaries default-toplevel-directory include-per-user-information map-all-source-files source-to-target-mappings</var><a class="copiable-link" href='#index-enable_002dasdf_002dbinary_002dlocations_002dcompatibility'> &para;</a></span></dt>
<dd><p>This function will initialize the new <code class="code">asdf-output-translations</code> facility in a way
that emulates the behaviour of the old <code class="code">ASDF-Binary-Locations</code> facility.
Where you would previously set global variables
<var class="var">*centralize-lisp-binaries*</var>,
<var class="var">*default-toplevel-directory*</var>,
<var class="var">*include-per-user-information*</var>,
<var class="var">*map-all-source-files*</var> or <var class="var">*source-to-target-mappings*</var>
you will now have to pass the same values as keyword arguments to this function.
Note however that as an extension the <code class="code">:source-to-target-mappings</code> keyword argument
will accept any valid pathname designator for <code class="code">asdf-output-translations</code>
instead of just strings and pathnames.
</p></dd></dl>

<p>If you insist, you can also keep using the old <code class="code">ASDF-Binary-Locations</code>
(the one available as an extension to load of top of ASDF,
not the one built into a few old versions of ASDF),
but first you must disable <code class="code">asdf-output-translations</code>
with <code class="code">(asdf:disable-output-translations)</code>,
or you might experience &ldquo;interesting&rdquo; issues.
</p>
<p>Also, note that output translation is enabled by default.
To disable it, use <code class="code">(asdf:disable-output-translations)</code>.
</p>
<hr>
</div>
<div class="section-level-extent" id="Output-Configuration-DSL">
<h3 class="section" id="Configuration-DSL-2">9.3 Configuration DSL</h3>

<p>Here is the grammar of the SEXP DSL
for <code class="code">asdf-output-translations</code> configuration:
</p>
<pre class="verbatim">;; A configuration is single SEXP starting with keyword :output-translations
;; followed by a list of directives.
CONFIGURATION := (:output-translations DIRECTIVE ...)

;; A directive is one of the following:
DIRECTIVE :=
    ;; INHERITANCE DIRECTIVE:
    ;; Your configuration expression MUST contain
    ;; exactly one of either of these:
    :inherit-configuration |
      ;; splices inherited configuration (often specified last)
    :ignore-inherited-configuration |
      ;; drop inherited configuration (specified anywhere)

    ;; forward compatibility directive (since ASDF 2.011.4), useful when
    ;; you want to use new configuration features but have to bootstrap a
    ;; the newer required ASDF from an older release that doesn't have
    ;; said features:
    :ignore-invalid-entries |

    ;; include a configuration file or directory
    (:include PATHNAME-DESIGNATOR) |

    ;; enable global cache in ~/.common-lisp/cache/sbcl-1.0.45-linux-amd64/
    ;; or something.
    :enable-user-cache |
    ;; Disable global cache. Map / to /
    :disable-cache |

    ;; add a single directory to be scanned (no recursion)
    (DIRECTORY-DESIGNATOR DIRECTORY-DESIGNATOR)

    ;; use a function to return the translation of a directory designator
    (DIRECTORY-DESIGNATOR (:function TRANSLATION-FUNCTION))

DIRECTORY-DESIGNATOR :=
    NIL | ; As source: skip this entry. As destination: same as source
    T | ; as source matches anything, as destination
        ; maps pathname to itself.
    ABSOLUTE-COMPONENT-DESIGNATOR ; same as in the source-registry language

TRANSLATION-FUNCTION :=
    SYMBOL | ;; symbol naming a function that takes two arguments:
             ;; the pathname to be translated and the matching
             ;; DIRECTORY-DESIGNATOR
    LAMBDA   ;; A form which evaluates to a function taking two arguments:
             ;; the pathname to be translated and the matching
             ;; DIRECTORY-DESIGNATOR

</pre>
<p>Relative components better be either relative
or subdirectories of the path before them, or bust.
</p>
<p>The last component, if not a pathname, is notionally completed by <samp class="file">/**/*.*</samp>.
You can specify more fine-grained patterns
by using a pathname object as the last component
e.g. <samp class="file">#p&quot;some/path/**/foo*/bar-*.fasl&quot;</samp>
</p>
<p>You may use <code class="code">#+features</code> to customize the configuration file.
</p>
<p>The second designator of a mapping may be <code class="code">nil</code>, indicating that files are not mapped
to anything but themselves (same as if the second designator was the same as the first).
</p>
<p>When the first designator is <code class="code">t</code>,
the mapping always matches.
When the first designator starts with <code class="code">:root</code>,
the mapping matches any host and device.
In either of these cases, if the second designator
isn&rsquo;t <code class="code">t</code> and doesn&rsquo;t start with <code class="code">:root</code>,
then strings indicating the host and pathname are somehow copied
in the beginning of the directory component of the source pathname
before it is translated.
</p>
<p>When the second designator is <code class="code">t</code>, the mapping is the identity.
When the second designator starts with <code class="code">:root</code>,
the mapping preserves the host and device of the original pathname.
Notably, this allows you to map files
to a subdirectory of the whichever directory the file is in.
Though the syntax is not quite as easy to use as we&rsquo;d like,
you can have an (source destination) mapping entry such as follows
in your configuration file,
or you may use <code class="code">enable-asdf-binary-locations-compatibility</code>
with <code class="code">:centralize-lisp-binaries nil</code>
which will do the same thing internally for you:
</p><div class="example lisp">
<pre class="lisp-preformatted">#.(let ((wild-subdir
          (make-pathname :directory '(:relative :wild-inferiors)))
        (wild-file
          (make-pathname :name :wild :version :wild :type :wild)))
   `((:root ,wild-subdir ,wild-file)
     (:root ,wild-subdir :implementation ,wild-file)))
</pre></div>
<p>Starting with ASDF 2.011.4, you can use the simpler:
	<code class="code">`(:root (:root :**/ :implementation :*.*.*))</code>
</p>


<p><code class="code">:include</code> statements cause the search to recurse with the path specifications
from the file specified.
</p>
<p>If the <code class="code">translate-pathname</code> mechanism cannot achieve a desired
translation, the user may provide a function which provides the
required algorithm.  Such a translation function is specified by
supplying a list as the second <code class="code">directory-designator</code>
the first element of which is the keyword <code class="code">:function</code>,
and the second element of which is
either a symbol which designates a function or a lambda expression.
The function designated by the second argument must take two arguments,
the first being the pathname of the source file,
the second being the wildcard that was matched.
When invoked, the function should return the translated pathname.
</p>
<p>An <code class="code">:inherit-configuration</code> statement causes the search to recurse with the path
specifications from the next configuration in the bulleted list.
See <a class="xref" href="#Controlling-where-ASDF-saves-compiled-files">Configurations</a>, above.
</p>
<a class="index-entry-id" id="index-asdf_003a_003a_002auser_002dcache_002a"></a>
<ul class="itemize mark-bullet">
<li><code class="code">:enable-user-cache</code> is the same as <code class="code">(t :user-cache)</code>.
</li><li><code class="code">:disable-cache</code> is the same as <code class="code">(t t)</code>.
</li><li><code class="code">:user-cache</code> uses the contents of variable <code class="code">asdf::*user-cache*</code>
which by default is the same as using
<code class="code">(:home &quot;.cache&quot; &quot;common-lisp&quot; :implementation)</code>.
</li></ul>


<hr>
</div>
<div class="section-level-extent" id="Output-Configuration-Directories">
<h3 class="section" id="Configuration-Directories-2">9.4 Configuration Directories</h3>

<p>Configuration directories consist of files, each of which contains
a list of directives without any enclosing
<code class="code">(:output-translations ...)</code> form.
The files will be sorted by namestring as if by <code class="code">string&lt;</code> and
the lists of directives of these files with be concatenated in order.
An implicit <code class="code">:inherit-configuration</code> will be included
at the <em class="emph">end</em> of the list.
</p>
<p>System-wide or per-user Common Lisp software distributions
such as Debian packages or some future version of <code class="code">clbuild</code>
may then include files such as
<samp class="file">/etc/common-lisp/asdf-output-translations.conf.d/10-foo.conf</samp> or
<samp class="file">~/.config/common-lisp/asdf-output-translations.conf.d/10-foo.conf</samp>
to easily and modularly register configuration information
about software being distributed.
</p>
<p>The convention is that, for sorting purposes,
the names of files in such a directory begin with two digits
that determine the order in which these entries will be read.
Also, the type of these files must be <samp class="file">.conf</samp>,
which not only simplifies the implementation by allowing
for more portable techniques in finding those files,
but also makes it trivial to disable a file, by renaming it to a different file type.
</p>
<p>Directories may be included by specifying a directory pathname
or namestring in an <code class="code">:include</code> directive, e.g.:
</p>
<pre class="verbatim">	(:include &quot;/foo/bar/&quot;)
</pre>
<hr>
</div>
<div class="section-level-extent" id="Output-Shell_002dfriendly-syntax-for-configuration">
<h3 class="section" id="Shell_002dfriendly-syntax-for-configuration-2">9.5 Shell-friendly syntax for configuration</h3>

<p>When processing the environment variable
<code class="code">ASDF_OUTPUT_TRANSLATIONS</code>:
</p><ul class="itemize mark-bullet">
<li>ASDF will skip to the next configuration if it&rsquo;s an empty string.
</li><li>ASDF will <code class="code">READ</code> the string as an SEXP in the DSL, if it
begins with a parenthesis <code class="code">(</code>.
</li><li>Otherwise ASDF will interpret the value as a list of directories
(see below).
</li></ul>

<p>In the directory list format,
directories should come in pairs, each pair indicating a mapping directive.
Entries are separated
by a <code class="code">:</code> (colon) on Unix platforms (including Mac and cygwin), and
by a <code class="code">;</code> (semicolon) on other platforms (mainly, Windows).
</p>
<p>The magic empty entry,
if it comes in what would otherwise be the first entry in a pair,
indicates the splicing of inherited configuration;
the next entry (if any) then starts a new pair.
If the second entry in a pair is empty,
it indicates that the directory in the first entry is to be left untranslated
(which has the same effect as if the directory had been repeated).
</p>
<p>For example, <code class="code">&quot;/foo:/bar::/baz:&quot;</code> means:
specify that outputs for things under directory <samp class="file">/foo/</samp>
are translated to be under <samp class="file">/bar/</samp>;
then include the inherited configuration;
then specify that outputs for things under directory <samp class="file">/baz/</samp> are not translated.
</p>

<hr>
</div>
<div class="section-level-extent" id="Semantics-of-Output-Translations">
<h3 class="section" id="Semantics-of-Output-Translations-1">9.6 Semantics of Output Translations</h3>

<p>From the specified configuration,
a list of mappings is extracted in a straightforward way:
mappings are collected in order, recursing through
included or inherited configuration as specified.
To this list is prepended some implementation-specific mappings,
and is appended a global default.
</p>
<p>The list is then compiled to a mapping table as follows:
for each entry, in order, resolve the first designated directory
into an actual directory pathname for source locations.
If no mapping was specified yet for that location,
resolve the second designated directory to an output location directory
add a mapping to the table mapping the source location to the output location,
and add another mapping from the output location to itself
(unless a mapping already exists for the output location).
</p>
<p>Based on the table, a mapping function is defined,
mapping source pathnames to output pathnames:
given a source pathname, locate the longest matching prefix
in the source column of the mapping table.
Replace that prefix by the corresponding output column
in the same row of the table, and return the result.
If no match is found, return the source pathname.
(A global default mapping the filesystem root to itself
may ensure that there will always be a match,
with same fall-through semantics).
</p>
<hr>
</div>
<div class="section-level-extent" id="Output-Caching-Results">
<h3 class="section" id="Caching-Results-2">9.7 Caching Results</h3>

<p>The implementation is allowed to either eagerly compute the information
from the configurations and file system, or to lazily re-compute it
every time, or to cache any part of it as it goes.
To explicitly flush any information cached by the system, use the API below.
</p>

<hr>
</div>
<div class="section-level-extent" id="Output-location-API">
<h3 class="section" id="Output-location-API-1">9.8 Output location API</h3>

<p>The specified functions are exported from package ASDF.
</p>
<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-initialize_002doutput_002dtranslations"><span class="category-def">Function: </span><span><strong class="def-name">initialize-output-translations</strong> <var class="def-var-arguments">&amp;optional PARAMETER</var><a class="copiable-link" href='#index-initialize_002doutput_002dtranslations'> &para;</a></span></dt>
<dd><p>will read the configuration and initialize all internal variables.
   You may extend or override configuration
   from the environment and configuration files
   with the given <var class="var">PARAMETER</var>, which can be
   <code class="code">nil</code> (no configuration override),
   or a SEXP (in the SEXP DSL),
   a string (as in the string DSL),
   a pathname (of a file or directory with configuration),
   or a symbol (fbound to function that when called returns one of the above).
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-disable_002doutput_002dtranslations"><span class="category-def">Function: </span><span><strong class="def-name">disable-output-translations</strong><a class="copiable-link" href='#index-disable_002doutput_002dtranslations'> &para;</a></span></dt>
<dd><p>will initialize output translations in a way
   that maps every pathname to itself,
   effectively disabling the output translation facility.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-clear_002doutput_002dtranslations-1"><span class="category-def">Function: </span><span><strong class="def-name">clear-output-translations</strong><a class="copiable-link" href='#index-clear_002doutput_002dtranslations-1'> &para;</a></span></dt>
<dd><p>undoes any output translation configuration
   and clears any cache for the mapping algorithm.
   You might want to call this function
   (or better, <code class="code">clear-configuration</code>)
   before you dump an image that would be resumed
   with a different configuration,
   and return an empty configuration.
   Note that this does not include clearing information about
   systems defined in the current image, only about
   where to look for systems not yet defined.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-ensure_002doutput_002dtranslations"><span class="category-def">Function: </span><span><strong class="def-name">ensure-output-translations</strong> <var class="def-var-arguments">&amp;optional PARAMETER</var><a class="copiable-link" href='#index-ensure_002doutput_002dtranslations'> &para;</a></span></dt>
<dd><p>checks whether output translations have been initialized.
   If not, initialize them with the given <var class="var">PARAMETER</var>.
   This function will be called before any attempt to operate on a system.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-apply_002doutput_002dtranslations"><span class="category-def">Function: </span><span><strong class="def-name">apply-output-translations</strong> <var class="def-var-arguments">PATHNAME</var><a class="copiable-link" href='#index-apply_002doutput_002dtranslations'> &para;</a></span></dt>
<dd><p>Applies the configured output location translations to <var class="var">PATHNAME</var>
   (calls <code class="code">ensure-output-translations</code> for the translations).
</p></dd></dl>

<p>Every time you use ASDF&rsquo;s <code class="code">output-files</code>, or
anything that uses it (that may compile, such as <code class="code">operate</code>, <code class="code">perform</code>, etc.),
<code class="code">ensure-output-translations</code> is called with parameter <code class="code">nil</code>,
which the first time around causes your configuration to be read.
If you change a configuration file,
you need to explicitly <code class="code">initialize-output-translations</code> again,
or maybe <code class="code">clear-output-translations</code> (or <code class="code">clear-configuration</code>),
which will cause the initialization to happen next time around.
</p>

<hr>
</div>
<div class="section-level-extent" id="Credits-for-output-translations">
<h3 class="section" id="Credits-for-output-translations-1">9.9 Credits for output translations</h3>

<p>Thanks a lot to Peter van Eynde for <code class="code">Common Lisp Controller</code>
and to Bjorn Lindberg and Gary King for <code class="code">ASDF-Binary-Locations</code>.
</p>
<p>All bad design ideas and implementation bugs are to mine, not theirs.
But so are good design ideas and elegant implementation tricks.
</p>
<p>&mdash; Francois-Rene Rideau <a class="email" href="mailto:fare@tunes.org">fare@tunes.org</a>
</p>







<hr>
</div>
</div>
<div class="chapter-level-extent" id="Error-handling">
<h2 class="chapter" id="Error-handling-1">10 Error handling</h2>
<a class="index-entry-id" id="index-system_002ddefinition_002derror"></a>
<a class="index-entry-id" id="index-operation_002derror"></a>

<div class="section-level-extent" id="ASDF-errors">
<h3 class="section">10.1 ASDF errors</h3>

<p>If ASDF detects an incorrect system definition, it will signal a generalised instance of
<code class="code">system-definition-error</code>.
</p>
<p>Operations may go wrong (for example when source files contain errors).
These are signalled using generalised instances of
<code class="code">operation-error</code>.
</p>
</div>
<div class="section-level-extent" id="Compilation-error-and-warning-handling">
<h3 class="section">10.2 Compilation error and warning handling</h3>
<a class="index-entry-id" id="index-_002acompile_002dfile_002dwarnings_002dbehaviour_002a"></a>
<a class="index-entry-id" id="index-_002acompile_002dfile_002dfailure_002dbehaviour_002a"></a>

<p>ASDF checks for warnings and errors when a file is compiled.
The variables <var class="var">*compile-file-warnings-behaviour*</var> and
<var class="var">*compile-file-failure-behaviour*</var>
control the handling of any such events.
The valid values for these variables are
<code class="code">:error</code>, <code class="code">:warn</code>, and <code class="code">:ignore</code>.
</p>
<hr>
</div>
</div>
<div class="chapter-level-extent" id="Miscellaneous-additional-functionality">
<h2 class="chapter" id="Miscellaneous-additional-functionality-1">11 Miscellaneous additional functionality</h2>

<p>ASDF includes several additional features that are generally
useful for system definition and development.
</p>

<hr>
<div class="section-level-extent" id="Controlling-file-compilation">
<h3 class="section" id="Controlling-file-compilation-1">11.1 Controlling file compilation</h3>
<a class="index-entry-id" id="index-_003aaround_002dcompile"></a>
<a class="index-entry-id" id="index-around_002dcompile-keyword"></a>
<a class="index-entry-id" id="index-compile_002dcheck-keyword"></a>
<a class="index-entry-id" id="index-_003acompile_002dcheck"></a>
<a class="index-entry-id" id="index-compile_002dfile_002a"></a>


<p>When declaring a component (system, module, file),
you can specify a keyword argument <code class="code">:around-compile function</code>.
If left unspecified (and therefore unbound),
the value will be inherited from the parent component if any,
or with a default of <code class="code">nil</code>
if no value is specified in any transitive parent.
</p>
<p>The argument must be either <code class="code">nil</code>, an fbound symbol,
a lambda-expression (e.g. <code class="code">(lambda (thunk) ...(funcall thunk ...) ...)</code>)
a function object (e.g. using <code class="code">#.#'</code> but that&rsquo;s discouraged
because it prevents the introspection done by e.g. asdf-dependency-grovel),
or a string that when <code class="code">read</code> yields a symbol or a lambda-expression.
<code class="code">nil</code> means the normal compile-file function will be called.
A non-nil value designates a function of one argument
that will be called with a function that will
invoke <code class="code">compile-file*</code> with various arguments;
the around-compile hook may supply additional keyword arguments
to pass to that call to <code class="code">compile-file*</code>.
</p>
<p>One notable argument that is heeded by <code class="code">compile-file*</code> is
<code class="code">:compile-check</code>,
a function called when the compilation was otherwise a success,
with the same arguments as <code class="code">compile-file</code>;
the function shall return true if the compilation
and its resulting compiled file respected all system-specific invariants,
and false (<code class="code">nil</code>) if it broke any of those invariants;
it may issue warnings or errors before it returns <code class="code">nil</code>.
(NB: The ability to pass such extra flags
is only available starting with ASDF 2.22.3.)
This feature is notably exercised by asdf-finalizers.
</p>
<p>By using a string, you may reference
a function, symbol and/or package
that will only be created later during the build, but
isn&rsquo;t yet present at the time the defsystem form is evaluated.
However, if your entire system is using such a hook, you may have to
explicitly override the hook with <code class="code">nil</code> for all the modules and files
that are compiled before the hook is defined.
</p>
<p>Using this hook, you may achieve such effects as:
locally renaming packages,
binding <var class="var">*readtables*</var> and other syntax-controlling variables,
handling warnings and other conditions,
proclaiming consistent optimization settings,
saving code coverage information,
maintaining meta-data about compilation timings,
setting gensym counters and PRNG seeds and other sources of non-determinism,
overriding the source-location and/or timestamping systems,
checking that some compile-time side-effects were properly balanced,
etc.
</p>
<p>Note that there is no around-load hook. This is on purpose.
Some implementations such as ECL, GCL or MKCL link object files,
which allows for no such hook.
Other implementations allow for concatenating FASL files,
which doesn&rsquo;t allow for such a hook either.
We aim to discourage something that&rsquo;s not portable,
and has some dubious impact on performance and semantics
even when it is possible.
Things you might want to do with an around-load hook
are better done around-compile,
though it may at times require some creativity
(see e.g. the <code class="code">package-renaming</code> system).
</p>

<hr>
</div>
<div class="section-level-extent" id="Controlling-source-file-character-encoding">
<h3 class="section" id="Controlling-source-file-character-encoding-1">11.2 Controlling source file character encoding</h3>

<p>Starting with ASDF 2.21, components accept a <code class="code">:encoding</code> option
so authors may specify which character encoding should be used
to read and evaluate their source code.
When left unspecified, the encoding is inherited
from the parent module or system;
if no encoding is specified at any point,
or if <code class="code">nil</code> is explicitly specified,
an extensible protocol described below is followed,
that ultimately defaults to <code class="code">:utf-8</code> since ASDF 3.
</p>
<p>The protocol to determine the encoding is
to call the function <code class="code">detect-encoding</code>,
which itself, if provided a valid file,
calls the function specified by <var class="var">*encoding-detection-hook*</var>,
or else defaults to the <var class="var">*default-encoding*</var>.
The <var class="var">*encoding-detection-hook*</var> is by default bound
to function <code class="code">always-default-encoding</code>,
that always returns the contents of <var class="var">*default-encoding*</var>.
<var class="var">*default-encoding*</var> is bound to <code class="code">:utf-8</code> by default
(before ASDF 3, the default was <code class="code">:default</code>).
</p>
<p>Whichever encoding is returned must be a portable keyword,
that will be translated to an implementation-specific external-format designator
by function <code class="code">encoding-external-format</code>,
which itself simply calls the function specified <var class="var">*encoding-external-format-hook*</var>;
that function by default is <code class="code">default-encoding-external-format</code>,
that only recognizes <code class="code">:utf-8</code> and <code class="code">:default</code>,
and translates the former to the implementation-dependent <var class="var">*utf-8-external-format*</var>,
and the latter to itself (that itself is portable but has an implementation-dependent meaning).
</p>
<p>In other words, there now are plenty of extension hooks, but
by default ASDF enforces the previous <em class="emph">de facto</em> standard behaviour
of using <code class="code">:utf-8</code>, independently from
whatever configuration the user may be using.
Thus, system authors can now rely on <code class="code">:utf-8</code>
being used while compiling their files,
even if the user is currently using <code class="code">:koi8-r</code> or <code class="code">:euc-jp</code>
as their interactive encoding.
(Before ASDF 3, there was no such guarantee, <code class="code">:default</code> was used,
and only plain ASCII was safe to include in source code.)
</p>
<p>Some legacy implementations only support 8-bit characters,
and some implementations provide 8-bit only variants.
On these implementations, the <var class="var">*utf-8-external-format*</var>
gracefully falls back to <code class="code">:default</code>,
and Unicode characters will be read as multi-character mojibake.
To detect such situations, UIOP will push the <code class="code">:asdf-unicode</code> feature
on implementations that support Unicode, and you can use reader-conditionalization
to protect any <code class="code">:encoding <em class="emph">encoding</em></code> statement, as in
<code class="code">#+asdf-unicode :encoding #+asdf-unicode :utf-8</code>.
We recommend that you avoid using unprotected <code class="code">:encoding</code> specifications
until after ASDF 2.21 or later becomes widespread.
As of May 2016, all maintained implementations provide ASDF 3.1,
so you may prudently start using this and other features without such protection.
</p>
<p>While it offers plenty of hooks for extension,
and one such extension is available (see <code class="code">asdf-encodings</code> below),
ASDF itself only recognizes one encoding beside <code class="code">:default</code>,
and that is <code class="code">:utf-8</code>, which is the <em class="emph">de facto</em> standard,
already used by the vast majority of libraries that use more than ASCII.
On implementations that do not support unicode,
the feature <code class="code">:asdf-unicode</code> is absent, and
the <code class="code">:default</code> external-format is used
to read even source files declared as <code class="code">:utf-8</code>.
On these implementations, non-ASCII characters
intended to be read as one CL character
may thus end up being read as multiple CL characters.
In most cases, this shouldn&rsquo;t affect the software&rsquo;s semantics:
comments will be skipped just the same, strings with be read and printed
with slightly different lengths, symbol names will be accordingly longer,
but none of it should matter.
But a few systems that actually depend on unicode characters
may fail to work properly, or may work in a subtly different way.
See for instance <code class="code">lambda-reader</code>.
</p>
<p>We invite you to embrace UTF-8
as the encoding for non-ASCII characters starting today,
even without any explicit specification in your <samp class="file">.asd</samp> files.
Indeed, on some implementations and configurations,
UTF-8 is already the <code class="code">:default</code>,
and loading your code may cause errors if it is encoded in anything but UTF-8.
Therefore, even with the legacy behaviour,
non-UTF-8 is guaranteed to break for some users,
whereas UTF-8 is pretty much guaranteed not to break anywhere
(provided you do <em class="emph">not</em> use a BOM),
although it might be read incorrectly on some implementations.
<code class="code">:utf-8</code> has been the default value of <code class="code">*default-encoding*</code> since ASDF 3.
</p>
<p>If you need non-standard character encodings for your source code,
use the extension system <code class="code">asdf-encodings</code>, by specifying
<code class="code">:defsystem-depends-on (&quot;asdf-encodings&quot;)</code> in your <code class="code">defsystem</code>.
This extension system will register support for more encodings using the
<code class="code">*encoding-external-format-hook*</code> facility,
so you can explicitly specify <code class="code">:encoding :latin1</code>
in your <samp class="file">.asd</samp> file.
Using the <code class="code">*encoding-detection-hook*</code> it will also
eventually implement some autodetection of a file&rsquo;s encoding
from an emacs-style <code class="code">-*- mode: lisp ; coding: latin1 -*-</code> declaration,
or otherwise based on an analysis of octet patterns in the file.
At this point, <code class="code">asdf-encoding</code> only supports the encodings
that are supported as part of your implementation.
Since the list varies depending on implementations,
we still recommend you use <code class="code">:utf-8</code> everywhere,
which is the most portable (next to it is <code class="code">:latin1</code>).
</p>
<p>Recent versions of Quicklisp include <code class="code">asdf-encodings</code>;
if you&rsquo;re not using it, you may get this extension using git:
<kbd class="kbd">git clone https://gitlab.common-lisp.net/asdf/asdf-encodings.git</kbd>
or
<kbd class="kbd">git clone git@gitlab.common-lisp.net:asdf/asdf-encodings.git</kbd>.
You can also browse the repository on
<a class="url" href="https://gitlab.common-lisp.net/asdf/asdf-encodings">https://gitlab.common-lisp.net/asdf/asdf-encodings</a>.
</p>
<p>When you use <code class="code">asdf-encodings</code>,
any <samp class="file">.asd</samp> file loaded
will use the autodetection algorithm to determine its encoding.
If you depend on this detection happening,
you should explicitly load <code class="code">asdf-encodings</code> early in your build.
Note that <code class="code">:defsystem-depends-on</code> cannot be used here: by the time
the <code class="code">:defsystem-depends-on</code> is loaded, the enclosing
<code class="code">defsystem</code> form has already been read.
</p>
<p>In practice, this means that the <code class="code">*default-encoding*</code>
is usually used for <samp class="file">.asd</samp> files.
Currently, this defaults to <code class="code">:utf-8</code>, and
you should be safe using Unicode characters in those files.
This might matter, for instance, in meta-data about author&rsquo;s names.
Otherwise, the main data in these files is component (path)names,
and we don&rsquo;t recommend using non-ASCII characters for these,
for the result probably isn&rsquo;t very portable.
</p>
<hr>
</div>
<div class="section-level-extent" id="Miscellaneous-Functions">
<h3 class="section" id="Miscellaneous-Functions-1">11.3 Miscellaneous Functions</h3>

<p>These functions are exported by ASDF for your convenience.
</p>
<a class="anchor" id="system_002drelative_002dpathname"></a><dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-system_002drelative_002dpathname"><span class="category-def">Function: </span><span><strong class="def-name">system-relative-pathname</strong> <var class="def-var-arguments">system name &amp;key type</var><a class="copiable-link" href='#index-system_002drelative_002dpathname'> &para;</a></span></dt>
<dd>
<p>It&rsquo;s often handy to locate a file relative to some system.
The <code class="code">system-relative-pathname</code> function meets this need.
</p>
<p>It takes two mandatory arguments <var class="var">system</var> and <var class="var">name</var>
and a keyword argument <var class="var">type</var>:
<var class="var">system</var> is name of a system, whereas <var class="var">name</var> and optionally <var class="var">type</var>
specify a relative pathname, interpreted like a component pathname specifier
by <code class="code">coerce-pathname</code>. See <a class="xref" href="#Pathname-specifiers">Pathname specifiers</a>.
</p>
<p>It returns a pathname built from the location of the system&rsquo;s
source directory and the relative pathname. For example:
</p>
<div class="example lisp">
<pre class="lisp-preformatted">&gt; (asdf:system-relative-pathname 'cl-ppcre &quot;regex.data&quot;)
#P&quot;/repository/other/cl-ppcre/regex.data&quot;
</pre></div>

</dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-system_002dsource_002ddirectory"><span class="category-def">Function: </span><span><strong class="def-name">system-source-directory</strong> <var class="def-var-arguments">system-designator</var><a class="copiable-link" href='#index-system_002dsource_002ddirectory'> &para;</a></span></dt>
<dd>
<p>ASDF does not provide a turnkey solution for locating
data (or other miscellaneous) files
that are distributed together with the source code of a system.
Programmers can use <code class="code">system-source-directory</code> to find such files.
Returns a pathname object.
The <var class="var">system-designator</var> may be a string, symbol, or ASDF system object.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-clear_002dsystem"><span class="category-def">Function: </span><span><strong class="def-name">clear-system</strong> <var class="def-var-arguments">system-designator</var><a class="copiable-link" href='#index-clear_002dsystem'> &para;</a></span></dt>
<dd>
<p>It is sometimes useful to force recompilation of a previously loaded system.
For these cases, <code class="code">(asdf:clear-system :foo)</code>
will remove the system from the table of currently loaded systems:
the next time the system <code class="code">foo</code> or one that depends on it is re-loaded,
<code class="code">foo</code> will be loaded again.<a class="footnote" id="DOCF16" href="#FOOT16"><sup>16</sup></a>
</p>
<p>Note that this does not and cannot undo
the previous loading of the system.
Common Lisp has no provision for such an operation,
and its reliance on irreversible side-effects to global data structures
makes such a thing impossible in the general case.
If the software being re-loaded is not conceived with hot upgrade in mind,
re-loading may cause many errors, warnings or subtle silent problems,
as packages, generic function signatures, structures, types, macros, constants, etc.
are being redefined incompatibly.
It is up to the user to make sure that reloading is possible and has the desired effect.
In some cases, extreme measures such as recursively deleting packages,
unregistering symbols, defining methods on <code class="code">update-instance-for-redefined-class</code>
and much more are necessary for reloading to happen smoothly.
ASDF itself goes to extensive effort to make a hot upgrade possible
with respect to its own code.
If you want, you can reuse some of its utilities such as
<code class="code">uiop:define-package</code> and <code class="code">uiop:with-upgradability</code>,
and get inspiration (or disinspiration)
from what it does in <samp class="file">header.lisp</samp> and <samp class="file">upgrade.lisp</samp>.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-register_002dpreloaded_002dsystem"><span class="category-def">Function: </span><span><strong class="def-name">register-preloaded-system</strong> <var class="def-var-arguments">name &amp;rest keys &amp;key version &amp;allow-other-keys</var><a class="copiable-link" href='#index-register_002dpreloaded_002dsystem'> &para;</a></span></dt>
<dd><p>A system with name <var class="var">name</var>,
created by <code class="code">make-instance</code> with extra keys <var class="var">keys</var>
(e.g. <code class="code">:version</code>),
is registered as <em class="emph">preloaded</em>.
If <var class="var">version</var> is <code class="code">t</code> (default), then the version is copied from the defined system
of the same name (if registered) or else is <code class="code">nil</code>
(this automatic copy of version is only available starting since ASDF 3.1.8).
</p>
<p>A preloaded system is considered as having already been loaded into the current image,
and if at some point some other system <code class="code">:depends-on</code> it yet no source code is found,
it is considered as already provided,
and ASDF will not raise a <code class="code">missing-component</code> error.
</p>
<p>This function is particularly useful if you distribute your code
as fasls with either <code class="code">compile-bundle-op</code> or <code class="code">monolithic-compile-bundle-op</code>,
and want to register systems so that dependencies will work uniformly
whether you&rsquo;re using your software from source or from fasl.
</p>
<p>Note that if the system was already defined or loaded from source code,
its build information will remain active until you call <code class="code">clear-system</code> on it,
at which point a system without build information will be registered in its place.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-register_002dimmutable_002dsystem-1"><span class="category-def">Function: </span><span><strong class="def-name">register-immutable-system</strong> <var class="def-var-arguments">name &amp;rest keys</var><a class="copiable-link" href='#index-register_002dimmutable_002dsystem-1'> &para;</a></span></dt>
<dd><p>A system with name <var class="var">name</var> is registered as preloaded,
and additionally is marked as <em class="emph">immutable</em>:
that is, attempts to compile or load it will be succeed
without actually reading, creating or loading any file,
as if the system was passed as a <code class="code">force-not</code> argument
to all calls to <code class="code">plan</code> or <code class="code">operate</code>.
There will be no search for an updated <samp class="file">.asd</samp> file
to override the loaded version,
whether from the source-register or any other method.
</p>
<p>If a <var class="var">version</var> keyword argument is specified as <code class="code">t</code> or left unspecified,
then the version is copied from the defined system
of the same name (if registered) or else is <code class="code">nil</code>.
This automatic copy of version is available starting
since immutable systems have been available in ASDF 3.1.5.
</p>
<p>This function, available since ASDF 3.1.5, is particularly useful
if you distribute a large body of code as a precompiled image,
and want to allow users to extend the image with further extension systems,
but without making thousands of filesystem requests looking for inexistent
(or worse, out of date) source code
for all the systems that came bundled with the image but aren&rsquo;t
distributed as source code to regular users.
<a class="index-entry-id" id="index-immutable-systems-1"></a>
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-run_002dshell_002dcommand"><span class="category-def">Function: </span><span><strong class="def-name">run-shell-command</strong> <var class="def-var-arguments">control-string &amp;rest args</var><a class="copiable-link" href='#index-run_002dshell_002dcommand'> &para;</a></span></dt>
<dd>
<p>This function is obsolete and present only for the sake of backwards-compatibility:
&ldquo;If it&rsquo;s not backwards, it&rsquo;s not compatible&rdquo;. We <em class="emph">strongly</em> discourage its use.
Its current behaviour is only well-defined on Unix platforms
(which include MacOS X and cygwin). On Windows, anything goes.
The following documentation is only for the purpose of your migrating away from it
in a way that preserves semantics.
</p>
<p>Instead we recommend the use <code class="code">run-program</code>, described in the next section, and
available as part of ASDF since ASDF 3.
</p>
<p><code class="code">run-shell-command</code> takes as arguments a format <code class="code">control-string</code>
and arguments to be passed to <code class="code">format</code> after this control-string
to produce a string.
This string is a command that will be evaluated with a POSIX shell if possible;
yet, on Windows, some implementations will use CMD.EXE,
while others (like SBCL) will make an attempt at invoking a POSIX shell
(and fail if it is not present).
</p></dd></dl>

<hr>
</div>
<div class="section-level-extent" id="Some-Utility-Functions">
<h3 class="section" id="Some-Utility-Functions-1">11.4 Some Utility Functions</h3>

<p>The below functions are not exported by ASDF itself, but by UIOP, available since ASDF 3.
Some of them have precursors in ASDF 2, but we recommend that for active developments,
you should rely on the package UIOP as included in ASDF 3.
UIOP provides many, many more utility functions, and we recommend
you read its <samp class="file">README.md</samp> and sources for more information.
</p>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-parse_002dunix_002dnamestring"><span class="category-def">Function: </span><span><strong class="def-name">parse-unix-namestring</strong> <var class="def-var-arguments">name &amp;key type defaults dot-dot ensure-directory &amp;allow-other-keys</var><a class="copiable-link" href='#index-parse_002dunix_002dnamestring'> &para;</a></span></dt>
<dd><p>Coerce <var class="var">name</var> into a <var class="var">pathname</var> using standard Unix syntax.
</p>
<p>Unix syntax is used whether or not the underlying system is Unix;
on non-Unix systems it is only usable for relative pathnames.
In order to manipulate relative pathnames portably, it is crucial
to possess a portable pathname syntax independent of the underlying OS.
This is what <code class="code">parse-unix-namestring</code> provides, and why we use it in ASDF.
</p>
<p>When given a <code class="code">pathname</code> object, just return it untouched.
When given <code class="code">nil</code>, just return <code class="code">nil</code>.
When given a non-null <code class="code">symbol</code>, first downcase its name and treat it as a string.
When given a <code class="code">string</code>, portably decompose it into a pathname as below.
</p>
<p><code class="code">#\/</code> separates directory components.
</p>
<p>The last <code class="code">#\/</code>-separated substring is interpreted as follows:
1- If <var class="var">type</var> is <code class="code">:directory</code> or <var class="var">ensure-directory</var> is true,
 the string is made the last directory component, and its <code class="code">name</code> and <code class="code">type</code> are <code class="code">nil</code>.
 if the string is empty, it&rsquo;s the empty pathname with all slots <code class="code">nil</code>.
2- If <var class="var">type</var> is <code class="code">nil</code>, the substring is a file-namestring,
 and its <code class="code">name</code> and <code class="code">type</code> are separated by <code class="code">split-name-type</code>.
3- If <var class="var">type</var> is a string, it is the given <code class="code">type</code>, and the whole string is the <code class="code">name</code>.
</p>
<p>Directory components with an empty name the name <code class="code">.</code> are removed.
Any directory named <code class="code">..</code> is read as <var class="var">dot-dot</var>,
which must be one of <code class="code">:back</code> or <code class="code">:up</code> and defaults to <code class="code">:back</code>.
</p>
<a class="index-entry-id" id="index-_002anil_002dpathname_002a"></a>
<p><code class="code">host</code>, <code class="code">device</code> and <code class="code">version</code> components are taken from <var class="var">defaults</var>,
which itself defaults to <code class="code">*nil-pathname*</code>.
<code class="code">*nil-pathname*</code> is also used if <var class="var">defaults</var> is <code class="code">nil</code>.
No host or device can be specified in the string itself,
which makes it unsuitable for absolute pathnames outside Unix.
</p>
<p>For relative pathnames, these components (and hence the defaults) won&rsquo;t matter
if you use <code class="code">merge-pathnames*</code> but will matter if you use <code class="code">merge-pathnames</code>,
which is an important reason to always use <code class="code">merge-pathnames*</code>.
</p>
<p>Arbitrary keys are accepted, and the parse result is passed to <code class="code">ensure-pathname</code>
with those keys, removing <var class="var">type</var>, <var class="var">defaults</var> and <var class="var">dot-dot</var>.
When you&rsquo;re manipulating pathnames that are supposed to make sense portably
even though the OS may not be Unixish, we recommend you use <code class="code">:want-relative t</code>
so that <code class="code">parse-unix-namestring</code> will throw an error if the pathname is absolute.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-merge_002dpathnames_002a"><span class="category-def">Function: </span><span><strong class="def-name">merge-pathnames*</strong> <var class="def-var-arguments">specified &amp;optional defaults</var><a class="copiable-link" href='#index-merge_002dpathnames_002a'> &para;</a></span></dt>
<dd>
<p>This function is a replacement for <code class="code">merge-pathnames</code> that uses the host and device
from the <var class="var">defaults</var> rather than the <var class="var">specified</var> pathname when the latter
is a relative pathname. This allows ASDF and its users to create and use relative pathnames
without having to know beforehand what are the host and device
of the absolute pathnames they are relative to.
</p>
</dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-subpathname"><span class="category-def">Function: </span><span><strong class="def-name">subpathname</strong> <var class="def-var-arguments">pathname subpath &amp;key type</var><a class="copiable-link" href='#index-subpathname'> &para;</a></span></dt>
<dd>
<p>This function takes a <var class="var">pathname</var> and a <var class="var">subpath</var> and a <var class="var">type</var>.
If <var class="var">subpath</var> is already a <code class="code">pathname</code> object (not namestring),
and is an absolute pathname at that, it is returned unchanged;
otherwise, <var class="var">subpath</var> is turned into a relative pathname with given <var class="var">type</var>
as per <code class="code">parse-unix-namestring</code> with <code class="code">:want-relative t :type </code><var class="var">type</var>,
then it is merged with the <code class="code">pathname-directory-pathname</code> of <var class="var">pathname</var>,
as per <code class="code">merge-pathnames*</code>.
</p>
<p>We strongly encourage the use of this function
for portably resolving relative pathnames in your code base.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-subpathname_002a"><span class="category-def">Function: </span><span><strong class="def-name">subpathname*</strong> <var class="def-var-arguments">pathname subpath &amp;key type</var><a class="copiable-link" href='#index-subpathname_002a'> &para;</a></span></dt>
<dd>
<p>This function returns <code class="code">nil</code> if the base <var class="var">pathname</var> is <code class="code">nil</code>,
otherwise acts like <code class="code">subpathname</code>.
</p></dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-run_002dprogram"><span class="category-def">Function: </span><span><strong class="def-name">run-program</strong> <var class="def-var-arguments">command &amp;key ignore-error-status force-shell input output error-output if-input-does-not-exist if-output-exists if-error-output-exists element-type external-format &amp;allow-other-keys</var><a class="copiable-link" href='#index-run_002dprogram'> &para;</a></span></dt>
<dd>
<p><code class="code">run-program</code> takes a <var class="var">command</var> argument that is either
a list of a program name or path and its arguments,
or a string to be executed by a shell.
It spawns the command, waits for it to return,
verifies that it exited cleanly (unless told not too below),
and optionally captures and processes its output.
It accepts many keyword arguments to configure its behaviour.
</p>
<p><code class="code">run-program</code> returns three values: the first for the output,
the second for the error-output, and the third for the return value.
(Beware that before ASDF 3.0.2.11, it didn&rsquo;t handle input or error-output,
and returned only one value,
the one for the output if any handler was specified, or else the exit code;
please upgrade ASDF, or at least UIOP, to rely on the new enhanced behaviour.)
</p>
<p><var class="var">output</var> is its most important argument;
it specifies how the output is captured and processed.
If it is <code class="code">nil</code>, then the output is redirected to the null device,
that will discard it.
If it is <code class="code">:interactive</code>, then it is inherited from the current process
(beware: this may be different from your <var class="var">*standard-output*</var>,
and under SLIME will be on your <code class="code">*inferior-lisp*</code> buffer).
If it is <code class="code">t</code>, output goes to your current <var class="var">*standard-output*</var> stream.
Otherwise, <var class="var">output</var> should be a value that is a suitable first argument to
<code class="code">slurp-input-stream</code> (see below), or
a list of such a value and keyword arguments.
In this case, <code class="code">run-program</code> will
create a temporary stream for the program output;
the program output, in that stream,
will be processed by a call to <code class="code">slurp-input-stream</code>,
using <var class="var">output</var> as the first argument
(or if it&rsquo;s a list the first element of <var class="var">output</var> and the rest as keywords).
The primary value resulting from that call
(or <code class="code">nil</code> if no call was needed)
will be the first value returned by <code class="code">run-program</code>.
E.g., using <code class="code">:output :string</code>
will have it return the entire output stream as a string.
And using <code class="code">:output '(:string :stripped t)</code>
will have it return the same string stripped of any ending newline.
</p>
<p><var class="var">error-output</var> is similar to <var class="var">output</var>, except that
the resulting value is returned as the second value of <code class="code">run-program</code>.
<code class="code">t</code> designates the <var class="var">*error-output*</var>.
Also <code class="code">:output</code> means redirecting the error output to the output stream,
in which case <code class="code">nil</code> is returned.
</p>
<p><var class="var">input</var> is similar to <var class="var">output</var>, except that
<code class="code">vomit-output-stream</code> is used, no value is returned,
and <code class="code">t</code> designates the <var class="var">*standard-input*</var>.
</p>
<p><code class="code">element-type</code> and <code class="code">external-format</code> are passed on
to your Lisp implementation, when applicable, for creation of the output stream.
</p>
<p>One and only one of the stream slurping or vomiting may or may not happen
in parallel in parallel with the subprocess,
depending on options and implementation,
and with priority being given to output processing.
Other streams are completely produced or consumed
before or after the subprocess is spawned, using temporary files.
</p>
<p><code class="code">force-shell</code> forces evaluation of the command through a shell,
even if it was passed as a list rather than a string.
If a shell is used, it is <samp class="file">/bin/sh</samp> on Unix or <samp class="file">CMD.EXE</samp> on Windows,
except on implementations that (erroneously, IMNSHO)
insist on consulting <code class="code">$SHELL</code> like clisp.
</p>
<p><code class="code">ignore-error-status</code> causes <code class="code">run-program</code>
to not raise an error if the spawned program exits in error.
Following POSIX convention, an error is anything but
a normal exit with status code zero.
By default, an error of type <code class="code">subprocess-error</code> is raised in this case.
</p>
<p><code class="code">run-program</code> works on all platforms supported by ASDF, except Genera.
See the source code for more documentation.
</p>
</dd></dl>

<dl class="first-deffn first-defun-alias-first-deffn">
<dt class="deffn defun-alias-deffn" id="index-slurp_002dinput_002dstream"><span class="category-def">Function: </span><span><strong class="def-name">slurp-input-stream</strong> <var class="def-var-arguments">processor input-stream &amp;key</var><a class="copiable-link" href='#index-slurp_002dinput_002dstream'> &para;</a></span></dt>
<dd>
<p><code class="code">slurp-input-stream</code> is a generic function of two arguments, a target object and an input stream,
and accepting keyword arguments.
Predefined methods based on the target object are as follows:
</p>
<ul class="itemize mark-bullet">
<li>If the object is a function, the function is called with the stream as argument.

</li><li>If the object is a cons, its first element is applied to its rest appended by
a list of the input stream.

</li><li>If the object is an output stream, the contents of the input stream are copied to it.
If the <var class="var">linewise</var> keyword argument is provided, copying happens line by line,
and an optional <var class="var">prefix</var> is printed before each line.
Otherwise, copying happen based on a buffer of size <var class="var">buffer-size</var>,
using the specified <var class="var">element-type</var>.

</li><li>If the object is <code class="code">'string</code> or <code class="code">:string</code>, the content is captured into a string.
Accepted keywords include the <var class="var">element-type</var> and a flag <var class="var">stripped</var>,
which when true causes any single line ending to be removed as per <code class="code">uiop:stripln</code>.

</li><li>If the object is <code class="code">:lines</code>, the content is captured as a list of strings,
one per line, without line ending. If the <var class="var">count</var> keyword argument is provided,
it is a maximum count of lines to be read.

</li><li>If the object is <code class="code">:line</code>, the content is captured as with <code class="code">:lines</code> above,
and then its sub-object is extracted with the <var class="var">at</var> argument,
which defaults to <code class="code">0</code>, extracting the first line.
A number will extract the corresponding line.
See the documentation for <code class="code">uiop:access-at</code>.

</li><li>If the object is <code class="code">:forms</code>, the content is captured as a list of s-expressions,
as read by the Lisp reader.
If the <var class="var">count</var> argument is provided,
it is a maximum count of lines to be read.
We recommend you control the syntax with such macro as
<code class="code">uiop:with-safe-io-syntax</code>.

</li><li>If the object is <code class="code">:form</code>, the content is captured as with <code class="code">:forms</code> above,
and then its sub-object is extracted with the <var class="var">at</var> argument,
which defaults to <code class="code">0</code>, extracting the first form.
A number will extract the corresponding form.
See the documentation for <code class="code">uiop:access-at</code>.
We recommend you control the syntax with such macro as
<code class="code">uiop:with-safe-io-syntax</code>.
</li></ul>
</dd></dl>


<hr>
</div>
</div>
<div class="chapter-level-extent" id="Getting-the-latest-version">
<h2 class="chapter" id="Getting-the-latest-version-1">12 Getting the latest version</h2>


<p>Decide which version you want.
The <code class="code">master</code> branch is where development happens;
its <code class="code">HEAD</code> is usually OK, including the latest fixes and portability tweaks,
but an occasional regression may happen despite our (limited) test suite.
</p>
<p>The <code class="code">release</code> branch is what cautious people should be using;
it has usually been tested more, and releases are cut at a point
where there isn&rsquo;t any known unresolved issue.
</p>
<p>You may get the ASDF source repository using git:
<kbd class="kbd">git clone https://gitlab.common-lisp.net/asdf/asdf.git</kbd>
</p>
<p>You will find the above referenced tags in this repository.
You can also browse the repository on
<a class="url" href="https://gitlab.common-lisp.net/asdf/asdf">https://gitlab.common-lisp.net/asdf/asdf</a>.
</p>
<p>Discussion of ASDF development is conducted on the
mailing list (see <a class="pxref" href="#Mailing-list">Mailing list</a>).
</p>
<hr>
</div>
<div class="chapter-level-extent" id="FAQ">
<h2 class="chapter" id="FAQ-1">13 FAQ</h2>


<hr>
<div class="section-level-extent" id="Where-do-I-report-a-bug_003f">
<h3 class="section" id="g_t_0060_0060Where-do-I-report-a-bug_003f_0027_0027">13.1 &ldquo;Where do I report a bug?&rdquo;</h3>
<a class="index-entry-id" id="index-bug-tracker"></a>
<a class="index-entry-id" id="index-gitlab"></a>
<a class="index-entry-id" id="index-launchpad"></a>
<p>ASDF bugs are tracked on common-lisp.net&rsquo;s gitlab:: <a class="url" href="https://gitlab.common-lisp.net/asdf/asdf/issues">https://gitlab.common-lisp.net/asdf/asdf/issues</a>.
Previously, we had done bug-tracking on <a class="url" href="https://launchpad.net/asdf">https://launchpad.net/asdf</a>,
but we are now consolidating project management on <code class="code">common-lisp.net</code>.
</p>
<p>If you&rsquo;re unsure about whether something is a bug, or for general discussion,
use the asdf-devel mailing list (see <a class="pxref" href="#Mailing-list">Mailing list</a>).
</p>
<hr>
</div>
<div class="section-level-extent" id="Mailing-list">
<h3 class="section" id="Mailing-list-1">13.2 Mailing list</h3>
<a class="index-entry-id" id="index-mailing-list"></a>

<p>Discussion of ASDF development is conducted on the
mailing list
<kbd class="kbd">asdf-devel@common-lisp.net</kbd>.
<a class="url" href="http://common-lisp.net/cgi-bin/mailman/listinfo/asdf-devel">http://common-lisp.net/cgi-bin/mailman/listinfo/asdf-devel</a>
</p>

<hr>
</div>
<div class="section-level-extent" id="What-has-changed-between-ASDF-1-ASDF-2-and-ASDF-3_003f">
<h3 class="section" id="g_t_0060_0060What-has-changed-between-ASDF-1_002c-ASDF-2_002c-and-ASDF-3_003f_0027_0027">13.3 &ldquo;What has changed between ASDF 1, ASDF 2, and ASDF 3?&rdquo;</h3>

<p>We released ASDF 2.000 on May 31st 2010,
ASDF 3.0.0 on May 15th 2013,
ASDF 3.1.2 on May 6th 2014.
Releases of ASDF 2 and now ASDF 3 have since then been included
in all actively maintained CL implementations that used to bundle ASDF 1,
plus many implementations that previously did not.
ASDF has been made to work with all actively maintained CL
implementations and even a few implementations that are <em class="emph">not</em>
actively maintained.
</p>
<p>Furthermore, it is possible to upgrade from ASDF 1 to ASDF 2 or ASDF 3 on the fly
(though we recommend instead upgrading your implementation or replacing its ASDF module).
For this reason, we have stopped supporting ASDF 1 and ASDF 2.
If you are using ASDF 1 or ASDF 2 and are experiencing any kind of issues or limitations,
we recommend you upgrade to ASDF 3
&mdash; and we explain how to do that. See <a class="xref" href="#Loading-ASDF">Loading ASDF</a>.
</p>
<p>Note that in the context of compatibility requirements,
ASDF 2.27, released on Feb 1st 2013, and further releases up to 2.33,
count as pre-releases of ASDF 3, and define the <code class="code">:asdf3</code> feature,
though the first stable release of ASDF 3 was release 3.0.1.
Significant new or improved functionality were added in ASDF 3.1;
the <code class="code">:asdf3.1</code> feature is present in recent enough versions to detect this functionality;
the first stable release since then was ASDF 3.1.2.
New <code class="code">*features*</code> are only added at major milestones,
and the next one will probably be <code class="code">:asdf3.2</code>.
</p>


<hr>
<div class="subsection-level-extent" id="What-are-ASDF-1-2-3_003f">
<h4 class="subsection" id="What-are-ASDF-1_002c-ASDF-2_002c-and-ASDF-3_003f">13.3.1 What are ASDF 1, ASDF 2, and ASDF 3?</h4>

<p>ASDF 1 refers to any release earlier than 1.369 or so (from August 2001 to October 2009),
and to any development revision earlier than 2.000 (May 2010).
If your copy of ASDF doesn&rsquo;t even contain version information, it&rsquo;s an old ASDF 1.
Revisions between 1.656 and 1.728 may count as development releases for ASDF 2.
</p>
<p>ASDF 2 refers to releases from 2.000 (May 31st 2010) to 2.26 (Oct 30th 2012),
and any development revision newer than ASDF 1 and older than 2.27 (Feb 1st 2013).
</p>
<p>ASDF 3 refers to releases from 2.27 (Feb 1st 2013) to 2.33 and 3.0.0 onward (May 15th 2013).
2.27 to 2.33 count as pre-releases to ASDF 3.
</p>
<p>ASDF 3.1 refers to releases from 3.1.2 (May 6th 2014) onward.
These releases are also considered part of ASDF 3.
</p>
<hr>
</div>
<div class="subsection-level-extent" id="How-do-I-detect-the-ASDF-version_003f">
<h4 class="subsection" id="How-do-I-detect-the-ASDF-version_003f-1">13.3.2 How do I detect the ASDF version?</h4>
<a class="index-entry-id" id="index-asdf_002dversion"></a>
<a class="index-entry-id" id="index-_002afeatures_002a"></a>

<p>All releases of ASDF
push <code class="code">:asdf</code> onto <code class="code">*features*</code>.
Releases starting with ASDF 2
push <code class="code">:asdf2</code> onto <code class="code">*features*</code>.
Releases starting with ASDF 3 (including 2.27 and later pre-releases)
push <code class="code">:asdf3</code> onto <code class="code">*features*</code>.
Furthermore, releases starting with ASDF 3.1.2 (May 2014),
though they count as ASDF 3, include enough progress that they
also push <code class="code">:asdf3.1</code> onto <code class="code">*features*</code>.
You may depend on the presence or absence of these features
to write code that takes advantage of recent ASDF functionality
but still works on older versions, or at least detects the old version and signals an error.
</p>
<p>Additionally, all releases starting with ASDF 2
define a function <code class="code">(asdf:asdf-version)</code> you may use to query the version.
All releases starting with 2.013 display the version number prominently
on the second line of the <samp class="file">asdf.lisp</samp> source file.
</p>
<p>If you are experiencing problems or limitations of any sort with ASDF 1 or ASDF 2,
we recommend that you should upgrade to the latest release, be it ASDF 3 or other.
</p>
<p>Finally, here is a code snippet to programmatically determine what version of ASDF is loaded, if any,
that works on all versions including very old ones:
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(when (find-package :asdf)
  (let ((ver (symbol-value
                   (or (find-symbol (string :*asdf-version*) :asdf)
                       (find-symbol (string :*asdf-revision*) :asdf)))))
    (etypecase ver
      (string ver)
      (cons (with-output-to-string (s)
              (loop for (n . m) on ver
                    do (princ n s)
                       (when m (princ &quot;.&quot; s)))))
      (null &quot;1.0&quot;))))
</pre></div>

<p>If it returns <code class="code">nil</code> then ASDF is not installed.
Otherwise it should return a string.
If it returns <code class="code">&quot;1.0&quot;</code>, then it can actually be
any version before 1.77 or so, or some buggy variant of 1.x.
If it returns anything older than <code class="code">&quot;3.0.1&quot;</code>,
you really need to upgrade your implementation or at least upgrade its ASDF.
See <a class="xref" href="#Replacing-your-implementation_0027s-ASDF">Replacing your implementation&rsquo;s ASDF</a>.
</p>


<hr>
</div>
<div class="subsection-level-extent" id="ASDF-can-portably-name-files-in-subdirectories">
<h4 class="subsection" id="ASDF-can-portably-name-files-in-subdirectories-1">13.3.3 ASDF can portably name files in subdirectories</h4>

<p>Common Lisp namestrings are not portable,
except maybe for logical pathname namestrings,
that themselves have various limitations and require a lot of setup
that is itself ultimately non-portable.
</p>
<p>In ASDF 1, the only portable ways to refer to pathnames inside systems and components
were very awkward, using <code class="code">#.(make-pathname ...)</code> and
<code class="code">#.(merge-pathnames ...)</code>.
Even the above were themselves were inadequate in the general case
due to host and device issues, unless horribly complex patterns were used.
Plenty of simple cases that looked portable actually weren&rsquo;t,
leading to much confusion and greavance.
</p>
<p>ASDF 2 implements its own portable syntax for strings as pathname specifiers.
Naming files within a system definition becomes easy and portable again.
See <a class="xref" href="#Miscellaneous-additional-functionality">system-relative-pathname</a>,
<code class="code">merge-pathnames*</code>,
<code class="code">coerce-pathname</code>.
</p>
<p>On the other hand, there are places where systems used to accept namestrings
where you must now use an explicit pathname object:
<code class="code">(defsystem ... :pathname &quot;LOGICAL-HOST:PATH;TO;SYSTEM;&quot; ...)</code>
must now be written with the <code class="code">#p</code> syntax:
<code class="code">(defsystem ... :pathname #p&quot;LOGICAL-HOST:PATH;TO;SYSTEM;&quot; ...)</code>.
We recommend against using pathname objects in general and logical pathnames in particular.
Your code will be much more portable using ASDF&rsquo;s pathname specifiers.
</p>
<p>See <a class="xref" href="#Pathname-specifiers">Pathname specifiers</a>.
</p>

<hr>
</div>
<div class="subsection-level-extent" id="Output-translations">
<h4 class="subsection" id="Output-translations-1">13.3.4 Output translations</h4>

<p>A popular feature added to ASDF was output pathname translation:
<code class="code">asdf-binary-locations</code>, <code class="code">common-lisp-controller</code>,
<code class="code">cl-launch</code> and other hacks were all implementing it in ways
both mutually incompatible and difficult to configure.
</p>
<p>Output pathname translation is essential to share
source directories of portable systems across multiple implementations
or variants thereof,
or source directories of shared installations of systems across multiple users,
or combinations of the above.
</p>
<p>In ASDF 2, a standard mechanism is provided for that,
<code class="code">asdf-output-translations</code>,
with sensible defaults, adequate configuration languages,
a coherent set of configuration files and hooks,
and support for non-Unix platforms.
</p>
<p>See <a class="xref" href="#Controlling-where-ASDF-saves-compiled-files">Controlling where ASDF saves compiled files</a>.
</p>
<hr>
</div>
<div class="subsection-level-extent" id="Source-Registry-Configuration">
<h4 class="subsection" id="Source-Registry-Configuration-1">13.3.5 Source Registry Configuration</h4>

<p>Configuring ASDF used to require special magic
to be applied just at the right moment,
between the moment ASDF is loaded and the moment it is used,
in a way that is specific to the user,
the implementation he is using and the application he is building.
</p>
<p>This made for awkward configuration files and startup scripts
that could not be shared between users, managed by administrators
or packaged by distributions.
</p>
<p>ASDF 2 provides a well-documented way to configure ASDF,
with sensible defaults, adequate configuration languages,
and a coherent set of configuration files and hooks.
</p>
<p>We believe it&rsquo;s a vast improvement because it decouples
application distribution from library distribution.
The application writer can avoid thinking where the libraries are,
and the library distributor (dpkg, clbuild, advanced user, etc.)
can configure them once and for every application.
Yet settings can be easily overridden where needed,
so whoever needs control has exactly as much as required.
</p>
<p>At the same time, ASDF 2 remains compatible
with the old magic you may have in your build scripts
(using <code class="code">*central-registry*</code> and
<code class="code">*system-definition-search-functions*</code>)
to tailor the ASDF configuration to your build automation needs,
and also allows for new magic, simpler and more powerful magic.
</p>
<p>See <a class="xref" href="#Controlling-where-ASDF-searches-for-systems">Controlling where ASDF searches for systems</a>.
</p>

<hr>
</div>
<div class="subsection-level-extent" id="Usual-operations-are-made-easier-to-the-user">
<h4 class="subsection" id="Usual-operations-are-made-easier-to-the-user-1">13.3.6 Usual operations are made easier to the user</h4>

<p>In ASDF 1, you had to use the awkward syntax
<code class="code">(asdf:oos 'asdf:load-op :foo)</code>
to load a system,
and similarly for <code class="code">compile-op</code>, <code class="code">test-op</code>.
</p>
<p>In ASDF 2 and later, you can use shortcuts for the usual operations:
<code class="code">(asdf:load-system :foo)</code>, and
similarly for <code class="code">compile-system</code>, <code class="code">test-system</code>.
</p>

<hr>
</div>
<div class="subsection-level-extent" id="Many-bugs-have-been-fixed">
<h4 class="subsection" id="Many-bugs-have-been-fixed-1">13.3.7 Many bugs have been fixed</h4>

<p>The following issues and many others have been fixed:
</p>
<ul class="itemize mark-bullet">
<li>The infamous TRAVERSE function has been revamped completely
between ASDF 1 and ASDF 2, with many bugs squashed.
In particular, dependencies were not correctly propagated
across modules but now are.
It has been completely rewritten many times over
between ASDF 2.000 and ASDF 3,
with fundamental issues in the original model being fixed.
Timestamps were not propagated at all, and now are.
The internal model of how actions depend on each other
is now both consistent and complete.
As of ASDF 3.3, multiple phases of loading are well supported,
wherein correctly interpreting &lsquo;defsystem&lsquo; statements in some &lsquo;.asd&lsquo; files
itself depends on loading other systems, e.g. via &lsquo;:defsystem-depends-on&lsquo;.
The <code class="code">:version</code> and
the <code class="code">:force (system1 .. systemN)</code> features have been fixed.

</li><li>Performance has been notably improved for large systems
(say with thousands of components) by using
hash-tables instead of linear search,
and linear-time list accumulation instead of cubic time recursive append,
for an overall <em class="emph">O(n)</em> complexity vs <em class="emph">O(n^4)</em>.

</li><li>Many features used to not be portable,
especially where pathnames were involved.
Windows support was notably quirky because of such non-portability.

</li><li>The internal test suite used to massively fail on many implementations.
While still incomplete, it now fully passes
on all implementations supported by the test suite,
though some tests are commented out on a few implementations.

</li><li>Support was lacking for some implementations.
ABCL and GCL were notably wholly broken.
ECL extensions were not integrated with ASDF release.

</li><li>The documentation was grossly out of date.

</li></ul>


<hr>
</div>
<div class="subsection-level-extent" id="ASDF-itself-is-versioned">
<h4 class="subsection" id="ASDF-itself-is-versioned-1">13.3.8 ASDF itself is versioned</h4>

<p>Between new features, old bugs fixed, and new bugs introduced,
there were various releases of ASDF in the wild,
and no simple way to check which release had which feature set.
People using or writing systems had to either make worst-case assumptions
as to what features were available and worked,
or take great pains to have the correct version of ASDF installed.
</p>
<p>With ASDF 2 and later, we provide a new stable set of working features
that everyone can rely on from now on.
Use <code class="code">#+asdf2</code>, <code class="code">#+asdf3</code>, <code class="code">#+asdf3.1</code> or <code class="code">#+asdf3.3</code>
to detect presence of relevant versions of ASDF and their features, or
<code class="code">(asdf:version-satisfies (asdf:asdf-version) &quot;2.345.67&quot;)</code>
to check the availability of a version no earlier than required.
</p>

<hr>
</div>
<div class="subsection-level-extent" id="ASDF-can-be-upgraded">
<h4 class="subsection" id="ASDF-can-be-upgraded-1">13.3.9 ASDF can be upgraded</h4>

<p>When an old version of ASDF was loaded,
it was very hard to upgrade ASDF in your current image
without breaking everything.
Instead you had to exit the Lisp process and
somehow arrange to start a new one from a simpler image.
Something that can&rsquo;t be done from within Lisp,
making automation of it difficult,
which compounded with difficulty in configuration,
made the task quite hard.
Yet as we saw before, the task would have been required
to not have to live with the worst case or non-portable
subset of ASDF features.
</p>
<p>With ASDF 2, it is easy to upgrade
from ASDF 2 to later versions from within Lisp,
and not too hard to upgrade from ASDF 1 to ASDF 2 from within Lisp.
We support hot upgrade of ASDF and any breakage is a bug
that we will do our best to fix.
There are still limitations on upgrade, though,
most notably the fact that after you upgrade ASDF,
you must also reload or upgrade all ASDF extensions.
</p>
<hr>
</div>
<div class="subsection-level-extent" id="Decoupled-release-cycle">
<h4 class="subsection" id="Decoupled-release-cycle-1">13.3.10 Decoupled release cycle</h4>

<p>When vendors were releasing their Lisp implementations with ASDF,
they had to basically never change version
because neither upgrade nor downgrade was possible
without breaking something for someone,
and no obvious upgrade path was visible and recommendable.
</p>
<p>With ASDF 2, upgrade is possible, easy and can be recommended.
This means that vendors can safely ship a recent version of ASDF,
confident that if a user isn&rsquo;t fully satisfied,
he can easily upgrade ASDF and deal
with a supported recent version of it.
This means that release cycles will be causally decoupled,
the practical consequence of which will mean faster convergence
towards the latest version for everyone.
</p>

<hr>
</div>
<div class="subsection-level-extent" id="Pitfalls-of-the-transition-to-ASDF-2">
<h4 class="subsection" id="Pitfalls-of-the-transition-to-ASDF-2-1">13.3.11 Pitfalls of the transition to ASDF 2</h4>

<p>The main pitfalls in upgrading to ASDF 2 seem to be related
to the output translation mechanism.
</p>
<ul class="itemize mark-bullet">
<li>Output translations is enabled by default. This may surprise some users,
most of them in pleasant way (we hope), a few of them in an unpleasant way.
It is trivial to disable output translations.
See <a class="xref" href="#FAQ">&ldquo;How can I wholly disable the compiler output cache?&rdquo;</a>.

</li><li>Some systems in the large have been known
not to play well with output translations.
They were relatively easy to fix.
Once again, it is also easy to disable output translations,
or to override its configuration.

</li><li>The new ASDF output translations are incompatible with ASDF-Binary-Locations.
They replace A-B-L, and there is compatibility mode to emulate
your previous A-B-L configuration.
See <code class="code">enable-asdf-binary-locations-compatibility</code> in
see <a class="pxref" href="#Controlling-where-ASDF-saves-compiled-files">Backward Compatibility</a>.
But thou shalt not load ABL on top of ASDF 2.

</li></ul>

<p>Other issues include the following:
</p>
<ul class="itemize mark-bullet">
<li>ASDF pathname designators are now specified
in places where they were unspecified,
and a few small adjustments have to be made to some non-portable defsystems.
Notably, in the <code class="code">:pathname</code> argument
to a <code class="code">defsystem</code> and its components,
a logical pathname (or implementation-dependent hierarchical pathname)
must now be specified with <code class="code">#p</code> syntax
where the namestring might have previously sufficed;
moreover when evaluation is desired <code class="code">#.</code> must be used,
where it wasn&rsquo;t necessary in the toplevel <code class="code">:pathname</code> argument
(but necessary in other <code class="code">:pathname</code> arguments).

</li><li>There is a slight performance bug, notably on SBCL,
when initially searching for <samp class="file">asd</samp> files,
the implicit <code class="code">(directory &quot;/configured/path/**/*.asd&quot;)</code>
for every configured path <code class="code">(:tree &quot;/configured/path/&quot;)</code>
in your <code class="code">source-registry</code> configuration can cause a slight pause.
Try to <code class="code">(time (asdf:initialize-source-registry))</code>
to see how bad it is or isn&rsquo;t on your system.
If you insist on not having this pause,
you can avoid the pause by overriding the default source-registry configuration
and not use any deep <code class="code">:tree</code> entry but only <code class="code">:directory</code> entries
or shallow <code class="code">:tree</code> entries.
Or you can fix your implementation to not be quite that slow
when recursing through directories.
<em class="emph">Update</em>: This performance bug fixed the hard way in 2.010.

</li><li>On Windows, only LispWorks supports proper default configuration pathnames
based on the Windows registry.
Other implementations make do with environment variables,
that you may have to define yourself
if you&rsquo;re using an older version of Windows.
Windows support is somewhat less tested than Unix support.
Please help report and fix bugs.
<em class="emph">Update</em>: As of ASDF 2.21, all implementations
should now use the same proper default configuration pathnames
and they should actually work, though they haven&rsquo;t all been tested.

</li><li>The mechanism by which one customizes a system so that Lisp files
may use a different extension from the default <samp class="file">.lisp</samp> has changed.
Previously, the pathname for a component
was lazily computed when operating on a system,
and you would
<code class="code">(defmethod source-file-type ((component cl-source-file) (system (eql (find-system 'foo))))
  (declare (ignorable component system)) &quot;lis&quot;)</code>.
Now, the pathname for a component is eagerly computed when defining the system,
and instead you will <code class="code">(defclass cl-source-file.lis (cl-source-file) ((type :initform &quot;lis&quot;)))</code>
and use <code class="code">:default-component-class cl-source-file.lis</code>
as argument to <code class="code">defsystem</code>,
as detailed in a see <a class="pxref" href="#FAQ">How do I create a system definition where all the source files have a .cl extension?</a> below.
<code class="code">source-file-type</code> is deprecated.  To access a component&rsquo;s
file-type, use <code class="code">file-type</code>, instead.  <code class="code">source-file-type</code> will
be removed.

<a class="index-entry-id" id="index-source_002dfile_002dtype"></a>
<a class="index-entry-id" id="index-file_002dtype"></a>

</li></ul>


<hr>
</div>
<div class="subsection-level-extent" id="Pitfalls-of-the-upgrade-to-ASDF-3">
<h4 class="subsection" id="Pitfalls-of-the-upgrade-to-ASDF-3-1">13.3.12 Pitfalls of the upgrade to ASDF 3</h4>

<p>While ASDF 3 is largely compatible with ASDF 2,
there are a few pitfalls when upgrading from ASDF 2,
due to limitations in ASDF 2.
</p>
<ul class="itemize mark-bullet">
<li>ASDF 2 was designed so it could be upgraded;
but upgrading it required a special setup at the beginning of your build files.
Failure to upgrade it early could result in catastrophic attempt to self-upgrade in mid-build.

</li><li>Starting with ASDF 3 (2.27 or later),
ASDF will automatically attempt to upgrade itself
as the first step before any system operation,
to avoid any possibility of such catastrophic mid-build self-upgrade.
But that doesn&rsquo;t help if your old implementation still provides ASDF 2.

</li><li>It was unsafe in ASDF 2 for a system definition to declare a dependency on ASDF,
since it could trigger such catastrophe for users who were not carefully configured.
If you declare a dependency on a recent enough ASDF,
yet want to be nice with these potentially misconfigured users,
we recommend that you not only specify a recent ASDF in your dependencies with
<code class="code">:depends-on ((:version &quot;asdf&quot; &quot;3.1.2&quot;))</code>,
but that you <em class="emph">also</em> check that ASDF 3 is installed,
or else the upgrade catastrophe might happen before that specification is checked,
by starting your <samp class="file">.asd</samp> file with a version check as follows:
<div class="example">
<pre class="example-preformatted">#-asdf3 (error &quot;<var class="var">MY-SYSTEM</var> requires ASDF 3.1.2&quot;)
</pre></div>

</li><li>When you upgrade from too old a version of ASDF,
previously loaded ASDF extensions become invalid, and will need to be reloaded.
Example extensions include CFFI-Grovel, hacks used by ironclad, etc.
Since it isn&rsquo;t possible to automatically detect what extensions
need to be invalidated and what systems use them,
ASDF will invalidate <em class="emph">all</em> previously loaded systems
when it is loaded on top of a forward-incompatible ASDF version.
<a class="footnote" id="DOCF17" href="#FOOT17"><sup>17</sup></a>

</li><li>To write a portable build script, you need to rely on a recent version of UIOP,
but until you have ensured a recent ASDF is loaded,
you can&rsquo;t rely on UIOP being present,
and thus must manually avoid all the pathname pitfalls when loading ASDF itself.

</li><li>Bugs in CMUCL and XCL prevent upgrade of ASDF from an old forward-incompatible version.
Happily, CMUCL comes with a recent ASDF,
and XCL is more of a working demo than something you&rsquo;d use seriously anyway.

</li><li>For the above reasons, your build and startup scripts
should load ASDF 3, configure it, and upgrade it,
among the very first things they do.
They should ensure that only ASDF 3 or later is used indeed,
and error out if ASDF 2 or earlier was used.

</li><li>Now that (since May 2016) all maintained implementations
(i.e. having had at least one release since 2014,
or a commit on their public source code repository)
provide ASDF 3.1 or later,
the simple solution is just to use code as below in your setup,
and when it fails, upgrade your implementation or replace its ASDF.
(see <a class="pxref" href="#Replacing-your-implementation_0027s-ASDF">Replacing your implementation&rsquo;s ASDF</a>):
<div class="example">
<pre class="example-preformatted">(require &quot;asdf&quot;)
#-asdf3.1 (error &quot;ASDF 3.1 or bust&quot;)
</pre></div>

</li><li>For scripts that try to use ASDF simply via <code class="code">require</code> at first, and
make heroic attempts to load it the hard way if at first they don&rsquo;t succeed,
see <samp class="file">tools/load-asdf.lisp</samp> distributed with the ASDF source repository,
or the code of <a class="url" href="https://cliki.net/cl-launch"><code class="code">cl-launch</code></a>.

</li><li><a class="anchor" id="reinitializeASDFAfterUpgrade"></a>Note that in addition to the pitfalls and constraints above,
these heroic scripts (should you wish to write or modify one),
must take care to configure ASDF <em class="emph">twice</em>.
A first time, right after you load the old ASDF 2 (or 1!)
and before you upgrade to the new ASDF 3,
so it may find where you put ASDF 3.
A second time, because most implementations can&rsquo;t handle a smooth upgrade from ASDF 2 to ASDF 3,
so ASDF 3 doesn&rsquo;t try (anymore) and loses any configuration from ASDF 2.
<div class="example lisp">
<pre class="lisp-preformatted">(ignore-errors (funcall 'require &quot;asdf&quot;)) ;; &lt;--- try real hard
;; &lt;--- insert heroics here, if that failed to provide ASDF 2 or 3
;; &lt;--- insert configuration here, if that succeeded
(asdf:load-system &quot;asdf&quot;)
;; &lt;--- re-configure here, too, in case at first you got ASDF 2
</pre></div>

</li></ul>


<hr>
</div>
<div class="subsection-level-extent" id="What-happened-to-the-bundle-operations">
<h4 class="subsection" id="What-happened-to-the-bundle-operations_003f">13.3.13 What happened to the bundle operations?</h4>

<a class="index-entry-id" id="index-fasl_002dop-_0028obsolete_0029"></a>
<a class="index-entry-id" id="index-load_002dfasl_002dop-_0028obsolete_0029"></a>
<a class="index-entry-id" id="index-binary_002dop-_0028obsolete_0029"></a>
<a class="index-entry-id" id="index-monolithic_002dfasl_002dop-_0028obsolete_0029"></a>
<a class="index-entry-id" id="index-monolithic_002dload_002dfasl_002dop-_0028obsolete_0029"></a>
<a class="index-entry-id" id="index-monolithic_002dbinary_002dop-_0028obsolete_0029"></a>
<a class="index-entry-id" id="index-compile_002dbundle_002dop-1"></a>
<a class="index-entry-id" id="index-load_002dbundle_002dop-1"></a>
<a class="index-entry-id" id="index-deliver_002dasd_002dop-1"></a>
<a class="index-entry-id" id="index-monolithic_002dcompile_002dbundle_002dop-1"></a>
<a class="index-entry-id" id="index-monolithic_002dload_002dbundle_002dop-1"></a>
<a class="index-entry-id" id="index-monolithic_002ddeliver_002dasd_002dop-1"></a>
<a class="index-entry-id" id="index-bundle-operations-1"></a>
<a class="index-entry-id" id="index-program_002dop-1"></a>

<p><code class="code">asdf-ecl</code> and its short-lived successor <code class="code">asdf-bundle</code> are no more,
having been replaced by code now built into ASDF 3.
Moreover, the name of the bundle operations has changed since ASDF 3.1.3.
Starting with ASDF 3.2.0, <code class="code">load-system</code>
will once again use <code class="code">load-bundle-op</code> instead of <code class="code">load-op</code> on ECL,
as originally intended by <code class="code">asdf-ecl</code> authors, but disabled for a long time
due to bugs in both ECL and ASDF.
</p>
<p>Note that some of the bundle operations were renamed after ASDF 3.1.3,
and the old names have been removed.
Old bundle operations, and their modern equivalents are:
</p>
<ul class="itemize mark-bullet">
<li><code class="code">fasl-op</code> is now <code class="code">compile-bundle-op</code>
</li><li><code class="code">load-fasl-op</code> is now <code class="code">load-bundle-op</code>
</li><li><code class="code">binary-op</code> is now <code class="code">deliver-asd-op</code>
</li><li><code class="code">monolithic-fasl-op</code> is now <code class="code">monolithic-compile-bundle-op</code>
</li><li><code class="code">monolithic-load-fasl-op</code> is now <code class="code">monolithic-load-bundle-op</code>
</li><li><code class="code">monolithic-binary-op</code> is now <code class="code">monolithic-deliver-asd-op</code>
</li></ul>



<hr>
</div>
</div>
<div class="section-level-extent" id="Issues-with-installing-the-proper-version-of-ASDF">
<h3 class="section" id="Issues-with-installing-the-proper-version-of-ASDF-1">13.4 Issues with installing the proper version of ASDF</h3>


<hr>
<div class="subsection-level-extent" id="My-Common-Lisp-implementation-comes-with-an-outdated-version-of-ASDF_002e-What-to-do_003f">
<h4 class="subsection" id="g_t_0060_0060My-Common-Lisp-implementation-comes-with-an-outdated-version-of-ASDF_002e-What-to-do_003f_0027_0027">13.4.1 &ldquo;My Common Lisp implementation comes with an outdated version of ASDF. What to do?&rdquo;</h4>

<p>If you have a recent implementation, it should already come with ASDF 3 or later.
If you need a more recent version than is provided,
we recommend you simply upgrade ASDF by installing a recent version
in a path configured in your source-registry.
See <a class="xref" href="#Upgrading-ASDF">Upgrading ASDF</a>.
</p>
<p>If you have an old implementation that does not provide ASDF 3,
we recommend you replace your implementation&rsquo;s ASDF.
See <a class="xref" href="#Replacing-your-implementation_0027s-ASDF">Replacing your implementation&rsquo;s ASDF</a>.
</p>

<hr>
</div>
<div class="subsection-level-extent" id="I_0027m-a-Common-Lisp-implementation-vendor_002e-When-and-how-should-I-upgrade-ASDF_003f">
<h4 class="subsection" id="g_t_0060_0060I_0027m-a-Common-Lisp-implementation-vendor_002e-When-and-how-should-I-upgrade-ASDF_003f_0027_0027">13.4.2 &ldquo;I&rsquo;m a Common Lisp implementation vendor. When and how should I upgrade ASDF?&rdquo;</h4>

<p>Since ASDF 2,
it should always be a good time to upgrade to a recent version of ASDF.
You may consult with the maintainer for which specific version they recommend,
but the latest <code class="code">release</code> should be correct.
Though we do try to test ASDF releases against all implementations that we can,
we may not be testing against all variants of your implementation,
and we may not be running enough tests;
we trust you to thoroughly test it with your own implementation
before you release it.
If there are any issues with the current release,
it&rsquo;s a bug that you should report upstream and that we will fix ASAP.
</p>
<p>As to how to include ASDF, we recommend the following:
</p>
<ul class="itemize mark-bullet">
<li>If ASDF isn&rsquo;t loaded yet, then <code class="code">(require &quot;asdf&quot;)</code>
should load the version of ASDF that is bundled with your system.
If possible so should <code class="code">(require &quot;ASDF&quot;)</code>.
You may have it load some other version configured by the user,
if you allow such configuration.

</li><li>If your system provides a mechanism to hook into <code class="code">cl:require</code>,
then it would be nice to add ASDF to this hook the same way that
ABCL, CCL, CLISP, CMUCL, ECL, SBCL and SCL do it.
Please send us appropriate code to this end.

</li><li>You may, like SBCL since 1.1.13 or MKCL since 1.1.9,
have ASDF create bundle FASLs
that are provided as modules by your Lisp distribution.
You may also, but we don&rsquo;t recommend that anymore,
as in SBCL up until 1.1.12, have ASDF be implicitly used
to <code class="code">cl:require</code> these modules that are provided by your Lisp distribution;
if you do, you should add these modules in the beginning of both
<code class="code">wrapping-source-registry</code> and <code class="code">wrapping-output-translations</code>.

</li><li>If you have magic systems as above, like SBCL used to do,
then we explicitly ask you to <em class="emph">NOT</em> distribute
<samp class="file">asdf.asd</samp> as part of those magic systems.
You should still include the file <samp class="file">asdf.lisp</samp> in your source distribution
and precompile it in your binary distribution,
but <samp class="file">asdf.asd</samp> if included at all,
should be secluded from the magic systems,
in a separate file hierarchy.
Alternatively, you may provide the system
after renaming it and its <samp class="file">.asd</samp> file to e.g.
<code class="code">asdf-ecl</code> and <samp class="file">asdf-ecl.asd</samp>, or
<code class="code">sb-asdf</code> and <samp class="file">sb-asdf.asd</samp>.
Indeed, if you made <samp class="file">asdf.asd</samp> a magic system,
then users would no longer be able to upgrade ASDF using ASDF itself
to some version of their preference that
they maintain independently from your Lisp distribution.

</li><li>If you do not have any such magic systems, or have other non-magic systems
that you want to bundle with your implementation,
then you may add them to the <code class="code">wrapping-source-registry</code>,
and you are welcome to include <samp class="file">asdf.asd</samp> amongst them.
Non-magic systems should be at the back of the <code class="code">wrapping-source-registry</code>
while magic systems are at the front.
If they are precompiled,
they should also be in the <code class="code">wrapping-output-translations</code>.

</li><li>Since ASDF 3, the library UIOP comes transcluded in ASDF.
But if you want to be nice to users who care for UIOP but not for ASDF,
you may package UIOP separately,
so that one may <code class="code">(require &quot;uiop&quot;)</code> and not load ASDF,
or one may <code class="code">(require &quot;asdf&quot;)</code>
which would implicitly require and load the former.

</li><li>Please send us upstream any patches you make to ASDF itself,
so we can merge them back in for the benefit of your users
when they upgrade to the upstream version.

</li></ul>

<hr>
</div>
<div class="subsection-level-extent" id="After-upgrading-ASDF">
<h4 class="subsection" id="After-upgrading-ASDF_002c-ASDF-_0028and-Quicklisp_0029-can_0027t-find-my-systems">13.4.3 After upgrading ASDF, ASDF (and Quicklisp) can&rsquo;t find my systems</h4>
<a class="index-entry-id" id="index-_002acentral_002dregistry_002a"></a>
<a class="index-entry-id" id="index-Quicklisp"></a>

<p>When you upgrade the ASDF running in your Lisp image
from an ancient ASDF 2 or older to ASDF 3 or newer,
then you may have to re-configure ASDF.
If your configuration only consists in
using the source-registry and output-translations (as it should),
and if you are not explicitly calling <code class="code">asdf:initialize-source-registry</code>
or <code class="code">asdf:initialize-output-translations</code> with a non-nil argument,
then ASDF will reconfigure itself.
Otherwise, you will have to configure ASDF 2 (or older) to find ASDF 3,
then configure ASDF 3.
Notably, <var class="var">*central-registry*</var> is not maintained across upgrades from ASDF 2.
See <a class="xref" href="#reinitializeASDFAfterUpgrade">note about ASDF reconfiguration after upgrade</a>.
</p>
<p>Problems like this may be experienced if one loads Quicklisp
(which as of this writing bundles an obsolete ASDF version 2.26),
upgrades ASDF, and then tries to load new systems.
The correct solution is to load the most up-to-date ASDF you can,
<em class="emph">then</em> configure it, <em class="emph">then</em> load Quicklisp and any other extension.
Do <em class="emph">not</em> try to upgrade from ASDF 2 <em class="emph">after</em> loading Quicklisp,
for it will leave both ASDF and Quicklisp badly misconfigured.
For details see the discussion at the above cross-reference.
</p>
<p>Also, if you are experiencing such failures due to Quicklisp shipping an ancient ASDF,
please complain to Zach Beane about it.
</p>

<hr>
</div>
</div>
<div class="section-level-extent" id="Issues-with-configuring-ASDF">
<h3 class="section" id="Issues-with-configuring-ASDF-1">13.5 Issues with configuring ASDF</h3>


<hr>
<div class="subsection-level-extent" id="How-can-I-customize-where-fasl-files-are-stored_003f">
<h4 class="subsection" id="g_t_0060_0060How-can-I-customize-where-fasl-files-are-stored_003f_0027_0027">13.5.1 &ldquo;How can I customize where fasl files are stored?&rdquo;</h4>

<p>See <a class="xref" href="#Controlling-where-ASDF-saves-compiled-files">Controlling where ASDF saves compiled files</a>.
</p>
<p>Note that in the past there was an add-on to ASDF called
<code class="code">ASDF-binary-locations</code>, developed by Gary King.
That add-on has been merged into ASDF proper,
then superseded by the <code class="code">asdf-output-translations</code> facility.
</p>
<p>Note that use of <code class="code">asdf-output-translations</code>
can interfere with one aspect of your systems
&mdash; if your system uses <code class="code">*load-truename*</code> to find files
(e.g., if you have some data files stored with your program),
then the relocation that this ASDF customization performs
is likely to interfere.
Use <code class="code">asdf:system-relative-pathname</code> to locate a file
in the source directory of some system, and
use <code class="code">asdf:apply-output-translations</code> to locate a file
whose pathname has been translated by the facility.
</p>
<hr>
</div>
<div class="subsection-level-extent" id="How-can-I-wholly-disable-the-compiler-output-cache_003f">
<h4 class="subsection" id="g_t_0060_0060How-can-I-wholly-disable-the-compiler-output-cache_003f_0027_0027">13.5.2 &ldquo;How can I wholly disable the compiler output cache?&rdquo;</h4>

<p>To permanently disable the compiler output cache
for all future runs of ASDF, you can:
</p>
<div class="example">
<pre class="example-preformatted">mkdir -p ~/.config/common-lisp/asdf-output-translations.conf.d/
echo ':disable-cache' &gt; \
~/.config/common-lisp/asdf-output-translations.conf.d/99-disable-cache.conf
</pre></div>

<p>This assumes that you didn&rsquo;t otherwise configure the ASDF files
(if you did, edit them again),
and don&rsquo;t somehow override the configuration at runtime
with a shell variable (see below) or some other runtime command
(e.g. some call to <code class="code">asdf:initialize-output-translations</code>).
</p>
<p>To disable the compiler output cache in Lisp processes
run by your current shell, try (assuming <code class="code">bash</code> or <code class="code">zsh</code>)
(on Unix and cygwin only):
</p>
<div class="example">
<pre class="example-preformatted">export ASDF_OUTPUT_TRANSLATIONS=/:
</pre></div>

<p>To disable the compiler output cache just in the current Lisp process,
use (after loading ASDF but before using it):
</p>
<div class="example">
<pre class="example-preformatted">(asdf:disable-output-translations)
</pre></div>

<p>Note that this does <em class="emph">NOT</em> belong in a <samp class="file">.asd</samp> file.
Please do not tamper with ASDF configuration from a <samp class="file">.asd</samp> file,
and only do this from your personal configuration or build scripts.
</p>
<hr>
</div>
<div class="subsection-level-extent" id="How-can-I-debug-problems-finding-ASDF-systems">
<h4 class="subsection" id="How-can-I-debug-problems-finding-ASDF-systems_003f">13.5.3 How can I debug problems finding ASDF systems?</h4>

<p>Sometimes ASDF will be unable to find and load your systems, although
you believe that it should be able to.  There are a number of things you
can do to debug such issues.
</p>
<a class="index-entry-id" id="index-_002acentral_002dregistry_002a-1"></a>
<p>If you are using <code class="code">asdf:*central-registry*</code> (see <a class="pxref" href="#Configuring-ASDF-to-find-your-systems-_002d_002d_002d-old-style">Configuring ASDF to find your systems &mdash; old style</a>),
you can
simply look at the pathnames and namestrings in this variable, and use
conventional tools such as <code class="code">cl:probe-file</code> and <code class="code">cl:directory</code>
to poke around and see why your systems are not being found.
</p>
<p>If you are using one of the newer methods for configuring ASDF&rsquo;s system
finding (see <a class="pxref" href="#Controlling-where-ASDF-searches-for-systems">Controlling where ASDF searches for systems</a>), you can try:
</p>
<a class="index-entry-id" id="index-_002asource_002dregistry_002a"></a>
<div class="example">
<pre class="example-preformatted">(alexandria:hash-table-alist asdf/source-registry::*source-registry*)
</pre></div>

<p>(alphabetizing the results here may be helpful). Or for a higher-level
view:
</p>
<a class="index-entry-id" id="index-flatten_002dsource_002dregistry"></a>
<div class="example">
<pre class="example-preformatted">(asdf/source-registry:flatten-source-registry)
</pre></div>

<p>Finally, if you use the source registry cache (see <a class="pxref" href="#Caching-Results">Caching Results</a>), you can:
</p><div class="example">
<pre class="example-preformatted">find ~/common-lisp -name .cl-source-registry.cache
</pre></div>
<p>at the shell.
</p>
<p>It is still, unfortunately, an open question how to monitor ASDF&rsquo;s
interpretation of its source configuration as it happens.
</p>

<hr>
</div>
</div>
<div class="section-level-extent" id="Issues-with-using-and-extending-ASDF-to-define-systems">
<h3 class="section" id="Issues-with-using-and-extending-ASDF-to-define-systems-1">13.6 Issues with using and extending ASDF to define systems</h3>


<hr>
<div class="subsection-level-extent" id="How-can-I-cater-for-unit_002dtesting-in-my-system_003f">
<h4 class="subsection" id="g_t_0060_0060How-can-I-cater-for-unit_002dtesting-in-my-system_003f_0027_0027">13.6.1 &ldquo;How can I cater for unit-testing in my system?&rdquo;</h4>

<p>ASDF provides a predefined test operation, <code class="code">test-op</code>.
See <a class="xref" href="#Predefined-operations-of-ASDF">test-op</a>.
The test operation, however, is largely left to the system definer to specify.
<code class="code">test-op</code> has been
a topic of considerable discussion on the
<a class="url" href="http://common-lisp.net/cgi-bin/mailman/listinfo/asdf-devel">asdf-devel mailing list</a>
(see <a class="pxref" href="#Mailing-list">Mailing list</a>),
and on the
<a class="url" href="https://launchpad.net/asdf">launchpad bug-tracker</a> (see <a class="pxref" href="#Where-do-I-report-a-bug_003f">&ldquo;Where do I report a bug?&rdquo;</a>).
We provide some guidelines in the discussion of <code class="code">test-op</code>.
</p>







<hr>
</div>
<div class="subsection-level-extent" id="How-can-I-cater-for-documentation-generation-in-my-system_003f">
<h4 class="subsection" id="g_t_0060_0060How-can-I-cater-for-documentation-generation-in-my-system_003f_0027_0027">13.6.2 &ldquo;How can I cater for documentation generation in my system?&rdquo;</h4>

<p>Various ASDF extensions provide some kind of <code class="code">doc-op</code> operation.
See also <a class="url" href="https://bugs.launchpad.net/asdf/+bug/479470">https://bugs.launchpad.net/asdf/+bug/479470</a>.
</p>

<hr>
</div>
<div class="subsection-level-extent" id="How-can-I-maintain-non_002dLisp-_0028e_002eg_002e-C_0029-source-files_003f">
<h4 class="subsection" id="g_t_0060_0060How-can-I-maintain-non_002dLisp-_0028e_002eg_002e-C_0029-source-files_003f_0027_0027">13.6.3 &ldquo;How can I maintain non-Lisp (e.g. C) source files?&rdquo;</h4>

<p>See <code class="code">cffi</code>&rsquo;s <code class="code">cffi-grovel</code>.
</p>
<a class="anchor" id="report_002dbugs"></a>

<hr>
</div>
<div class="subsection-level-extent" id="I-want-to-put-my-module_0027s-files-at-the-top-level_002e-How-do-I-do-this_003f">
<h4 class="subsection" id="g_t_0060_0060I-want-to-put-my-module_0027s-files-at-the-top-level_002e-How-do-I-do-this_003f_0027_0027">13.6.4 &ldquo;I want to put my module&rsquo;s files at the top level.  How do I do this?&rdquo;</h4>

<p>By default, the files contained in an asdf module go
in a subdirectory with the same name as the module.
However, this can be overridden by adding a <code class="code">:pathname &quot;&quot;</code> argument
to the module description.
For example, here is how it could be done
in the spatial-trees ASDF system definition for ASDF 2 or later:
</p>
<div class="example">
<pre class="example-preformatted">(asdf:defsystem &quot;spatial-trees&quot;
  :components
  ((:module &quot;base&quot;
            :pathname &quot;&quot;
            :components
            ((:file &quot;package&quot;)
             (:file &quot;basedefs&quot; :depends-on (&quot;package&quot;))
             (:file &quot;rectangles&quot; :depends-on (&quot;package&quot;))))
   (:module tree-impls
            :depends-on (&quot;base&quot;)
            :pathname &quot;&quot;
            :components
            ((:file &quot;r-trees&quot;)
             (:file &quot;greene-trees&quot; :depends-on (&quot;r-trees&quot;))
             (:file &quot;rstar-trees&quot; :depends-on (&quot;r-trees&quot;))
             (:file &quot;rplus-trees&quot; :depends-on (&quot;r-trees&quot;))
             (:file &quot;x-trees&quot; :depends-on (&quot;r-trees&quot; &quot;rstar-trees&quot;))))
   (:module viz
            :depends-on (&quot;base&quot;)
            :pathname &quot;&quot;
            :components
            ((:static-file &quot;spatial-tree-viz.lisp&quot;)))
   (:module tests
            :depends-on (&quot;base&quot;)
            :pathname &quot;&quot;
            :components
            ((:static-file &quot;spatial-tree-test.lisp&quot;)))
   (:static-file &quot;LICENCE&quot;)
   (:static-file &quot;TODO&quot;)))
</pre></div>

<p>All of the files in the <code class="code">tree-impls</code> module are at the top level,
instead of in a <samp class="file">tree-impls/</samp> subdirectory.
</p>
<p>Note that the argument to <code class="code">:pathname</code> can be either a pathname object or a string.
A pathname object can be constructed with the <samp class="file">#p&quot;foo/bar/&quot;</samp> syntax,
but this is discouraged because the results of parsing a namestring are not portable.
A pathname can only be portably constructed with such syntax as
<code class="code">#.(make-pathname :directory '(:relative &quot;foo&quot; &quot;bar&quot;))</code>,
and similarly the current directory can only be portably specified as
<code class="code">#.(make-pathname :directory '(:relative))</code>.
However, as of ASDF 2, you can portably use a string to denote a pathname.
The string will be parsed as a <code class="code">/</code>-separated path from the current directory,
such that the empty string <code class="code">&quot;&quot;</code> denotes the current directory, and
<code class="code">&quot;foo/bar&quot;</code> (no trailing <code class="code">/</code> required in the case of modules)
portably denotes the same subdirectory as above.
When files are specified, the last <code class="code">/</code>-separated component is interpreted
either as the name component of a pathname
(if the component class specifies a pathname type),
or as a name component plus optional dot-separated type component
(if the component class doesn&rsquo;t specifies a pathname type).
</p>
<hr>
</div>
<div class="subsection-level-extent" id="How-do-I-create-a-system-definition-where-all-the-source-files-have-a-_002ecl-extension_003f">
<h4 class="subsection" id="How-do-I-create-a-system-definition-where-all-the-source-files-have-a-_002ecl-extension_003f-1">13.6.5 How do I create a system definition where all the source files have a .cl extension?</h4>

<p>Starting with ASDF 2.014.14, you may just pass
the builtin class <code class="code">cl-source-file.cl</code> as
the <code class="code">:default-component-class</code> argument to <code class="code">defsystem</code>:
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(defsystem my-cl-system
  :default-component-class cl-source-file.cl
  ...)
</pre></div>

<p>Another builtin class <code class="code">cl-source-file.lsp</code> is offered
for files ending in <samp class="file">.lsp</samp>.
</p>
<p>If you want to use a different extension
for which ASDF doesn&rsquo;t provide builtin support,
or want to support versions of ASDF
earlier than 2.014.14 (but later than 2.000),
you can define a class as follows:
</p>
<div class="example lisp">
<pre class="lisp-preformatted">;; Prologue: make sure we're using a sane package.
(defpackage :my-asdf-extension
   (:use :asdf :common-lisp)
   (:export #:cl-source-file.lis))
(in-package :my-asdf-extension)

(defclass cl-source-file.lis (cl-source-file)
  ((type :initform &quot;lis&quot;)))
</pre></div>

<p>Then you can use it as follows:
</p><div class="example lisp">
<pre class="lisp-preformatted">(defsystem my-cl-system
  :default-component-class my-asdf-extension:cl-source-file.lis
  ...)
</pre></div>

<p>Of course, if you&rsquo;re in the same package, e.g. in the same file,
you won&rsquo;t need to use the package qualifier before <code class="code">cl-source-file.lis</code>.
Actually, if all you&rsquo;re doing is defining this class
and using it in the same file without other fancy definitions,
you might skip package complications:
</p>
<div class="example lisp">
<pre class="lisp-preformatted">(in-package :asdf)
(defclass cl-source-file.lis (cl-source-file)
   ((type :initform &quot;lis&quot;)))
(defsystem my-cl-system
  :default-component-class cl-source-file.lis
  ...)
</pre></div>

<hr>
</div>
<div class="subsection-level-extent" id="How-do-I-mark-a-source-file-to-be-loaded-only-and-not-compiled_003f">
<h4 class="subsection" id="How-do-I-mark-a-source-file-to-be-loaded-only-and-not-compiled_003f-1">13.6.6 How do I mark a source file to be loaded only and not compiled?</h4>

<p>There is no provision in ASDF for ensuring that
some components are always loaded as source, while others are always
compiled.
There is <code class="code">load-source-op</code> (see <a class="pxref" href="#Predefined-operations-of-ASDF">load-source-op</a>), but that is an operation to be applied to a
system as a whole, not to one or another specific source files.
While this idea often comes up in discussions,
it doesn&rsquo;t play well with either the linking model of ECL
or with various bundle operations.
In addition, the dependency model of ASDF would have to be modified incompatibly
to allow for such a trick.
</p>
<hr>
</div>
<div class="subsection-level-extent" id="How-do-I-work-with-readtables_003f">
<h4 class="subsection" id="How-do-I-work-with-readtables_003f-1">13.6.7 How do I work with readtables?</h4>

<a class="index-entry-id" id="index-readtables"></a>

<p>It is possible to configure the lisp syntax by modifying the currently-active readtable.
However, this same readtable is shared globally by all software being compiled by ASDF,
especially since <code class="code">load</code> and <code class="code">compile-file</code> both bind <var class="var">*readtable*</var>,
so that its value is the same across the build at the start of every file
(unless overridden by some <code class="code">perform :around</code> method),
even if a file locally binds it to a different readtable during the build.
</p>
<p>Therefore, the following hygiene restrictions apply. If you don&rsquo;t abide by these restrictions,
there will be situations where your output files will be corrupted during an incremental build.
We are not trying to prescribe new restrictions for the sake of good style:
these restrictions have always applied implicitly, and
we are simply describing what they have always been.
</p>
<ul class="itemize mark-bullet">
<li>It is forbidden to modifying any standard character or standard macro dispatch defined in the CLHS.
</li><li>No two dependencies may assign different meanings to the same non-standard character.
</li><li>Using any non-standard character while expecting the implementation to treat some way
    counts as such an assignment of meaning.
</li><li>libraries need to document these assignments of meaning to non-standard characters.
</li><li>free software libraries will register these changes on:
        <a class="url" href="http://www.cliki.net/Macro%20Characters">http://www.cliki.net/Macro%20Characters</a>
</li></ul>

<p>If you want to use readtable modifications that cannot abide by those restrictions,
you <em class="emph">must</em> create a different readtable object and set <var class="var">*readtable*</var>
to temporarily bind it to your new readtable (which will be undone after processing the file).
</p>
<p>For that, we recommend you use system <code class="code">named-readtables</code>
to define or combine such readtables using <code class="code">named-readtables:defreadtable</code>
and use them using <code class="code">named-readtables:in-readtable</code>.
Equivalently, you can use system <code class="code">cl-syntax</code>,
that itself uses <code class="code">named-readtables</code>,
but may someday do more with, e.g. <var class="var">*print-pprint-dispatch*</var>.
</p>
<p>For even more advanced syntax modification beyond what a readtable can express,
you may consider either:
</p><ul class="itemize mark-bullet">
<li>a <code class="code">perform</code> method that compiles a constant file that contains a single form
  <code class="code">#.*code-read-with-alternate-reader*</code> in an environment where this special variable
  was bound to the code read by your alternate reader, or
</li><li>using the system <code class="code">reader-interception</code>.
</li></ul>

<p>Beware that it is unsafe to use ASDF from the REPL to compile or load systems
while the readtable isn&rsquo;t the shared readtable previously used to build software.
You <em class="emph">must</em> manually undo any binding of <var class="var">*readtable*</var> at the REPL
and restore its initial value whenever you call <code class="code">operate</code>
(via e.g. <code class="code">load-system</code>, <code class="code">test-system</code> or <code class="code">require</code>)
from a REPL that is using a different readtable.
</p>
<div class="subsubsection-level-extent" id="How-should-my-system-use-a-readtable-exported-by-another-system_003f">
<h4 class="subsubsection">13.6.7.1 How should my system use a readtable exported by another system?</h4>

<p>Use from the <code class="code">named-readtables</code> system the macro <code class="code">named-readtables:in-readtable</code>.
</p>
<p>If the other system fails to use <code class="code">named-readtables</code>, fix it and send a patch upstream.
In the day and age of Quicklisp and clbuild, there is little reason
to eschew using such an important library anymore.
</p>
</div>
<div class="subsubsection-level-extent" id="How-should-my-library-make-a-readtable-available-to-other-systems_003f">
<h4 class="subsubsection">13.6.7.2 How should my library make a readtable available to other systems?</h4>

<p>Use from the <code class="code">named-readtables</code> system the macro <code class="code">named-readtables:defreadtable</code>.
</p>
<hr>
</div>
</div>
<div class="subsection-level-extent" id="How-can-I-capture-ASDF_0027s-output_003f">
<h4 class="subsection" id="How-can-I-capture-ASDF_0027s-output_003f-1">13.6.8 How can I capture ASDF&rsquo;s output?</h4>

<a class="index-entry-id" id="index-ASDF-output"></a>
<a class="index-entry-id" id="index-Capturing-ASDF-output"></a>
<a class="index-entry-id" id="index-_002astandard_002doutput_002a"></a>

<p>Output from ASDF and ASDF extensions are sent to the CL stream
<code class="code">*standard-output*</code>, so rebinding that stream around calls to
<code class="code">asdf:operate</code> should redirect all output from ASDF operations.
</p>
<hr>
</div>
<div class="subsection-level-extent" id="LOAD_002dPATHNAME-has-a-weird-value">
<h4 class="subsection" id="g_t_002aLOAD_002dPATHNAME_002a-and-_002aLOAD_002dTRUENAME_002a-have-weird-values_002c-help_0021">13.6.9 *LOAD-PATHNAME* and *LOAD-TRUENAME* have weird values, help!</h4>
<a class="index-entry-id" id="index-_002aLOAD_002dPATHNAME_002a"></a>
<a class="index-entry-id" id="index-_002aLOAD_002dTRUENAME_002a"></a>

<p>Conventional Common Lisp code may use <code class="code">*LOAD-TRUENAME*</code> or <code class="code">*LOAD-PATHNAME*</code> to find
files adjacent to source files.  This will generally <em class="emph">not</em> work in
ASDF-loaded systems.  Recall that ASDF relocates the FASL files it
builds, typically to a special cache directory.  Thus the value of
<code class="code">*LOAD-PATHNAME*</code> and <code class="code">*LOAD-TRUENAME*</code>  at load time, when ASDF is loading your system,
will typically be a pathname in that cache directory, and useless to you
for finding other system components.
</p>
<p>There are two ways to work around this problem:
</p><ol class="enumerate">
<li> <a class="index-entry-id" id="index-system_002drelative_002dpathname-1"></a>
Use the <code class="code">system-relative-pathname</code> function.  This can readily be
used from outside the system, but it is probably not good software
engineering to require a source file <em class="emph">of</em> a system to know what
system it is going to be part of.  Contained objects should not have to
know their containers.
</li><li> Store the pathname at compile time, so that you get the pathname of the
source file, which is presumably what you want.  To do this, you can
capture the value of <code class="code">(or *compile-file-pathname* *load-truename*)</code>
(or <code class="code">*LOAD-PATHNAME*</code>, if you prefer)
in a macro expansion or other compile-time evaluated context.

</li></ol>

<hr>
</div>
<div class="subsection-level-extent" id="How-can-I-produce-a-binary-at-a-specific-path-from-sources-at-a-specific-path">
<h4 class="subsection" id="How-can-I-produce-a-binary-at-a-specific-path-from-sources-at-a-specific-path_003f">13.6.10 How can I produce a binary at a specific path from sources at a specific path?</h4>
<a class="index-entry-id" id="index-bundle-operations-2"></a>
<a class="index-entry-id" id="index-program_002dop-2"></a>

<p>Especially when integrating with outside build systems, it&rsquo;s useful to have
fine-grained control over where ASDF puts output files. The following is an
example of a build script that takes the directory to find the source and the
path to put the resulting binary at, and compiles a system there.
</p>
<div class="example">
<pre class="example-preformatted">(in-package :cl-user)

;; Tell ASDF where to find your source files. This may not
;; be necessary if you've already configured this elsewhere.
(asdf:initialize-source-registry
  `(:source-registry
     :inherit-configuration
     (:directory ,(uiop:getenv-absolute-directory &quot;SRC&quot;))))

;; Set the output pathname when building the system.
(defmethod asdf:output-files ((o asdf:image-op)
                              (system (eql (asdf:find-system <var class="var">foo</var>))))
  (declare (ignorable system))
  (values (list (uiop:getenv-pathname &quot;OUT&quot;)) t))

;; Build the system.
(asdf:operate-on-system 'asdf:program-op <var class="var">foo</var>)
(uiop:quit)
</pre></div>

<hr>
</div>
</div>
<div class="section-level-extent" id="ASDF-development-FAQs">
<h3 class="section" id="ASDF-development-FAQs-1">13.7 ASDF development FAQs</h3>


<hr>
<div class="subsection-level-extent" id="How-do-I-run-the-tests-interactively-in-a-REPL_003f">
<h4 class="subsection" id="How-do-I-run-the-tests-interactively-in-a-REPL_003f-1">13.7.1 How do I run the tests interactively in a REPL?</h4>

<p>This not-so-frequently asked question is primarily for ASDF developers,
but those who encounter an unexpected error in some test may be
interested, too.
</p>
<p>Here&rsquo;s the procedure for experimenting with tests in a REPL:
</p><div class="example">
<pre class="example-preformatted">;; BEWARE! Some tests expect you to be in the .../asdf/test directory
;; If your REPL is not there yet, change your current directory:
;; under SLIME, you may: ,change-directory ~/common-lisp/asdf/test/
;; otherwise you may evaluate something like:
(require &quot;asdf&quot;) (asdf:upgrade-asdf) ;load UIOP &amp; update asdf.lisp
(uiop:chdir (asdf:system-relative-pathname :asdf &quot;test/&quot;))
(setf *default-pathname-defaults* (uiop:getcwd))

;; Load the test script support.
(load &quot;script-support.lisp&quot;)

;; Initialize the script support for interaction.
;; This will also change your *package* to asdf-test
;; after frobbing the asdf-test package to make it usable.
;; NB: this function is also available from package cl-user,
;; and also available with the shorter name da in both packages.
(asdf-test:debug-asdf)

;; Now, you may experiment with test code from a .script file.
;; See the instructions given at the end of your failing test
;; to identify which form is needed, e.g.
(run-test-script &quot;test-utilities.script&quot;)
</pre></div>



<hr>
</div>
</div>
</div>
<div class="unnumbered-level-extent" id="Ongoing-Work">
<h2 class="unnumbered" id="Ongoing-Work-1">Ongoing Work</h2>
<p>For an active list of things to be done,
see the <samp class="file">TODO</samp> file in the source repository.
</p>
<p>Also, bugs are currently tracked on launchpad:
<a class="url" href="https://launchpad.net/asdf">https://launchpad.net/asdf</a>.
</p>
<hr>
</div>
<div class="unnumbered-level-extent" id="Bibliography">
<h2 class="unnumbered" id="Bibliography-1">Bibliography</h2>

<ul class="itemize mark-bullet">
<li>Andrey Mokhov, Neil Mitchell and Simon Peyton Jones:
  &ldquo;Build Systems à la Carte&rdquo;,
  International Conference on Functional Programming, 2018.
  <a class="url" href="https://www.microsoft.com/en-us/research/uploads/prod/2018/03/build-systems-final.pdf">https://www.microsoft.com/en-us/research/uploads/prod/2018/03/build-systems-final.pdf</a>
  This influential article provides axes along which to describe build systems in general;
  ASDF, in addition to being in-image (an axis not considered by these authors),
  has the following characteristics:
  ASDF&rsquo;s persistent build information is file modification times
  (the way ASDF is written, it should be easy enough to write an extension that modifies it
  to use a &ldquo;cloud cache&rdquo; à la Bazel,
  but that would involve using some database, network and cryptographic libraries,
  which cannot reasonably be included in the base ASDF,
  that must remain a minimal bootstrappable system with no external dependencies).
  The object model of ASDF was initially designed for &ldquo;static&rdquo; dependencies
  with a &ldquo;topological&rdquo; scheduler, but its <code class="code">defsystem-depends-on</code> mechanism
  (and more generally, the ability to call ASDF from within an <code class="code">.asd</code> file)
  allows for multiple <em class="emph">phases</em> of execution resulting
  in &ldquo;dynamic&rdquo; dependencies with a &ldquo;suspending&rdquo; scheduler.
  The rebuilder essentially uses a &ldquo;dirty bit&rdquo;, except that the in-image model
  and the multiple phase support mean that&rsquo;s actually more than a bit:
  instead it&rsquo;s three bits plus the timestamp plus a phase depth level.
  The build is guaranteed &ldquo;minimal&rdquo; in number of steps computed.
  It is local. It assumes but does not enforce determinism.
  It does not assume early cutoff of the build when rebuild dependencies didn&rsquo;t change.
</li><li>Robert Goldman, Elias Pipping, and François-René Rideau:
  &ldquo;Delivering Common Lisp Applications with ASDF 3.3&rdquo;,
  European Lisp Symposium, 2017.
  <a class="url" href="https://github.com/fare/asdf2017">https://github.com/fare/asdf2017</a>
  This short article gives an overview of the changes in ASDF 3.2 and 3.3, including
  improved application delivery, asynchronous subprocess management,
  correct support for multi-phase builds, and enhanced source location configuration.
</li><li>Francois-Rene Rideau:
  &ldquo;ASDF 3, or Why Lisp is Now an Acceptable Scripting Language&rdquo;,
  European Lisp Symposium, 2014.
  <a class="url" href="https://github.com/fare/asdf3-2013">https://github.com/fare/asdf3-2013</a>
  This article describes the innovations in ASDF 3 and 3.1,
  as well as historical information on previous versions.
</li><li>Alastair Bridgewater:
  &ldquo;Quick-build&rdquo; (private communication), 2012.
  <code class="code">quick-build</code> is a simple and robust one file, one package build system,
  similar to <code class="code">faslpath</code>, in 182 lines of code
  (117 of which are neither blank nor comments nor docstrings).
  Unhappily, it remains unpublished and its IP status is unclear as of April 2014.
  <code class="code">asdf/package-system</code> is mostly compatible with it,
  modulo a different setup for toplevel hierarchies.
</li><li>Zach Beane:
  &ldquo;Quicklisp&rdquo;, 2011.
  The Quicklisp blog and Xach&rsquo;s personal blogs contain information on Quicklisp.
  <a class="url" href="http://blog.quicklisp.org/">http://blog.quicklisp.org/</a>
  <a class="url" href="http://lispblog.xach.com/">http://lispblog.xach.com/</a> (new)
  <a class="url" href="http://xach.livejournal.com/">http://xach.livejournal.com/</a> (old)
</li><li>Francois-Rene Rideau and Robert Goldman:
  &ldquo;Evolving ASDF: More Cooperation, Less Coordination&rdquo;,
  International Lisp Conference, 2010.
  This article describes the main issues solved by ASDF 2,
  and exposes its design principles.
  <a class="url" href="https://common-lisp.net/project/asdf/ilc2010draft.pdf">https://common-lisp.net/project/asdf/ilc2010draft.pdf</a>
  <a class="url" href="http://rpgoldman.goldman-tribe.org/papers/ilc2010-asdf.pdf">http://rpgoldman.goldman-tribe.org/papers/ilc2010-asdf.pdf</a>
</li><li>Francois-Rene Rideau and Spencer Brody:
  &ldquo;XCVB: an eXtensible Component Verifier and Builder for Common Lisp&rdquo;,
  International Lisp Conference, 2009.
  This article describes XCVB, a proposed competitor for ASDF;
  many of its ideas have been incorporated into ASDF 2 and 3,
  though many other ideas still haven&rsquo;t.
  <a class="url" href="https://common-lisp.net/project/xcvb/">https://common-lisp.net/project/xcvb/</a>
</li><li>Peter von Etter:
  &ldquo;faslpath&rdquo;, 2009.
  <code class="code">faslpath</code> is similar to the latter <code class="code">quick-build</code>
  and our yet latter <code class="code">asdf/package-system</code> extension,
  except that it uses dot <code class="code">.</code> rather than slash <code class="code">/</code> as a separator.
  <a class="url" href="https://code.google.com/p/faslpath/">https://code.google.com/p/faslpath/</a>
</li><li>Drew McDermott:
  &ldquo;A Framework for Maintaining the Coherence of a Running Lisp,&rdquo;
  International Lisp Conference, 2005.
  <a class="url" href="http://www.cs.yale.edu/homes/dvm/papers/lisp05.pdf">http://www.cs.yale.edu/homes/dvm/papers/lisp05.pdf</a>
</li><li>Dan Barlow: &ldquo;ASDF Manual&rdquo;, 2004.
  Older versions of this document from the days of ASDF 1;
  they include ideas laid down by Dan Barlow,
  and comparisons with older defsystems (<code class="code">mk-defsystem</code>)
  and defsystem (<code class="code">defsystem-4</code>, kmp&rsquo;s Memo 801).
</li><li>Marco Antoniotti and Peter Van Eynde:
 &ldquo;<code class="code">DEFSYSTEM</code>: A <code class="code">make</code> for Common Lisp, A Thoughtful Re-Implementation of an Old Idea&rdquo;, 2002.
  The <samp class="file">defsystem-4</samp> proposal available in the CLOCC repository.
</li><li>Mark Kantrovitz:
  &ldquo;Defsystem: A Portable Make Facility for Common Lisp&rdquo;, 1990.
  The classic <samp class="file">mk-defsystem</samp>, later variants of which
  are available in the CLOCC repository as <code class="code">defsystem-3.x</code>.
</li><li>Richard Elliot Robbins:
  &ldquo;BUILD: A Tool for Maintaining Consistency in Modular Systems&rdquo;, MIT AI TR 874, 1985.
  <a class="url" href="http://www.dtic.mil/dtic/tr/fulltext/u2/a162744.pdf">http://www.dtic.mil/dtic/tr/fulltext/u2/a162744.pdf</a>
</li><li>Kent M. Pitman (kmp): &ldquo;The Description of Large Systems&rdquo;, MIT AI Memo 801, 1984.
  Available in updated-for-CL form on the web at
  <a class="url" href="http://nhplace.com/kent/Papers/Large-Systems.html">http://nhplace.com/kent/Papers/Large-Systems.html</a>
</li><li>Dan Weinreb and David Moon:
  &ldquo;Lisp Machine Manual&rdquo;, 3rd Edition MIT, March 1981.
  The famous CHINE NUAL describes one of the earliest variants of DEFSYSTEM.
  (NB: Not present in the second preliminary version of January 1979)
  <a class="url" href="http://bitsavers.org/pdf/mit/cadr/chinual_3rdEd_Mar81.pdf">http://bitsavers.org/pdf/mit/cadr/chinual_3rdEd_Mar81.pdf</a>
</li></ul>


<hr>
</div>
<div class="unnumbered-level-extent" id="Concept-Index">
<h2 class="unnumbered" id="Concept-Index-1">Concept Index</h2>

<div class="printindex cp-printindex">
<table class="cp-letters-header-printindex"><tr><th>Jump to: &nbsp; </th><td><a class="summary-letter-printindex" href="#Concept-Index_cp_symbol-1"><b>*</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_symbol-2"><b>:</b></a>
 &nbsp; 
<br>
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-A"><b>A</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-B"><b>B</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-D"><b>D</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-E"><b>E</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-G"><b>G</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-I"><b>I</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-M"><b>M</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-O"><b>O</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-Q"><b>Q</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-R"><b>R</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-T"><b>T</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-V"><b>V</b></a>
 &nbsp; 
</td></tr></table>
<table class="cp-entries-printindex" border="0">
<tr><td></td><th class="entries-header-printindex">Index Entry</th><td>&nbsp;</td><th class="sections-header-printindex"> Section</th></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Concept-Index_cp_symbol-1">*</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_002afeatures_002a">*features*</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#How-do-I-detect-the-ASDF-version_003f">How do I detect the ASDF version?</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Concept-Index_cp_symbol-2">:</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_003aalso_002dexclude-source-config-directive">:also-exclude source config directive</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Configuration-DSL">Configuration DSL</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_003aaround_002dcompile">:around-compile</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Controlling-file-compilation">Controlling file compilation</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_003aasdf">:asdf</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Introduction">Introduction</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_003aasdf2">:asdf2</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Introduction">Introduction</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_003aasdf3">:asdf3</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Introduction">Introduction</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_003abuild_002doperation">:build-operation</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-defsystem-grammar">The defsystem grammar</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_003acompile_002dcheck">:compile-check</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Controlling-file-compilation">Controlling file compilation</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_003adefault_002dregistry-source-config-directive">:default-registry source config directive</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Configuration-DSL">Configuration DSL</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_003adefsystem_002ddepends_002don">:defsystem-depends-on</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-defsystem-grammar">The defsystem grammar</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_003adirectory-source-config-directive">:directory source config directive</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Configuration-DSL">Configuration DSL</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_003aentry_002dpoint">:entry-point</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-defsystem-grammar">The defsystem grammar</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_003aexclude-source-config-directive">:exclude source config directive</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Configuration-DSL">Configuration DSL</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_003afeature-dependencies">:feature dependencies</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-defsystem-grammar">The defsystem grammar</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_003aif_002dfeature-component-option">:if-feature component option</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-defsystem-grammar">The defsystem grammar</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_003aignore_002dinvalid_002dentries-source-config-directive">:ignore-invalid-entries source config directive</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Configuration-DSL">Configuration DSL</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_003ainclude-source-config-directive">:include source config directive</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Configuration-DSL">Configuration DSL</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_003ainherit_002dconfiguration-source-config-directive">:inherit-configuration source config directive</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Configuration-DSL">Configuration DSL</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_003arequire-dependencies">:require dependencies</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-defsystem-grammar">The defsystem grammar</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_003atree-source-config-directive">:tree source config directive</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Configuration-DSL">Configuration DSL</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_003aversion">:version</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-defsystem-form">The defsystem form</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_003aversion-1">:version</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-defsystem-grammar">The defsystem grammar</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_003aversion-2">:version</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Common-attributes-of-components">Common attributes of components</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_003aweakly_002ddepends_002don">:weakly-depends-on</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-defsystem-grammar">The defsystem grammar</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Concept-Index_cp_letter-A">A</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-also_002dexclude-source-config-directive">also-exclude source config directive</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Configuration-DSL">Configuration DSL</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-around_002dcompile-keyword">around-compile keyword</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Controlling-file-compilation">Controlling file compilation</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-ASDF-output">ASDF output</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#How-can-I-capture-ASDF_0027s-output_003f">How can I capture ASDF's output?</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-ASDF-versions">ASDF versions</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Introduction">Introduction</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-ASDF_002dBINARY_002dLOCATIONS-compatibility">ASDF-BINARY-LOCATIONS compatibility</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Output-Backward-Compatibility">Output Backward Compatibility</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-asdf_002doutput_002dtranslations">asdf-output-translations</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Controlling-where-ASDF-saves-compiled-files">Controlling where ASDF saves compiled files</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-ASDF_002drelated-features">ASDF-related features</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Introduction">Introduction</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-asdf_002duser">asdf-user</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-defsystem-form">The defsystem form</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-ASDF_002dUSER-package">ASDF-USER package</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Components">Components</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Concept-Index_cp_letter-B">B</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-bug-tracker">bug tracker</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Where-do-I-report-a-bug_003f">Where do I report a bug?</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-build_002doperation">build-operation</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Convenience-Functions">Convenience Functions</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-bundle-operations">bundle operations</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-bundle-operations-1">bundle operations</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#What-happened-to-the-bundle-operations">What happened to the bundle operations</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-bundle-operations-2">bundle operations</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#How-can-I-produce-a-binary-at-a-specific-path-from-sources-at-a-specific-path">How can I produce a binary at a specific path from sources at a specific path</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Concept-Index_cp_letter-C">C</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-Capturing-ASDF-output">Capturing ASDF output</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#How-can-I-capture-ASDF_0027s-output_003f">How can I capture ASDF's output?</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-compile_002dcheck-keyword">compile-check keyword</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Controlling-file-compilation">Controlling file compilation</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-component">component</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Components">Components</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-component-designator">component designator</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Components">Components</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Concept-Index_cp_letter-D">D</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-default_002dregistry-source-config-directive">default-registry source config directive</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Configuration-DSL">Configuration DSL</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-DEFSYSTEM-grammar">DEFSYSTEM grammar</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-defsystem-grammar">The defsystem grammar</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-directory-source-config-directive">directory source config directive</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Configuration-DSL">Configuration DSL</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Concept-Index_cp_letter-E">E</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-exclude-source-config-directive">exclude source config directive</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Configuration-DSL">Configuration DSL</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-Extending-ASDF_0027s-defsystem-parser">Extending ASDF&rsquo;s defsystem parser</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Parsing-system-definitions">Parsing system definitions</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Concept-Index_cp_letter-G">G</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-gitlab">gitlab</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Where-do-I-report-a-bug_003f">Where do I report a bug?</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Concept-Index_cp_letter-I">I</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-ignore_002dinvalid_002dentries-source-config-directive">ignore-invalid-entries source config directive</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Configuration-DSL">Configuration DSL</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-immutable-systems">immutable systems</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Operations">Operations</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-immutable-systems-1">immutable systems</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Miscellaneous-Functions">Miscellaneous Functions</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-include-source-config-directive">include source config directive</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Configuration-DSL">Configuration DSL</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-inherit_002dconfiguration-source-config-directive">inherit-configuration source config directive</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Configuration-DSL">Configuration DSL</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Concept-Index_cp_letter-L">L</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-launchpad">launchpad</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Where-do-I-report-a-bug_003f">Where do I report a bug?</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-logical-pathnames">logical pathnames</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-defsystem-grammar">The defsystem grammar</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Concept-Index_cp_letter-M">M</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-mailing-list">mailing list</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Mailing-list">Mailing list</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Concept-Index_cp_letter-O">O</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-One-package-per-file-systems">One package per file systems</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-package_002dinferred_002dsystem-extension">The package-inferred-system extension</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-operation">operation</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Operations">Operations</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Concept-Index_cp_letter-P">P</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-Package-inferred-systems">Package inferred systems</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-package_002dinferred_002dsystem-extension">The package-inferred-system extension</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-Packages_002c-inferring-dependencies-from">Packages, inferring dependencies from</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-package_002dinferred_002dsystem-extension">The package-inferred-system extension</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-Parsing-system-definitions">Parsing system definitions</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Parsing-system-definitions">Parsing system definitions</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-pathname-specifiers">pathname specifiers</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-defsystem-grammar">The defsystem grammar</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-Primary-system-name">Primary system name</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Components">Components</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Concept-Index_cp_letter-Q">Q</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-Quicklisp">Quicklisp</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#After-upgrading-ASDF">After upgrading ASDF</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Concept-Index_cp_letter-R">R</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-readtables">readtables</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#How-do-I-work-with-readtables_003f">How do I work with readtables?</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Concept-Index_cp_letter-S">S</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-serial-dependencies">serial dependencies</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-defsystem-grammar">The defsystem grammar</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-system">system</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Components">Components</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-system-designator">system designator</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Components">Components</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-System-names">System names</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Components">Components</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Concept-Index_cp_letter-T">T</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-Testing-for-ASDF">Testing for ASDF</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Introduction">Introduction</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-tree-source-config-directive">tree source config directive</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Configuration-DSL">Configuration DSL</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Concept-Index_cp_letter-V">V</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-version-specifiers">version specifiers</a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-defsystem-grammar">The defsystem grammar</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
</table>
<table class="cp-letters-footer-printindex"><tr><th>Jump to: &nbsp; </th><td><a class="summary-letter-printindex" href="#Concept-Index_cp_symbol-1"><b>*</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_symbol-2"><b>:</b></a>
 &nbsp; 
<br>
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-A"><b>A</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-B"><b>B</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-D"><b>D</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-E"><b>E</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-G"><b>G</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-I"><b>I</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-M"><b>M</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-O"><b>O</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-Q"><b>Q</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-R"><b>R</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-T"><b>T</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Concept-Index_cp_letter-V"><b>V</b></a>
 &nbsp; 
</td></tr></table>
</div>

<hr>
</div>
<div class="unnumbered-level-extent" id="Function-and-Macro-Index">
<h2 class="unnumbered" id="Function-and-Macro-Index-1">Function and Macro Index</h2>

<div class="printindex fn-printindex">
<table class="fn-letters-header-printindex"><tr><th>Jump to: &nbsp; </th><td><a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-A"><b>A</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-D"><b>D</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-E"><b>E</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-F"><b>F</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-I"><b>I</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-M"><b>M</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-O"><b>O</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-R"><b>R</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-T"><b>T</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-U"><b>U</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-V"><b>V</b></a>
 &nbsp; 
</td></tr></table>
<table class="fn-entries-printindex" border="0">
<tr><td></td><th class="entries-header-printindex">Index Entry</th><td>&nbsp;</td><th class="sections-header-printindex"> Section</th></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Function-and-Macro-Index_fn_letter-A">A</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-already_002dloaded_002dsystems"><code>already-loaded-systems</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Convenience-Functions">Convenience Functions</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-apply_002doutput_002dtranslations"><code>apply-output-translations</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Output-location-API">Output location API</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-asdf_002dversion"><code>asdf-version</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#How-do-I-detect-the-ASDF-version_003f">How do I detect the ASDF version?</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Function-and-Macro-Index_fn_letter-C">C</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-class_002dfor_002dtype"><code>class-for-type</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Parsing-system-definitions">Parsing system definitions</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-clear_002dconfiguration"><code>clear-configuration</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Resetting-the-ASDF-configuration">Resetting the ASDF configuration</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-clear_002doutput_002dtranslations"><code>clear-output-translations</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Configuring-where-ASDF-stores-object-files">Configuring where ASDF stores object files</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-clear_002doutput_002dtranslations-1"><code>clear-output-translations</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Output-location-API">Output location API</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-clear_002dsource_002dregistry"><code>clear-source-registry</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Configuration-API">Configuration API</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-clear_002dsystem"><code>clear-system</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Miscellaneous-Functions">Miscellaneous Functions</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-coerce_002dname"><code>coerce-name</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Creating-new-operations">Creating new operations</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-coerce_002dname-1"><code>coerce-name</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Components">Components</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-coerce_002dname-2"><code>coerce-name</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Common-attributes-of-components">Common attributes of components</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-compile_002dfile_002a"><code>compile-file*</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Controlling-file-compilation">Controlling file compilation</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-compile_002dsystem"><code>compile-system</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Convenience-Functions">Convenience Functions</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-component_002ddepends_002don"><code>component-depends-on</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Creating-new-operations">Creating new operations</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-component_002dpathname"><code>component-pathname</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Common-attributes-of-components">Common attributes of components</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-compute_002dcomponent_002dchildren"><code>compute-component-children</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Parsing-system-definitions">Parsing system definitions</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Function-and-Macro-Index_fn_letter-D">D</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-define_002dpackage"><code>define-package</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-package_002dinferred_002dsystem-extension">The package-inferred-system extension</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-defsystem"><code>defsystem</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-defsystem-form">The defsystem form</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-defsystem-1"><code>defsystem</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#A-more-involved-example">A more involved example</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-defsystem-2"><code>defsystem</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-defsystem-grammar">The defsystem grammar</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-disable_002doutput_002dtranslations"><code>disable-output-translations</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Output-location-API">Output location API</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Function-and-Macro-Index_fn_letter-E">E</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-enable_002dasdf_002dbinary_002dlocations_002dcompatibility"><code>enable-asdf-binary-locations-compatibility</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Output-Backward-Compatibility">Output Backward Compatibility</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-ensure_002doutput_002dtranslations"><code>ensure-output-translations</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Output-location-API">Output location API</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-ensure_002dsource_002dregistry"><code>ensure-source-registry</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Configuration-API">Configuration API</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Function-and-Macro-Index_fn_letter-F">F</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-file_002dtype"><code>file-type</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Pitfalls-of-the-transition-to-ASDF-2">Pitfalls of the transition to ASDF 2</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-find_002dcomponent"><code>find-component</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Creating-new-operations">Creating new operations</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-find_002dcomponent-1"><code>find-component</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Components">Components</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-find_002dsystem"><code>find-system</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Components">Components</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-flatten_002dsource_002dregistry"><code>flatten-source-registry</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#How-can-I-debug-problems-finding-ASDF-systems">How can I debug problems finding ASDF systems</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Function-and-Macro-Index_fn_letter-I">I</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-initialize_002doutput_002dtranslations"><code>initialize-output-translations</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Output-location-API">Output location API</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-initialize_002dsource_002dregistry"><code>initialize-source-registry</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Configuration-API">Configuration API</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-input_002dfiles"><code>input-files</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Creating-new-operations">Creating new operations</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-input_002dfiles-1"><code>input-files</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Creating-new-operations">Creating new operations</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Function-and-Macro-Index_fn_letter-L">L</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-load_002dasd"><code>load-asd</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-defsystem-form">The defsystem form</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-load_002dsystem"><code>load-system</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Convenience-Functions">Convenience Functions</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-locate_002dsystem"><code>locate-system</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Components">Components</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Function-and-Macro-Index_fn_letter-M">M</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-make"><code>make</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Convenience-Functions">Convenience Functions</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-make_002doperation"><code>make-operation</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Operations">Operations</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-merge_002dpathnames_002a"><code>merge-pathnames*</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Some-Utility-Functions">Some Utility Functions</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Function-and-Macro-Index_fn_letter-O">O</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-oos"><code>oos</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Convenience-Functions">Convenience Functions</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-oos-1"><code>oos</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Operations">Operations</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-operate"><code>operate</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Convenience-Functions">Convenience Functions</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-operate-1"><code>operate</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Operations">Operations</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-operation_002ddone_002dp"><code>operation-done-p</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Creating-new-operations">Creating new operations</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-output_002dfiles"><code>output-files</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Creating-new-operations">Creating new operations</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Function-and-Macro-Index_fn_letter-P">P</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-package_002dinferred_002dsystem"><code>package-inferred-system</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-package_002dinferred_002dsystem-extension">The package-inferred-system extension</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-parse_002dcomponent_002dform"><code>parse-component-form</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Parsing-system-definitions">Parsing system definitions</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-parse_002dunix_002dnamestring"><code>parse-unix-namestring</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Some-Utility-Functions">Some Utility Functions</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-perform"><code>perform</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Creating-new-operations">Creating new operations</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-primary_002dsystem_002dname"><code>primary-system-name</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Components">Components</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-primary_002dsystem_002dname-1"><code>primary-system-name</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Components">Components</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Function-and-Macro-Index_fn_letter-R">R</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-register_002dimmutable_002dsystem"><code>register-immutable-system</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Operations">Operations</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-register_002dimmutable_002dsystem-1"><code>register-immutable-system</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Miscellaneous-Functions">Miscellaneous Functions</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-register_002dpreloaded_002dsystem"><code>register-preloaded-system</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Miscellaneous-Functions">Miscellaneous Functions</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-register_002dsystem_002dpackages"><code>register-system-packages</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-package_002dinferred_002dsystem-extension">The package-inferred-system extension</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-require_002dsystem"><code>require-system</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Convenience-Functions">Convenience Functions</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-run_002dprogram"><code>run-program</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Some-Utility-Functions">Some Utility Functions</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-run_002dshell_002dcommand"><code>run-shell-command</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Miscellaneous-Functions">Miscellaneous Functions</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Function-and-Macro-Index_fn_letter-S">S</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-slurp_002dinput_002dstream"><code>slurp-input-stream</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Some-Utility-Functions">Some Utility Functions</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-source_002dfile_002dtype"><code>source-file-type</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Pitfalls-of-the-transition-to-ASDF-2">Pitfalls of the transition to ASDF 2</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-subpathname"><code>subpathname</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Some-Utility-Functions">Some Utility Functions</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-subpathname_002a"><code>subpathname*</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Some-Utility-Functions">Some Utility Functions</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-system_002ddefsystem_002ddepends_002don"><code>system-defsystem-depends-on</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Information-about-system-dependencies">Information about system dependencies</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-system_002ddepends_002don"><code>system-depends-on</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Information-about-system-dependencies">Information about system dependencies</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-system_002drelative_002dpathname"><code>system-relative-pathname</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Miscellaneous-Functions">Miscellaneous Functions</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-system_002drelative_002dpathname-1"><code>system-relative-pathname</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#LOAD_002dPATHNAME-has-a-weird-value">LOAD-PATHNAME has a weird value</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-system_002dsource_002ddirectory"><code>system-source-directory</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Miscellaneous-Functions">Miscellaneous Functions</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-system_002dweakly_002ddepends_002don"><code>system-weakly-depends-on</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Information-about-system-dependencies">Information about system dependencies</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Function-and-Macro-Index_fn_letter-T">T</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-test_002dsystem"><code>test-system</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Convenience-Functions">Convenience Functions</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-traverse"><code>traverse</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Operations">Operations</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Function-and-Macro-Index_fn_letter-U">U</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-uiop_003adefine_002dpackage"><code>uiop:define-package</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-package_002dinferred_002dsystem-extension">The package-inferred-system extension</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Function-and-Macro-Index_fn_letter-V">V</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-version_002dsatisfies"><code>version-satisfies</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Common-attributes-of-components">Common attributes of components</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-version_002dsatisfies-1"><code>version-satisfies</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Functions">Functions</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
</table>
<table class="fn-letters-footer-printindex"><tr><th>Jump to: &nbsp; </th><td><a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-A"><b>A</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-D"><b>D</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-E"><b>E</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-F"><b>F</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-I"><b>I</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-M"><b>M</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-O"><b>O</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-R"><b>R</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-T"><b>T</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-U"><b>U</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Function-and-Macro-Index_fn_letter-V"><b>V</b></a>
 &nbsp; 
</td></tr></table>
</div>

<hr>
</div>
<div class="unnumbered-level-extent" id="Variable-Index">
<h2 class="unnumbered" id="Variable-Index-1">Variable Index</h2>

<div class="printindex vr-printindex">
<table class="vr-letters-header-printindex"><tr><th>Jump to: &nbsp; </th><td><a class="summary-letter-printindex" href="#Variable-Index_vr_symbol-1"><b>*</b></a>
 &nbsp; 
<br>
<a class="summary-letter-printindex" href="#Variable-Index_vr_letter-A"><b>A</b></a>
 &nbsp; 
</td></tr></table>
<table class="vr-entries-printindex" border="0">
<tr><td></td><th class="entries-header-printindex">Index Entry</th><td>&nbsp;</td><th class="sections-header-printindex"> Section</th></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Variable-Index_vr_symbol-1">*</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_002acentral_002dregistry_002a"><code>*central-registry*</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#After-upgrading-ASDF">After upgrading ASDF</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_002acentral_002dregistry_002a-1"><code>*central-registry*</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#How-can-I-debug-problems-finding-ASDF-systems">How can I debug problems finding ASDF systems</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_002acompile_002dfile_002dfailure_002dbehaviour_002a"><code>*compile-file-failure-behaviour*</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Error-handling">Error handling</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_002acompile_002dfile_002dwarnings_002dbehaviour_002a"><code>*compile-file-warnings-behaviour*</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Error-handling">Error handling</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_002adefault_002dsource_002dregistry_002dexclusions_002a"><code>*default-source-registry-exclusions*</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Search-Algorithm">Search Algorithm</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_002afeatures_002a-1"><code>*features*</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Introduction">Introduction</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_002aimage_002ddump_002dhook_002a"><code>*image-dump-hook*</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Resetting-the-ASDF-configuration">Resetting the ASDF configuration</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_002aLOAD_002dPATHNAME_002a"><code>*LOAD-PATHNAME*</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#LOAD_002dPATHNAME-has-a-weird-value">LOAD-PATHNAME has a weird value</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_002aLOAD_002dTRUENAME_002a"><code>*LOAD-TRUENAME*</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#LOAD_002dPATHNAME-has-a-weird-value">LOAD-PATHNAME has a weird value</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_002anil_002dpathname_002a"><code>*nil-pathname*</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Some-Utility-Functions">Some Utility Functions</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_002aoldest_002dforward_002dcompatible_002dasdf_002dversion_002a"><code>*oldest-forward-compatible-asdf-version*</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Pitfalls-of-the-upgrade-to-ASDF-3">Pitfalls of the upgrade to ASDF 3</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_002asource_002dregistry_002a"><code>*source-registry*</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#How-can-I-debug-problems-finding-ASDF-systems">How can I debug problems finding ASDF systems</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_002asource_002dregistry_002dparameter_002a"><code>*source-registry-parameter*</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#g_t_002asource_002dregistry_002dparameter_002a-variable">*source-registry-parameter* variable</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_002astandard_002doutput_002a"><code>*standard-output*</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#How-can-I-capture-ASDF_0027s-output_003f">How can I capture ASDF's output?</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-_002asystem_002ddefinition_002dsearch_002dfunctions_002a"><code>*system-definition-search-functions*</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Components">Components</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Variable-Index_vr_letter-A">A</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-asdf_003a_003a_002auser_002dcache_002a"><code>asdf::*user-cache*</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Output-Configuration-DSL">Output Configuration DSL</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-ASDF_005fOUTPUT_005fTRANSLATIONS"><code>ASDF_OUTPUT_TRANSLATIONS</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Controlling-where-ASDF-saves-compiled-files">Controlling where ASDF saves compiled files</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
</table>
<table class="vr-letters-footer-printindex"><tr><th>Jump to: &nbsp; </th><td><a class="summary-letter-printindex" href="#Variable-Index_vr_symbol-1"><b>*</b></a>
 &nbsp; 
<br>
<a class="summary-letter-printindex" href="#Variable-Index_vr_letter-A"><b>A</b></a>
 &nbsp; 
</td></tr></table>
</div>

<hr>
</div>
<div class="unnumbered-level-extent" id="Class-and-Type-Index">
<h2 class="unnumbered" id="Class-and-Type-Index-1">Class and Type Index</h2>

<div class="printindex tp-printindex">
<table class="tp-letters-header-printindex"><tr><th>Jump to: &nbsp; </th><td><a class="summary-letter-printindex" href="#Class-and-Type-Index_tp_letter-B"><b>B</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Class-and-Type-Index_tp_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Class-and-Type-Index_tp_letter-D"><b>D</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Class-and-Type-Index_tp_letter-F"><b>F</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Class-and-Type-Index_tp_letter-I"><b>I</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Class-and-Type-Index_tp_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Class-and-Type-Index_tp_letter-M"><b>M</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Class-and-Type-Index_tp_letter-N"><b>N</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Class-and-Type-Index_tp_letter-O"><b>O</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Class-and-Type-Index_tp_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Class-and-Type-Index_tp_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Class-and-Type-Index_tp_letter-T"><b>T</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Class-and-Type-Index_tp_letter-U"><b>U</b></a>
 &nbsp; 
</td></tr></table>
<table class="tp-entries-printindex" border="0">
<tr><td></td><th class="entries-header-printindex">Index Entry</th><td>&nbsp;</td><th class="sections-header-printindex"> Section</th></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Class-and-Type-Index_tp_letter-B">B</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-binary_002dop-_0028obsolete_0029"><code>binary-op (obsolete)</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#What-happened-to-the-bundle-operations">What happened to the bundle operations</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Class-and-Type-Index_tp_letter-C">C</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-compile_002dbundle_002dop"><code>compile-bundle-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-compile_002dbundle_002dop-1"><code>compile-bundle-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#What-happened-to-the-bundle-operations">What happened to the bundle operations</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-compile_002dconcatenated_002dsource_002dop"><code>compile-concatenated-source-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-compile_002dop"><code>compile-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-component-1"><code>component</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-object-model-of-ASDF">The object model of ASDF</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-concatenate_002dsource_002dop"><code>concatenate-source-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Class-and-Type-Index_tp_letter-D">D</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-deliver_002dasd_002dop"><code>deliver-asd-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-deliver_002dasd_002dop-1"><code>deliver-asd-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#What-happened-to-the-bundle-operations">What happened to the bundle operations</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-dll_002dop"><code>dll-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-downward_002doperation"><code>downward-operation</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Creating-new-operations">Creating new operations</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Class-and-Type-Index_tp_letter-F">F</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-fasl_002dop-_0028obsolete_0029"><code>fasl-op (obsolete)</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#What-happened-to-the-bundle-operations">What happened to the bundle operations</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Class-and-Type-Index_tp_letter-I">I</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-image_002dop"><code>image-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Class-and-Type-Index_tp_letter-L">L</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-lib_002dop"><code>lib-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-load_002dbundle_002dop"><code>load-bundle-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-load_002dbundle_002dop-1"><code>load-bundle-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#What-happened-to-the-bundle-operations">What happened to the bundle operations</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-load_002dcompiled_002dconcatenated_002dsource_002dop"><code>load-compiled-concatenated-source-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-load_002dconcatenated_002dsource_002dop"><code>load-concatenated-source-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-load_002dfasl_002dop-_0028obsolete_0029"><code>load-fasl-op (obsolete)</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#What-happened-to-the-bundle-operations">What happened to the bundle operations</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-load_002dop"><code>load-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-load_002dsource_002dop"><code>load-source-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Class-and-Type-Index_tp_letter-M">M</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-module"><code>module</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Pre_002ddefined-subclasses-of-component">Pre-defined subclasses of component</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-monolithic_002dbinary_002dop-_0028obsolete_0029"><code>monolithic-binary-op (obsolete)</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#What-happened-to-the-bundle-operations">What happened to the bundle operations</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-monolithic_002dcompile_002dbundle_002dop"><code>monolithic-compile-bundle-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-monolithic_002dcompile_002dbundle_002dop-1"><code>monolithic-compile-bundle-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#What-happened-to-the-bundle-operations">What happened to the bundle operations</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-monolithic_002dcompile_002dconcatenated_002dsource_002dop"><code>monolithic-compile-concatenated-source-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-monolithic_002dconcatenate_002dsource_002dop"><code>monolithic-concatenate-source-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-monolithic_002ddeliver_002dasd_002dop"><code>monolithic-deliver-asd-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-monolithic_002ddeliver_002dasd_002dop-1"><code>monolithic-deliver-asd-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#What-happened-to-the-bundle-operations">What happened to the bundle operations</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-monolithic_002ddll_002dop"><code>monolithic-dll-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-monolithic_002dfasl_002dop-_0028obsolete_0029"><code>monolithic-fasl-op (obsolete)</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#What-happened-to-the-bundle-operations">What happened to the bundle operations</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-monolithic_002dlib_002dop"><code>monolithic-lib-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-monolithic_002dload_002dbundle_002dop"><code>monolithic-load-bundle-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-monolithic_002dload_002dbundle_002dop-1"><code>monolithic-load-bundle-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#What-happened-to-the-bundle-operations">What happened to the bundle operations</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-monolithic_002dload_002dcompiled_002dconcatenated_002dsource_002dop"><code>monolithic-load-compiled-concatenated-source-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-monolithic_002dload_002dconcatenated_002dsource_002dop"><code>monolithic-load-concatenated-source-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-monolithic_002dload_002dfasl_002dop-_0028obsolete_0029"><code>monolithic-load-fasl-op (obsolete)</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#What-happened-to-the-bundle-operations">What happened to the bundle operations</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Class-and-Type-Index_tp_letter-N">N</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-non_002dpropagating_002doperation"><code>non-propagating-operation</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Creating-new-operations">Creating new operations</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Class-and-Type-Index_tp_letter-O">O</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-operation-1"><code>operation</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#The-object-model-of-ASDF">The object model of ASDF</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-operation_002derror"><code>operation-error</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Error-handling">Error handling</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Class-and-Type-Index_tp_letter-P">P</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-prepare_002dop"><code>prepare-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-prepare_002dsource_002dop"><code>prepare-source-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-program_002dop"><code>program-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-program_002dop-1"><code>program-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#What-happened-to-the-bundle-operations">What happened to the bundle operations</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-program_002dop-2"><code>program-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#How-can-I-produce-a-binary-at-a-specific-path-from-sources-at-a-specific-path">How can I produce a binary at a specific path from sources at a specific path</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Class-and-Type-Index_tp_letter-S">S</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-selfward_002doperation"><code>selfward-operation</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Creating-new-operations">Creating new operations</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-sideway_002doperation"><code>sideway-operation</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Creating-new-operations">Creating new operations</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-source_002dfile"><code>source-file</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Pre_002ddefined-subclasses-of-component">Pre-defined subclasses of component</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-system-1"><code>system</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Pre_002ddefined-subclasses-of-component">Pre-defined subclasses of component</a></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-system_002ddefinition_002derror"><code>system-definition-error</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Error-handling">Error handling</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Class-and-Type-Index_tp_letter-T">T</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-test_002dop"><code>test-op</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Predefined-operations-of-ASDF">Predefined operations of ASDF</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th id="Class-and-Type-Index_tp_letter-U">U</th><td></td><td></td></tr>
<tr><td></td><td class="printindex-index-entry"><a href="#index-upward_002doperation"><code>upward-operation</code></a>:</td><td>&nbsp;</td><td class="printindex-index-section"><a href="#Creating-new-operations">Creating new operations</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
</table>
<table class="tp-letters-footer-printindex"><tr><th>Jump to: &nbsp; </th><td><a class="summary-letter-printindex" href="#Class-and-Type-Index_tp_letter-B"><b>B</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Class-and-Type-Index_tp_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Class-and-Type-Index_tp_letter-D"><b>D</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Class-and-Type-Index_tp_letter-F"><b>F</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Class-and-Type-Index_tp_letter-I"><b>I</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Class-and-Type-Index_tp_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Class-and-Type-Index_tp_letter-M"><b>M</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Class-and-Type-Index_tp_letter-N"><b>N</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Class-and-Type-Index_tp_letter-O"><b>O</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Class-and-Type-Index_tp_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Class-and-Type-Index_tp_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Class-and-Type-Index_tp_letter-T"><b>T</b></a>
 &nbsp; 
<a class="summary-letter-printindex" href="#Class-and-Type-Index_tp_letter-U"><b>U</b></a>
 &nbsp; 
</td></tr></table>
</div>

</div>
</div>
<div class="footnotes-segment">
<hr>
<h4 class="footnotes-heading">Footnotes</h4>

<h5 class="footnote-body-heading"><a id="FOOT1" href="#DOCF1">(1)</a></h5>
<p>NB: all implementations except GNU CLISP also accept
<code class="code">(require &quot;ASDF&quot;)</code>, <code class="code">(require 'asdf)</code> and <code class="code">(require :asdf)</code>.
For portability&rsquo;s sake, you should use <code class="code">(require &quot;asdf&quot;)</code>.
</p>
<h5 class="footnote-body-heading"><a id="FOOT2" href="#DOCF2">(2)</a></h5>
<p><samp class="file">~/common-lisp/</samp> is only included in
  the default configuration
  starting with ASDF 3.1.2 or later.
  If your implementation provides an earlier variant of ASDF,
  you may need to explicitly configure it to use this path,
  as further explained.
</p>
<h5 class="footnote-body-heading"><a id="FOOT3" href="#DOCF3">(3)</a></h5>
<p>For Windows users, and starting with ASDF 3.1.5, start from your
  <samp class="file">%LOCALAPPDATA%</samp>, which is usually <samp class="file">~/AppData/Local/</samp>
  (but you can ask in a <code class="code">CMD.EXE</code> terminal
  <code class="code">echo %LOCALAPPDATA%</code> to make sure)
  and underneath create a subpath
  <samp class="file">config/common-lisp/source-registry.conf.d/</samp>.
</p>
<h5 class="footnote-body-heading"><a id="FOOT4" href="#DOCF4">(4)</a></h5>
<p>By requiring the <samp class="file">.conf</samp>
  extension, and ignoring other files, ASDF allows you to have disabled files,
  editor backups, etc. in the same directory with your active
  configuration files.
</p>
<p>ASDF will also ignore files whose names start with a <samp class="file">.</samp> character.
</p>
<p>It is customary to start the filename with two digits, to control the
  sorting of the <code class="code">conf</code> files in the source registry directory, and
  thus the order in which the directories will be scanned.
</p>
<h5 class="footnote-body-heading"><a id="FOOT5" href="#DOCF5">(5)</a></h5>
<p>It is possible to further customize
the system definition file search.
That&rsquo;s considered advanced use, and covered later:
search forward for
<code class="code">*system-definition-search-functions*</code>.
See <a class="xref" href="#Defining-systems-with-defsystem">Defining systems with defsystem</a>.</p>
<h5 class="footnote-body-heading"><a id="FOOT6" href="#DOCF6">(6)</a></h5>
<p>ASDF will indeed call <code class="code">eval</code> on each entry.
It will skip entries that evaluate to <code class="code">nil</code>.
</p>
<p>Strings and pathname objects are self-evaluating,
in which case the <code class="code">eval</code> step does nothing;
but you may push arbitrary s-expressions onto the central registry.
These s-expressions may be evaluated to compute context-dependent
entries, e.g. things that depend
on the value of shell variables or the identity of the user.
</p>
<p>The variable <code class="code">asdf:*central-registry*</code> is thus a list of
&ldquo;system directory designators&rdquo;.
A <em class="dfn">system directory designator</em> is a form
which will be evaluated whenever a system is to be found,
and must evaluate to a directory to look in (or <code class="code">nil</code>).
By &ldquo;directory&rdquo;, we mean
&ldquo;designator for a pathname with a non-empty DIRECTORY component&rdquo;.
</p>
<h5 class="footnote-body-heading"><a id="FOOT7" href="#DOCF7">(7)</a></h5>
<p>On Windows, you can use Windows shortcuts instead of POSIX symlinks.
  if you try aliases under MacOS, we are curious to hear about your experience.
</p>
<h5 class="footnote-body-heading"><a id="FOOT8" href="#DOCF8">(8)</a></h5>
<p>For the curious, the option is <code class="code">:force-not (already-loaded-systems)</code>.
</p>
<h5 class="footnote-body-heading"><a id="FOOT9" href="#DOCF9">(9)</a></h5>
<p>ASDF 1 and 2 (up until 2.26)
  used to dynamically create and delete temporary packages <code class="code">asdf<em class="emph">N</em></code>,
  one for each <samp class="file">.asd</samp> file, in a misguided attempt to thereby reduce name clashes;
  but it failed at that goal and only made things more complex.
  ASDF 3 just uses a shared package <code class="code">asdf-user</code> instead,
  and relies on the usual Common Lisp conventions to avoid clashes.
  As far as package oddities go, you may just notice that
  the <code class="code">asdf-user</code> package also uses <code class="code">uiop/common-lisp</code>,
  a variant of the <code class="code">common-lisp</code> package that papers over
  deficiencies in more obscure Common Lisp implementations;
  but unless you care about Corman Lisp, GCL, Genera or MCL, you shouldn&rsquo;t be concerned.
</p>
<h5 class="footnote-body-heading"><a id="FOOT10" href="#DOCF10">(10)</a></h5>
<p>Historically, the function that built a plan was
  called <code class="code">traverse</code>, and returned a list of actions;
  it was deprecated in favor of <code class="code">make-plan</code> (that returns a plan object)
  when the <code class="code">plan</code> objects were introduced with ASDF 3;
  the old function is kept for backward compatibility and debugging purposes only,
  and may be removed in the near future.
</p>
<h5 class="footnote-body-heading"><a id="FOOT11" href="#DOCF11">(11)</a></h5>
<p>The term <em class="emph">action</em>
  was used by Kent Pitman in his article, &ldquo;The Description of Large Systems,&rdquo;
  (see <a class="pxref" href="#Bibliography">Bibliography</a>),
  and we suspect might be traced to <code class="code">make</code>.
  Although the term was only used by ASDF hackers starting with ASDF 2,
  the concept was there since the very beginning of ASDF 1,
  just not clearly articulated.
</p>
<h5 class="footnote-body-heading"><a id="FOOT12" href="#DOCF12">(12)</a></h5>
<p>Note that between releases 2.27 and 3.0.3, only <code class="code">UIOP/PACKAGE</code>,
not all of <code class="code">UIOP</code>, was used; if you want your code to work
with releases earlier than 3.1.2, you may have to explicitly define a package
that uses <code class="code">UIOP</code>, or use proper package prefix to your symbols, as in
<code class="code">uiop:version&lt;</code>.</p>
<h5 class="footnote-body-heading"><a id="FOOT13" href="#DOCF13">(13)</a></h5>
<p>ASDF 2.26 and earlier versions
do not support this primary system name convention.
With these versions of ASDF
you must explicitly load <samp class="file">foo.asd</samp>
before you can use system <var class="var">foo/bar</var> defined therein,
e.g. using <code class="code">(asdf:find-system &quot;foo&quot;)</code>.
We do not support ASDF 2, and recommend that you should upgrade to ASDF 3.
</p>
<h5 class="footnote-body-heading"><a id="FOOT14" href="#DOCF14">(14)</a></h5>
<p>&ldquo;FASL&rdquo; is short for &ldquo;FASt Loading.&rdquo;</p>
<h5 class="footnote-body-heading"><a id="FOOT15" href="#DOCF15">(15)</a></h5>
<p>A <code class="code">CLEAN-OP</code> would be a partial solution to this problem.</p>
<h5 class="footnote-body-heading"><a id="FOOT16" href="#DOCF16">(16)</a></h5>
<p>Alternatively, you could touch <code class="code">foo.asd</code> or
remove the corresponding fasls from the output file cache.</p>
<h5 class="footnote-body-heading"><a id="FOOT17" href="#DOCF17">(17)</a></h5>
<a class="index-entry-id" id="index-_002aoldest_002dforward_002dcompatible_002dasdf_002dversion_002a"></a>
<p>Forward incompatibility can be determined using the variable
<code class="code">asdf/upgrade::*oldest-forward-compatible-asdf-version*</code>,
which is 2.33 at the time of this writing.</p>
</div>



</body>
</html>
